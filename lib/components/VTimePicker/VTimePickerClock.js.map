{"version":3,"sources":["../../../src/components/VTimePicker/VTimePickerClock.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../stylus/components/_time-picker-clock.styl'\r\n\r\n// Mixins\r\nimport Colorable from '../../mixins/colorable'\r\nimport Themeable from '../../mixins/themeable'\r\nimport mixins, { ExtractVue } from '../../util/mixins'\r\nimport Vue, { VNode } from 'vue'\r\n\r\ninterface Point {\r\n  x: number\r\n  y: number\r\n}\r\n\r\ninterface options extends Vue {\r\n  $refs: {\r\n    clock: HTMLElement\r\n    innerClock: HTMLElement\r\n  }\r\n}\r\n\r\nexport default mixins<options &\r\n/* eslint-disable indent */\r\n  ExtractVue<[\r\n    typeof Colorable,\r\n    typeof Themeable\r\n  ]>\r\n/* eslint-enable indent */\r\n>(\r\n  Colorable,\r\n  Themeable\r\n/* @vue/component */\r\n).extend({\r\n  name: 'v-time-picker-clock',\r\n\r\n  props: {\r\n    allowedValues: Function,\r\n    disabled: Boolean,\r\n    double: Boolean,\r\n    format: {\r\n      type: Function,\r\n      default: (val: string | number) => val\r\n    },\r\n    max: {\r\n      type: Number,\r\n      required: true\r\n    },\r\n    min: {\r\n      type: Number,\r\n      required: true\r\n    },\r\n    scrollable: Boolean,\r\n    readonly: Boolean,\r\n    rotate: {\r\n      type: Number,\r\n      default: 0\r\n    },\r\n    step: {\r\n      type: Number,\r\n      default: 1\r\n    },\r\n    value: Number\r\n  },\r\n\r\n  data () {\r\n    return {\r\n      inputValue: this.value,\r\n      isDragging: false,\r\n      valueOnMouseDown: null as number | null,\r\n      valueOnMouseUp: null as number | null\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    count (): number {\r\n      return this.max - this.min + 1\r\n    },\r\n    degreesPerUnit (): number {\r\n      return 360 / this.roundCount\r\n    },\r\n    degrees (): number {\r\n      return this.degreesPerUnit * Math.PI / 180\r\n    },\r\n    displayedValue (): number {\r\n      return this.value == null ? this.min : this.value\r\n    },\r\n    innerRadiusScale (): number {\r\n      return 0.62\r\n    },\r\n    roundCount (): number {\r\n      return this.double ? (this.count / 2) : this.count\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    value (value) {\r\n      this.inputValue = value\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    wheel (e: WheelEvent) {\r\n      e.preventDefault()\r\n\r\n      const delta = Math.sign(-e.deltaY || 1)\r\n      let value = this.displayedValue\r\n      do {\r\n        value = value + delta\r\n        value = (value - this.min + this.count) % this.count + this.min\r\n      } while (!this.isAllowed(value) && value !== this.displayedValue)\r\n\r\n      if (value !== this.displayedValue) {\r\n        this.update(value)\r\n      }\r\n    },\r\n    isInner (value: number) {\r\n      return this.double && (value - this.min >= this.roundCount)\r\n    },\r\n    handScale (value: number) {\r\n      return this.isInner(value) ? this.innerRadiusScale : 1\r\n    },\r\n    isAllowed (value: number) {\r\n      return !this.allowedValues || this.allowedValues(value)\r\n    },\r\n    genValues () {\r\n      const children: VNode[] = []\r\n\r\n      for (let value = this.min; value <= this.max; value = value + this.step) {\r\n        const color = value === this.value && (this.color || 'accent')\r\n        children.push(this.$createElement('span', this.setBackgroundColor(color, {\r\n          staticClass: 'v-time-picker-clock__item',\r\n          'class': {\r\n            'v-time-picker-clock__item--active': value === this.displayedValue,\r\n            'v-time-picker-clock__item--disabled': this.disabled || !this.isAllowed(value)\r\n          },\r\n          style: this.getTransform(value),\r\n          domProps: { innerHTML: `<span>${this.format(value)}</span>` }\r\n        })))\r\n      }\r\n\r\n      return children\r\n    },\r\n    genHand () {\r\n      const scale = `scaleY(${this.handScale(this.displayedValue)})`\r\n      const angle = this.rotate + this.degreesPerUnit * (this.displayedValue - this.min)\r\n      const color = (this.value != null) && (this.color || 'accent')\r\n      return this.$createElement('div', this.setBackgroundColor(color, {\r\n        staticClass: 'v-time-picker-clock__hand',\r\n        'class': {\r\n          'v-time-picker-clock__hand--inner': this.isInner(this.value)\r\n        },\r\n        style: {\r\n          transform: `rotate(${angle}deg) ${scale}`\r\n        }\r\n      }))\r\n    },\r\n    getTransform (i: number) {\r\n      const { x, y } = this.getPosition(i)\r\n      return {\r\n        left: `${50 + x * 50}%`,\r\n        top: `${50 + y * 50}%`\r\n      }\r\n    },\r\n    getPosition (value: number) {\r\n      const rotateRadians = this.rotate * Math.PI / 180\r\n      return {\r\n        x: Math.sin((value - this.min) * this.degrees + rotateRadians) * this.handScale(value),\r\n        y: -Math.cos((value - this.min) * this.degrees + rotateRadians) * this.handScale(value)\r\n      }\r\n    },\r\n    onMouseDown (e: MouseEvent | TouchEvent) {\r\n      e.preventDefault()\r\n\r\n      this.valueOnMouseDown = null\r\n      this.valueOnMouseUp = null\r\n      this.isDragging = true\r\n      this.onDragMove(e)\r\n    },\r\n    onMouseUp () {\r\n      this.isDragging = false\r\n      if (this.valueOnMouseUp !== null && this.isAllowed(this.valueOnMouseUp)) {\r\n        this.$emit('change', this.valueOnMouseUp)\r\n      }\r\n    },\r\n    onDragMove (e: MouseEvent | TouchEvent) {\r\n      e.preventDefault()\r\n      if (!this.isDragging && e.type !== 'click') return\r\n\r\n      const { width, top, left } = this.$refs.clock.getBoundingClientRect()\r\n      const { width: innerWidth } = this.$refs.innerClock.getBoundingClientRect()\r\n      const { clientX, clientY } = 'touches' in e ? e.touches[0] : e\r\n      const center = { x: width / 2, y: -width / 2 }\r\n      const coords = { x: clientX - left, y: top - clientY }\r\n      const handAngle = Math.round(this.angle(center, coords) - this.rotate + 360) % 360\r\n      const insideClick = this.double && this.euclidean(center, coords) < (innerWidth + innerWidth * this.innerRadiusScale) / 4\r\n      const value = Math.round(handAngle / this.degreesPerUnit) +\r\n        this.min + (insideClick ? this.roundCount : 0)\r\n\r\n      // Necessary to fix edge case when selecting left part of the value(s) at 12 o'clock\r\n      let newValue: number\r\n      if (handAngle >= (360 - this.degreesPerUnit / 2)) {\r\n        newValue = insideClick ? this.max - this.roundCount + 1 : this.min\r\n      } else {\r\n        newValue = value\r\n      }\r\n\r\n      if (this.isAllowed(value)) {\r\n        if (this.valueOnMouseDown === null) {\r\n          this.valueOnMouseDown = newValue\r\n        }\r\n        this.valueOnMouseUp = newValue\r\n        this.update(newValue)\r\n      }\r\n    },\r\n    update (value: number) {\r\n      if (this.inputValue !== value) {\r\n        this.inputValue = value\r\n        this.$emit('input', value)\r\n      }\r\n    },\r\n    euclidean (p0: Point, p1: Point) {\r\n      const dx = p1.x - p0.x\r\n      const dy = p1.y - p0.y\r\n\r\n      return Math.sqrt(dx * dx + dy * dy)\r\n    },\r\n    angle (center: Point, p1: Point) {\r\n      const value = 2 * Math.atan2(p1.y - center.y - this.euclidean(center, p1), p1.x - center.x)\r\n      return Math.abs(value * 180 / Math.PI)\r\n    }\r\n  },\r\n\r\n  render (h): VNode {\r\n    const data = {\r\n      staticClass: 'v-time-picker-clock',\r\n      class: {\r\n        'v-time-picker-clock--indeterminate': this.value == null,\r\n        ...this.themeClasses\r\n      },\r\n      on: (this.readonly || this.disabled) ? undefined : Object.assign({\r\n        mousedown: this.onMouseDown,\r\n        mouseup: this.onMouseUp,\r\n        mouseleave: () => (this.isDragging && this.onMouseUp()),\r\n        touchstart: this.onMouseDown,\r\n        touchend: this.onMouseUp,\r\n        mousemove: this.onDragMove,\r\n        touchmove: this.onDragMove\r\n      }, this.scrollable ? {\r\n        wheel: this.wheel\r\n      } : {}),\r\n      ref: 'clock'\r\n    }\r\n\r\n    return h('div', data, [\r\n      h('div', {\r\n        staticClass: 'v-time-picker-clock__inner',\r\n        ref: 'innerClock'\r\n      }, [\r\n        this.genHand(),\r\n        this.genValues()\r\n      ])\r\n    ])\r\n  }\r\n})\r\n"],"sourceRoot":""}