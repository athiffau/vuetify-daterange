import { colorToInt, intToHex, colorToHex } from './colorUtils';
import * as sRGB from './color/transformSRGB';
import * as LAB from './color/transformCIELAB';
export function parse(theme, isItem = false) {
    const colors = Object.keys(theme);
    const parsedTheme = {};
    for (let i = 0; i < colors.length; ++i) {
        const name = colors[i];
        const value = theme[name];
        if (isItem) {
            if (name === 'base' || name.startsWith('lighten') || name.startsWith('darken')) {
                parsedTheme[name] = colorToHex(value);
            }
        }
        else if (typeof value === 'object') {
            parsedTheme[name] = parse(value, true);
        }
        else {
            parsedTheme[name] = genVariations(name, colorToInt(value));
        }
    }
    return parsedTheme;
}
/**
 * Generate the CSS for a base color (.primary)
 */
const genBaseColor = (name, value) => {
    return `
.${name} {
  background-color: ${value} !important;
  border-color: ${value} !important;
}
.${name}--text {
  color: ${value} !important;
  caret-color: ${value} !important;
}`;
};
/**
 * Generate the CSS for a variant color (.primary.darken-2)
 */
const genVariantColor = (name, variant, value) => {
    const [type, n] = variant.split(/(\d)/, 2);
    return `
.${name}.${type}-${n} {
  background-color: ${value} !important;
  border-color: ${value} !important;
}
.${name}--text.text--${type}-${n} {
  color: ${value} !important;
  caret-color: ${value} !important;
}`;
};
const genColorVariableName = (name, variant = 'base') => `--v-${name}-${variant}`;
const genColorVariable = (name, variant = 'base') => `var(${genColorVariableName(name, variant)})`;
export function genStyles(theme, cssVar = false) {
    const colors = Object.keys(theme);
    if (!colors.length)
        return '';
    let variablesCss = '';
    let css = '';
    const aColor = cssVar ? genColorVariable('primary') : theme.primary.base;
    css += `a { color: ${aColor}; }`;
    for (let i = 0; i < colors.length; ++i) {
        const name = colors[i];
        const value = theme[name];
        if (typeof value !== 'object')
            continue;
        css += genBaseColor(name, cssVar ? genColorVariable(name) : value.base);
        cssVar && (variablesCss += `  ${genColorVariableName(name)}: ${value.base};\n`);
        const variants = Object.keys(value);
        for (let i = 0; i < variants.length; ++i) {
            const variant = variants[i];
            const variantValue = value[variant];
            if (variant === 'base')
                continue;
            css += genVariantColor(name, variant, cssVar ? genColorVariable(name, variant) : variantValue);
            cssVar && (variablesCss += `  ${genColorVariableName(name, variant)}: ${variantValue};\n`);
        }
    }
    if (cssVar) {
        variablesCss = `:root {\n${variablesCss}}\n\n`;
    }
    return variablesCss + css;
}
export function genVariations(name, value) {
    const values = {
        base: intToHex(value)
    };
    for (let i = 5; i > 0; --i) {
        values[`lighten${i}`] = intToHex(lighten(value, i));
    }
    for (let i = 1; i <= 4; ++i) {
        values[`darken${i}`] = intToHex(darken(value, i));
    }
    return values;
}
function lighten(value, amount) {
    const lab = LAB.fromXYZ(sRGB.toXYZ(value));
    lab[0] = lab[0] + amount * 10;
    return sRGB.fromXYZ(LAB.toXYZ(lab));
}
function darken(value, amount) {
    const lab = LAB.fromXYZ(sRGB.toXYZ(value));
    lab[0] = lab[0] - amount * 10;
    return sRGB.fromXYZ(LAB.toXYZ(lab));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC90aGVtZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQU8sTUFBTSxjQUFjLENBQUE7QUFDcEUsT0FBTyxLQUFLLElBQUksTUFBTSx1QkFBdUIsQ0FBQTtBQUM3QyxPQUFPLEtBQUssR0FBRyxNQUFNLHlCQUF5QixDQUFBO0FBc0I5QyxNQUFNLFVBQVUsS0FBSyxDQUFFLEtBQXFELEVBQUUsTUFBTSxHQUFHLEtBQUs7SUFDMUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNqQyxNQUFNLFdBQVcsR0FBUSxFQUFFLENBQUE7SUFFM0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDdEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUV6QixJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksSUFBSSxLQUFLLE1BQU0sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzlFLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDdEM7U0FDRjthQUFNLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1lBQ3BDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO1NBQ3ZDO2FBQU07WUFDTCxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsYUFBYSxDQUFDLElB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Q0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtJQUMxQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDN0IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUNyQyxDQUFDO0FBRUQsU0FBUyxNQUFNLENBQUUsS0FBVSxFQUFFLE1BQWM7SUFDekMsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFDMUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsRUFBRSxDQUFBO0lBQzdCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFDckMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbG9yVG9JbnQsIGludFRvSGV4LCBjb2xvclRvSGV4LCBSR0IgfSBmcm9tICcuL2NvbG9yVXRpbHMnXHJcbmltcG9ydCAqIGFzIHNSR0IgZnJvbSAnLi9jb2xvci90cmFuc2Zvcm1TUkdCJ1xyXG5pbXBvcnQgKiBhcyBMQUIgZnJvbSAnLi9jb2xvci90cmFuc2Zvcm1DSUVMQUInXHJcbmltcG9ydCB7IFZ1ZXRpZnlUaGVtZSB9IGZyb20gJ3Z1ZXRpZnkvdHlwZXMnXHJcblxyXG5pbnRlcmZhY2UgUGFyc2VkVGhlbWVJdGVtIHtcclxuICBiYXNlOiBzdHJpbmdcclxuICBsaWdodGVuNTogc3RyaW5nXHJcbiAgbGlnaHRlbjQ6IHN0cmluZ1xyXG4gIGxpZ2h0ZW4zOiBzdHJpbmdcclxuICBsaWdodGVuMjogc3RyaW5nXHJcbiAgbGlnaHRlbjE6IHN0cmluZ1xyXG4gIGRhcmtlbjE6IHN0cmluZ1xyXG4gIGRhcmtlbjI6IHN0cmluZ1xyXG4gIGRhcmtlbjM6IHN0cmluZ1xyXG4gIGRhcmtlbjQ6IHN0cmluZ1xyXG5cclxuICBbbmFtZTogc3RyaW5nXTogc3RyaW5nXHJcbn1cclxuXHJcbmludGVyZmFjZSBQYXJzZWRUaGVtZSB7XHJcbiAgW25hbWU6IHN0cmluZ106IFBhcnNlZFRoZW1lSXRlbVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2UgKHRoZW1lOiBWdWV0aWZ5VGhlbWUgfCBSZWNvcmQ8c3RyaW5nLCBudW1iZXIgfCBzdHJpbmc+LCBpc0l0ZW0gPSBmYWxzZSk6IFBhcnNlZFRoZW1lIHtcclxuICBjb25zdCBjb2xvcnMgPSBPYmplY3Qua2V5cyh0aGVtZSlcclxuICBjb25zdCBwYXJzZWRUaGVtZTogYW55ID0ge31cclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xvcnMubGVuZ3RoOyArK2kpIHtcclxuICAgIGNvbnN0IG5hbWUgPSBjb2xvcnNbaV1cclxuICAgIGNvbnN0IHZhbHVlID0gdGhlbWVbbmFtZV1cclxuXHJcbiAgICBpZiAoaXNJdGVtKSB7XHJcbiAgICAgIGlmIChuYW1lID09PSAnYmFzZScgfHwgbmFtZS5zdGFydHNXaXRoKCdsaWdodGVuJykgfHwgbmFtZS5zdGFydHNXaXRoKCdkYXJrZW4nKSkge1xyXG4gICAgICAgIHBhcnNlZFRoZW1lW25hbWVdID0gY29sb3JUb0hleCh2YWx1ZSlcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgIHBhcnNlZFRoZW1lW25hbWVdID0gcGFyc2UodmFsdWUsIHRydWUpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwYXJzZWRUaGVtZVtuYW1lXSA9IGdlblZhcmlhdGlvbnMobmFtZSwgY29sb3JUb0ludCh2YWx1ZSkpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcGFyc2VkVGhlbWVcclxufVxyXG5cclxuLyoqXHJcbiAqIEdlbmVyYXRlIHRoZSBDU1MgZm9yIGEgYmFzZSBjb2xvciAoLnByaW1hcnkpXHJcbiAqL1xyXG5jb25zdCBnZW5CYXNlQ29sb3IgPSAobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcclxuICByZXR1cm4gYFxyXG4uJHtuYW1lfSB7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcclxuICBib3JkZXItY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XHJcbn1cclxuLiR7bmFtZX0tLXRleHQge1xyXG4gIGNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xyXG4gIGNhcmV0LWNvbG9yOiAke3ZhbHVlfSAhaW1wb3J0YW50O1xyXG59YFxyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgdGhlIENTUyBmb3IgYSB2YXJpYW50IGNvbG9yICgucHJpbWFyeS5kYXJrZW4tMilcclxuICovXHJcbmNvbnN0IGdlblZhcmlhbnRDb2xvciA9IChuYW1lOiBzdHJpbmcsIHZhcmlhbnQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XHJcbiAgY29uc3QgW3R5cGUsIG5dID0gdmFyaWFudC5zcGxpdCgvKFxcZCkvLCAyKVxyXG4gIHJldHVybiBgXHJcbi4ke25hbWV9LiR7dHlwZX0tJHtufSB7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcclxuICBib3JkZXItY29sb3I6ICR7dmFsdWV9ICFpbXBvcnRhbnQ7XHJcbn1cclxuLiR7bmFtZX0tLXRleHQudGV4dC0tJHt0eXBlfS0ke259IHtcclxuICBjb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcclxuICBjYXJldC1jb2xvcjogJHt2YWx1ZX0gIWltcG9ydGFudDtcclxufWBcclxufVxyXG5cclxuY29uc3QgZ2VuQ29sb3JWYXJpYWJsZU5hbWUgPSAobmFtZTogc3RyaW5nLCB2YXJpYW50ID0gJ2Jhc2UnKTogc3RyaW5nID0+IGAtLXYtJHtuYW1lfS0ke3ZhcmlhbnR9YFxyXG5cclxuY29uc3QgZ2VuQ29sb3JWYXJpYWJsZSA9IChuYW1lOiBzdHJpbmcsIHZhcmlhbnQgPSAnYmFzZScpOiBzdHJpbmcgPT4gYHZhcigke2dlbkNvbG9yVmFyaWFibGVOYW1lKG5hbWUsIHZhcmlhbnQpfSlgXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuU3R5bGVzICh0aGVtZTogUGFyc2VkVGhlbWUsIGNzc1ZhciA9IGZhbHNlKTogc3RyaW5nIHtcclxuICBjb25zdCBjb2xvcnMgPSBPYmplY3Qua2V5cyh0aGVtZSlcclxuXHJcbiAgaWYgKCFjb2xvcnMubGVuZ3RoKSByZXR1cm4gJydcclxuXHJcbiAgbGV0IHZhcmlhYmxlc0NzcyA9ICcnXHJcbiAgbGV0IGNzcyA9ICcnXHJcblxyXG4gIGNvbnN0IGFDb2xvciA9IGNzc1ZhciA/IGdlbkNvbG9yVmFyaWFibGUoJ3ByaW1hcnknKSA6IHRoZW1lLnByaW1hcnkuYmFzZVxyXG4gIGNzcyArPSBgYSB7IGNvbG9yOiAke2FDb2xvcn07IH1gXHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JzLmxlbmd0aDsgKytpKSB7XHJcbiAgICBjb25zdCBuYW1lID0gY29sb3JzW2ldXHJcbiAgICBjb25zdCB2YWx1ZSA9IHRoZW1lW25hbWVdXHJcblxyXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIGNvbnRpbnVlXHJcblxyXG4gICAgY3NzICs9IGdlbkJhc2VDb2xvcihuYW1lLCBjc3NWYXIgPyBnZW5Db2xvclZhcmlhYmxlKG5hbWUpIDogdmFsdWUuYmFzZSlcclxuICAgIGNzc1ZhciAmJiAodmFyaWFibGVzQ3NzICs9IGAgICR7Z2VuQ29sb3JWYXJpYWJsZU5hbWUobmFtZSl9OiAke3ZhbHVlLmJhc2V9O1xcbmApXHJcblxyXG4gICAgY29uc3QgdmFyaWFudHMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyaWFudHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgY29uc3QgdmFyaWFudCA9IHZhcmlhbnRzW2ldXHJcbiAgICAgIGNvbnN0IHZhcmlhbnRWYWx1ZSA9IHZhbHVlW3ZhcmlhbnRdXHJcbiAgICAgIGlmICh2YXJpYW50ID09PSAnYmFzZScpIGNvbnRpbnVlXHJcblxyXG4gICAgICBjc3MgKz0gZ2VuVmFyaWFudENvbG9yKG5hbWUsIHZhcmlhbnQsIGNzc1ZhciA/IGdlbkNvbG9yVmFyaWFibGUobmFtZSwgdmFyaWFudCkgOiB2YXJpYW50VmFsdWUpXHJcbiAgICAgIGNzc1ZhciAmJiAodmFyaWFibGVzQ3NzICs9IGAgICR7Z2VuQ29sb3JWYXJpYWJsZU5hbWUobmFtZSwgdmFyaWFudCl9OiAke3ZhcmlhbnRWYWx1ZX07XFxuYClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmIChjc3NWYXIpIHtcclxuICAgIHZhcmlhYmxlc0NzcyA9IGA6cm9vdCB7XFxuJHt2YXJpYWJsZXNDc3N9fVxcblxcbmBcclxuICB9XHJcblxyXG4gIHJldHVybiB2YXJpYWJsZXNDc3MgKyBjc3NcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdlblZhcmlhdGlvbnMgKG5hbWU6IHN0cmluZywgdmFsdWU6IFJHQik6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xyXG4gIGNvbnN0IHZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcclxuICAgIGJhc2U6IGludFRvSGV4KHZhbHVlKVxyXG4gIH1cclxuXHJcbiAgZm9yIChsZXQgaSA9IDU7IGkgPiAwOyAtLWkpIHtcclxuICAgIHZhbHVlc1tgbGlnaHRlbiR7aX1gXSA9IGludFRvSGV4KGxpZ2h0ZW4odmFsdWUsIGkpKVxyXG4gIH1cclxuXHJcbiAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNDsgKytpKSB7XHJcbiAgICB2YWx1ZXNbYGRhcmtlbiR7aX1gXSA9IGludFRvSGV4KGRhcmtlbih2YWx1ZSwgaSkpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gdmFsdWVzXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxpZ2h0ZW4gKHZhbHVlOiBSR0IsIGFtb3VudDogbnVtYmVyKTogUkdCIHtcclxuICBjb25zdCBsYWIgPSBMQUIuZnJvbVhZWihzUkdCLnRvWFlaKHZhbHVlKSlcclxuICBsYWJbMF0gPSBsYWJbMF0gKyBhbW91bnQgKiAxMFxyXG4gIHJldHVybiBzUkdCLmZyb21YWVooTEFCLnRvWFlaKGxhYikpXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRhcmtlbiAodmFsdWU6IFJHQiwgYW1vdW50OiBudW1iZXIpOiBSR0Ige1xyXG4gIGNvbnN0IGxhYiA9IExBQi5mcm9tWFlaKHNSR0IudG9YWVoodmFsdWUpKVxyXG4gIGxhYlswXSA9IGxhYlswXSAtIGFtb3VudCAqIDEwXHJcbiAgcmV0dXJuIHNSR0IuZnJvbVhZWihMQUIudG9YWVoobGFiKSlcclxufVxyXG4iXX0=