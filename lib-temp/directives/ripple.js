import { consoleWarn } from '../util/console';
function transform(el, value) {
    el.style['transform'] = value;
    el.style['webkitTransform'] = value;
}
function opacity(el, value) {
    el.style['opacity'] = value.toString();
}
function isTouchEvent(e) {
    return e.constructor.name === 'TouchEvent';
}
const calculate = (e, el, value = {}) => {
    const offset = el.getBoundingClientRect();
    const target = isTouchEvent(e) ? e.touches[e.touches.length - 1] : e;
    const localX = target.clientX - offset.left;
    const localY = target.clientY - offset.top;
    let radius = 0;
    let scale = 0.3;
    if (el._ripple && el._ripple.circle) {
        scale = 0.15;
        radius = el.clientWidth / 2;
        radius = value.center ? radius : radius + Math.sqrt((localX - radius) ** 2 + (localY - radius) ** 2) / 4;
    }
    else {
        radius = Math.sqrt(el.clientWidth ** 2 + el.clientHeight ** 2) / 2;
    }
    const centerX = `${(el.clientWidth - (radius * 2)) / 2}px`;
    const centerY = `${(el.clientHeight - (radius * 2)) / 2}px`;
    const x = value.center ? centerX : `${localX - radius}px`;
    const y = value.center ? centerY : `${localY - radius}px`;
    return { radius, scale, x, y, centerX, centerY };
};
const ripple = {
    /* eslint-disable max-statements */
    show(e, el, value = {}) {
        if (!el._ripple || !el._ripple.enabled) {
            return;
        }
        const container = document.createElement('span');
        const animation = document.createElement('span');
        container.appendChild(animation);
        container.className = 'v-ripple__container';
        if (value.class) {
            container.className += ` ${value.class}`;
        }
        const { radius, scale, x, y, centerX, centerY } = calculate(e, el, value);
        const size = `${radius * 2}px`;
        animation.className = 'v-ripple__animation';
        animation.style.width = size;
        animation.style.height = size;
        el.appendChild(container);
        const computed = window.getComputedStyle(el);
        if (computed && computed.position === 'static') {
            el.style.position = 'relative';
            el.dataset.previousPosition = 'static';
        }
        animation.classList.add('v-ripple__animation--enter');
        animation.classList.add('v-ripple__animation--visible');
        transform(animation, `translate(${x}, ${y}) scale3d(${scale},${scale},${scale})`);
        opacity(animation, 0);
        animation.dataset.activated = String(performance.now());
        setTimeout(() => {
            animation.classList.remove('v-ripple__animation--enter');
            animation.classList.add('v-ripple__animation--in');
            transform(animation, `translate(${centerX}, ${centerY}) scale3d(1,1,1)`);
            opacity(animation, 0.25);
        }, 0);
    },
    hide(el) {
        if (!el || !el._ripple || !el._ripple.enabled)
            return;
        const ripples = el.getElementsByClassName('v-ripple__animation');
        if (ripples.length === 0)
            return;
        const animation = ripples[ripples.length - 1];
        if (animation.dataset.isHiding)
            return;
        else
            animation.dataset.isHiding = 'true';
        const diff = performance.now() - Number(animation.dataset.activated);
        const delay = Math.max(250 - diff, 0);
        setTimeout(() => {
            animation.classList.remove('v-ripple__animation--in');
            animation.classList.add('v-ripple__animation--out');
            opacity(animation, 0);
            setTimeout(() => {
                const ripples = el.getElementsByClassName('v-ripple__animation');
                if (ripples.length === 1 && el.dataset.previousPosition) {
                    el.style.position = el.dataset.previousPosition;
                    delete el.dataset.previousPosition;
                }
                animation.parentNode && el.removeChild(animation.parentNode);
            }, 300);
        }, delay);
    }
};
function isRippleEnabled(value) {
    return typeof value === 'undefined' || !!value;
}
function rippleShow(e) {
    const value = {};
    const element = e.currentTarget;
    if (!element || element._ripple.touched)
        return;
    if (isTouchEvent(e)) {
        element._ripple.touched = true;
    }
    value.center = element._ripple.centered;
    if (element._ripple.class) {
        value.class = element._ripple.class;
    }
    ripple.show(e, element, value);
}
function rippleHide(e) {
    const element = e.currentTarget;
    if (!element)
        return;
    window.setTimeout(() => {
        if (element._ripple) {
            element._ripple.touched = false;
        }
    });
    ripple.hide(element);
}
function updateRipple(el, binding, wasEnabled) {
    const enabled = isRippleEnabled(binding.value);
    if (!enabled) {
        ripple.hide(el);
    }
    el._ripple = el._ripple || {};
    el._ripple.enabled = enabled;
    const value = binding.value || {};
    if (value.center) {
        el._ripple.centered = true;
    }
    if (value.class) {
        el._ripple.class = binding.value.class;
    }
    if (value.circle) {
        el._ripple.circle = value.circle;
    }
    if (enabled && !wasEnabled) {
        el.addEventListener('touchstart', rippleShow, { passive: true });
        el.addEventListener('touchend', rippleHide, { passive: true });
        el.addEventListener('touchcancel', rippleHide);
        el.addEventListener('mousedown', rippleShow);
        el.addEventListener('mouseup', rippleHide);
        el.addEventListener('mouseleave', rippleHide);
        // Anchor tags can be dragged, causes other hides to fail - #1537
        el.addEventListener('dragstart', rippleHide, { passive: true });
    }
    else if (!enabled && wasEnabled) {
        removeListeners(el);
    }
}
function removeListeners(el) {
    el.removeEventListener('mousedown', rippleShow);
    el.removeEventListener('touchstart', rippleHide);
    el.removeEventListener('touchend', rippleHide);
    el.removeEventListener('touchcancel', rippleHide);
    el.removeEventListener('mouseup', rippleHide);
    el.removeEventListener('mouseleave', rippleHide);
    el.removeEventListener('dragstart', rippleHide);
}
function directive(el, binding, node) {
    updateRipple(el, binding, false);
    // warn if an inline element is used, waiting for el to be in the DOM first
    node.context && node.context.$nextTick(() => {
        const computed = window.getComputedStyle(el);
        if (computed && computed.display === 'inline') {
            const context = node.fnOptions ? [node.fnOptions, node.context] : [node.componentInstance];
            consoleWarn('v-ripple can only be used on block-level elements', ...context);
        }
    });
}
function unbind(el) {
    delete el._ripple;
    removeListeners(el);
}
function update(el, binding) {
    if (binding.value === binding.oldValue) {
        return;
    }
    const wasEnabled = isRippleEnabled(binding.oldValue);
    updateRipple(el, binding, wasEnabled);
}
export default {
    bind: directive,
    unbind,
    update
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmlwcGxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RpcmVjdGl2ZXMvcmlwcGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUU3QyxTQUFTLFNBQVMsQ0FBRSxFQUFlLEVBQUUsS0FBYTtJQUNoRCxFQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQTtJQUM3QixFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsS0FBSyxDQUFBO0FBQ3JDLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBRSxFQUFlLEVBQUUsS0FBYTtJQUM5QyxFQUFFLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQTtBQUN4QyxDQUFDO0FBUUQsU0FBUyxZQUFZLENBQUUsQ0FBMEI7SUFDL0MsT0FBTyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSyxZQUFZLENBQUE7QUFDNUMsQ0FBQztBQUVELE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBMEIsRUFBRSxFQUFlLEVBQUUsUUFBdUIsRUFBRSxFQUFFLEVBQUU7SUFDM0YsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUE7SUFDekMsTUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDcEUsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFBO0lBQzNDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQTtJQUUxQyxJQUFJLE1B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O0lBRWhDLDJFQUEyRTtJQUMzRSxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUMxQyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDNUMsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLE9BQU8sS0FBSyxRQUFRLEVBQUU7WUFDN0MsTUFBTSxPQUFPLEdBQUksSUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBRSxJQUFZLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtZQUM1RyxXQUFXLENBQUMsbURBQW1ELEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQTtTQUM3RTtJQUNILENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQztBQUVELFNBQVMsTUFBTSxDQUFFLEVBQWU7SUFDOUIsT0FBTyxFQUFFLENBQUMsT0FBTyxDQUFBO0lBQ2pCLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNyQixDQUFDO0FBRUQsU0FBUyxNQUFNLENBQUUsRUFBZSxFQUFFLE9BQXVCO0lBQ3ZELElBQUksT0FBTyxDQUFDLEtBQUssS0FBSyxPQUFPLENBQUMsUUFBUSxFQUFFO1FBQ3RDLE9BQU07S0FDUDtJQUVELE1BQU0sVUFBVSxHQUFHLGVBQWUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDcEQsWUFBWSxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUE7QUFDdkMsQ0FBQztBQUVELGVBQWU7SUFDYixJQUFJLEVBQUUsU0FBUztJQUNmLE1BQU07SUFDTixNQUFNO0NBQ1AsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZOb2RlLCBWTm9kZURpcmVjdGl2ZSB9IGZyb20gJ3Z1ZSdcclxuaW1wb3J0IHsgY29uc29sZVdhcm4gfSBmcm9tICcuLi91dGlsL2NvbnNvbGUnXHJcblxyXG5mdW5jdGlvbiB0cmFuc2Zvcm0gKGVsOiBIVE1MRWxlbWVudCwgdmFsdWU6IHN0cmluZykge1xyXG4gIGVsLnN0eWxlWyd0cmFuc2Zvcm0nXSA9IHZhbHVlXHJcbiAgZWwuc3R5bGVbJ3dlYmtpdFRyYW5zZm9ybSddID0gdmFsdWVcclxufVxyXG5cclxuZnVuY3Rpb24gb3BhY2l0eSAoZWw6IEhUTUxFbGVtZW50LCB2YWx1ZTogbnVtYmVyKSB7XHJcbiAgZWwuc3R5bGVbJ29wYWNpdHknXSA9IHZhbHVlLnRvU3RyaW5nKClcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSaXBwbGVPcHRpb25zIHtcclxuICBjbGFzcz86IHN0cmluZ1xyXG4gIGNlbnRlcj86IGJvb2xlYW5cclxuICBjaXJjbGU/OiBib29sZWFuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzVG91Y2hFdmVudCAoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpOiBlIGlzIFRvdWNoRXZlbnQge1xyXG4gIHJldHVybiBlLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdUb3VjaEV2ZW50J1xyXG59XHJcblxyXG5jb25zdCBjYWxjdWxhdGUgPSAoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQsIGVsOiBIVE1MRWxlbWVudCwgdmFsdWU6IFJpcHBsZU9wdGlvbnMgPSB7fSkgPT4ge1xyXG4gIGNvbnN0IG9mZnNldCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXHJcbiAgY29uc3QgdGFyZ2V0ID0gaXNUb3VjaEV2ZW50KGUpID8gZS50b3VjaGVzW2UudG91Y2hlcy5sZW5ndGggLSAxXSA6IGVcclxuICBjb25zdCBsb2NhbFggPSB0YXJnZXQuY2xpZW50WCAtIG9mZnNldC5sZWZ0XHJcbiAgY29uc3QgbG9jYWxZID0gdGFyZ2V0LmNsaWVudFkgLSBvZmZzZXQudG9wXHJcblxyXG4gIGxldCByYWRpdXMgPSAwXHJcbiAgbGV0IHNjYWxlID0gMC4zXHJcbiAgaWYgKGVsLl9yaXBwbGUgJiYgZWwuX3JpcHBsZS5jaXJjbGUpIHtcclxuICAgIHNjYWxlID0gMC4xNVxyXG4gICAgcmFkaXVzID0gZWwuY2xpZW50V2lkdGggLyAyXHJcbiAgICByYWRpdXMgPSB2YWx1ZS5jZW50ZXIgPyByYWRpdXMgOiByYWRpdXMgKyBNYXRoLnNxcnQoKGxvY2FsWCAtIHJhZGl1cykgKiogMiArIChsb2NhbFkgLSByYWRpdXMpICoqIDIpIC8gNFxyXG4gIH0gZWxzZSB7XHJcbiAgICByYWRpdXMgPSBNYXRoLnNxcnQoZWwuY2xpZW50V2lkdGggKiogMiArIGVsLmNsaWVudEhlaWdodCAqKiAyKSAvIDJcclxuICB9XHJcblxyXG4gIGNvbnN0IGNlbnRlclggPSBgJHsoZWwuY2xpZW50V2lkdGggLSAocmFkaXVzICogMikpIC8gMn1weGBcclxuICBjb25zdCBjZW50ZXJZID0gYCR7KGVsLmNsaWVudEhlaWdodCAtIChyYWRpdXMgKiAyKSkgLyAyfXB4YFxyXG5cclxuICBjb25zdCB4ID0gdmFsdWUuY2VudGVyID8gY2VudGVyWCA6IGAke2xvY2FsWCAtIHJhZGl1c31weGBcclxuICBjb25zdCB5ID0gdmFsdWUuY2VudGVyID8gY2VudGVyWSA6IGAke2xvY2FsWSAtIHJhZGl1c31weGBcclxuXHJcbiAgcmV0dXJuIHsgcmFkaXVzLCBzY2FsZSwgeCwgeSwgY2VudGVyWCwgY2VudGVyWSB9XHJcbn1cclxuXHJcbmNvbnN0IHJpcHBsZSA9IHtcclxuICAvKiBlc2xpbnQtZGlzYWJsZSBtYXgtc3RhdGVtZW50cyAqL1xyXG4gIHNob3cgKGU6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50LCBlbDogSFRNTEVsZW1lbnQsIHZhbHVlOiBSaXBwbGVPcHRpb25zID0ge30pIHtcclxuICAgIGlmICghZWwuX3JpcHBsZSB8fCAhZWwuX3JpcHBsZS5lbmFibGVkKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxyXG4gICAgY29uc3QgYW5pbWF0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXHJcblxyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGFuaW1hdGlvbilcclxuICAgIGNvbnRhaW5lci5jbGFzc05hbWUgPSAndi1yaXBwbGVfX2NvbnRhaW5lcidcclxuXHJcbiAgICBpZiAodmFsdWUuY2xhc3MpIHtcclxuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSArPSBgICR7dmFsdWUuY2xhc3N9YFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgcmFkaXVzLCBzY2FsZSwgeCwgeSwgY2VudGVyWCwgY2VudGVyWSB9ID0gY2FsY3VsYXRlKGUsIGVsLCB2YWx1ZSlcclxuXHJcbiAgICBjb25zdCBzaXplID0gYCR7cmFkaXVzICogMn1weGBcclxuICAgIGFuaW1hdGlvbi5jbGFzc05hbWUgPSAndi1yaXBwbGVfX2FuaW1hdGlvbidcclxuICAgIGFuaW1hdGlvbi5zdHlsZS53aWR0aCA9IHNpemVcclxuICAgIGFuaW1hdGlvbi5zdHlsZS5oZWlnaHQgPSBzaXplXHJcblxyXG4gICAgZWwuYXBwZW5kQ2hpbGQoY29udGFpbmVyKVxyXG5cclxuICAgIGNvbnN0IGNvbXB1dGVkID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpXHJcbiAgICBpZiAoY29tcHV0ZWQgJiYgY29tcHV0ZWQucG9zaXRpb24gPT09ICdzdGF0aWMnKSB7XHJcbiAgICAgIGVsLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJ1xyXG4gICAgICBlbC5kYXRhc2V0LnByZXZpb3VzUG9zaXRpb24gPSAnc3RhdGljJ1xyXG4gICAgfVxyXG5cclxuICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QuYWRkKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1lbnRlcicpXHJcbiAgICBhbmltYXRpb24uY2xhc3NMaXN0LmFkZCgndi1yaXBwbGVfX2FuaW1hdGlvbi0tdmlzaWJsZScpXHJcbiAgICB0cmFuc2Zvcm0oYW5pbWF0aW9uLCBgdHJhbnNsYXRlKCR7eH0sICR7eX0pIHNjYWxlM2QoJHtzY2FsZX0sJHtzY2FsZX0sJHtzY2FsZX0pYClcclxuICAgIG9wYWNpdHkoYW5pbWF0aW9uLCAwKVxyXG4gICAgYW5pbWF0aW9uLmRhdGFzZXQuYWN0aXZhdGVkID0gU3RyaW5nKHBlcmZvcm1hbmNlLm5vdygpKVxyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBhbmltYXRpb24uY2xhc3NMaXN0LnJlbW92ZSgndi1yaXBwbGVfX2FuaW1hdGlvbi0tZW50ZXInKVxyXG4gICAgICBhbmltYXRpb24uY2xhc3NMaXN0LmFkZCgndi1yaXBwbGVfX2FuaW1hdGlvbi0taW4nKVxyXG4gICAgICB0cmFuc2Zvcm0oYW5pbWF0aW9uLCBgdHJhbnNsYXRlKCR7Y2VudGVyWH0sICR7Y2VudGVyWX0pIHNjYWxlM2QoMSwxLDEpYClcclxuICAgICAgb3BhY2l0eShhbmltYXRpb24sIDAuMjUpXHJcbiAgICB9LCAwKVxyXG4gIH0sXHJcblxyXG4gIGhpZGUgKGVsOiBIVE1MRWxlbWVudCB8IG51bGwpIHtcclxuICAgIGlmICghZWwgfHwgIWVsLl9yaXBwbGUgfHwgIWVsLl9yaXBwbGUuZW5hYmxlZCkgcmV0dXJuXHJcblxyXG4gICAgY29uc3QgcmlwcGxlcyA9IGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3YtcmlwcGxlX19hbmltYXRpb24nKVxyXG5cclxuICAgIGlmIChyaXBwbGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuXHJcbiAgICBjb25zdCBhbmltYXRpb24gPSByaXBwbGVzW3JpcHBsZXMubGVuZ3RoIC0gMV1cclxuXHJcbiAgICBpZiAoYW5pbWF0aW9uLmRhdGFzZXQuaXNIaWRpbmcpIHJldHVyblxyXG4gICAgZWxzZSBhbmltYXRpb24uZGF0YXNldC5pc0hpZGluZyA9ICd0cnVlJ1xyXG5cclxuICAgIGNvbnN0IGRpZmYgPSBwZXJmb3JtYW5jZS5ub3coKSAtIE51bWJlcihhbmltYXRpb24uZGF0YXNldC5hY3RpdmF0ZWQpXHJcbiAgICBjb25zdCBkZWxheSA9IE1hdGgubWF4KDI1MCAtIGRpZmYsIDApXHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1pbicpXHJcbiAgICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QuYWRkKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1vdXQnKVxyXG4gICAgICBvcGFjaXR5KGFuaW1hdGlvbiwgMClcclxuXHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJpcHBsZXMgPSBlbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd2LXJpcHBsZV9fYW5pbWF0aW9uJylcclxuICAgICAgICBpZiAocmlwcGxlcy5sZW5ndGggPT09IDEgJiYgZWwuZGF0YXNldC5wcmV2aW91c1Bvc2l0aW9uKSB7XHJcbiAgICAgICAgICBlbC5zdHlsZS5wb3NpdGlvbiA9IGVsLmRhdGFzZXQucHJldmlvdXNQb3NpdGlvblxyXG4gICAgICAgICAgZGVsZXRlIGVsLmRhdGFzZXQucHJldmlvdXNQb3NpdGlvblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYW5pbWF0aW9uLnBhcmVudE5vZGUgJiYgZWwucmVtb3ZlQ2hpbGQoYW5pbWF0aW9uLnBhcmVudE5vZGUpXHJcbiAgICAgIH0sIDMwMClcclxuICAgIH0sIGRlbGF5KVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaXNSaXBwbGVFbmFibGVkICh2YWx1ZTogYW55KTogdmFsdWUgaXMgdHJ1ZSB7XHJcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgISF2YWx1ZVxyXG59XHJcblxyXG5mdW5jdGlvbiByaXBwbGVTaG93IChlOiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xyXG4gIGNvbnN0IHZhbHVlOiBSaXBwbGVPcHRpb25zID0ge31cclxuICBjb25zdCBlbGVtZW50ID0gZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50XHJcbiAgaWYgKCFlbGVtZW50IHx8IGVsZW1lbnQuX3JpcHBsZSEudG91Y2hlZCkgcmV0dXJuXHJcbiAgaWYgKGlzVG91Y2hFdmVudChlKSkge1xyXG4gICAgZWxlbWVudC5fcmlwcGxlIS50b3VjaGVkID0gdHJ1ZVxyXG4gIH1cclxuICB2YWx1ZS5jZW50ZXIgPSBlbGVtZW50Ll9yaXBwbGUhLmNlbnRlcmVkXHJcbiAgaWYgKGVsZW1lbnQuX3JpcHBsZSEuY2xhc3MpIHtcclxuICAgIHZhbHVlLmNsYXNzID0gZWxlbWVudC5fcmlwcGxlIS5jbGFzc1xyXG4gIH1cclxuICByaXBwbGUuc2hvdyhlLCBlbGVtZW50LCB2YWx1ZSlcclxufVxyXG5cclxuZnVuY3Rpb24gcmlwcGxlSGlkZSAoZTogRXZlbnQpIHtcclxuICBjb25zdCBlbGVtZW50ID0gZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50IHwgbnVsbFxyXG4gIGlmICghZWxlbWVudCkgcmV0dXJuXHJcblxyXG4gIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgIGlmIChlbGVtZW50Ll9yaXBwbGUpIHtcclxuICAgICAgZWxlbWVudC5fcmlwcGxlLnRvdWNoZWQgPSBmYWxzZVxyXG4gICAgfVxyXG4gIH0pXHJcbiAgcmlwcGxlLmhpZGUoZWxlbWVudClcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlUmlwcGxlIChlbDogSFRNTEVsZW1lbnQsIGJpbmRpbmc6IFZOb2RlRGlyZWN0aXZlLCB3YXNFbmFibGVkOiBib29sZWFuKSB7XHJcbiAgY29uc3QgZW5hYmxlZCA9IGlzUmlwcGxlRW5hYmxlZChiaW5kaW5nLnZhbHVlKVxyXG4gIGlmICghZW5hYmxlZCkge1xyXG4gICAgcmlwcGxlLmhpZGUoZWwpXHJcbiAgfVxyXG4gIGVsLl9yaXBwbGUgPSBlbC5fcmlwcGxlIHx8IHt9XHJcbiAgZWwuX3JpcHBsZS5lbmFibGVkID0gZW5hYmxlZFxyXG4gIGNvbnN0IHZhbHVlID0gYmluZGluZy52YWx1ZSB8fCB7fVxyXG4gIGlmICh2YWx1ZS5jZW50ZXIpIHtcclxuICAgIGVsLl9yaXBwbGUuY2VudGVyZWQgPSB0cnVlXHJcbiAgfVxyXG4gIGlmICh2YWx1ZS5jbGFzcykge1xyXG4gICAgZWwuX3JpcHBsZS5jbGFzcyA9IGJpbmRpbmcudmFsdWUuY2xhc3NcclxuICB9XHJcbiAgaWYgKHZhbHVlLmNpcmNsZSkge1xyXG4gICAgZWwuX3JpcHBsZS5jaXJjbGUgPSB2YWx1ZS5jaXJjbGVcclxuICB9XHJcbiAgaWYgKGVuYWJsZWQgJiYgIXdhc0VuYWJsZWQpIHtcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCByaXBwbGVTaG93LCB7IHBhc3NpdmU6IHRydWUgfSlcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgcmlwcGxlSGlkZSwgeyBwYXNzaXZlOiB0cnVlIH0pXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIHJpcHBsZUhpZGUpXHJcblxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgcmlwcGxlU2hvdylcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCByaXBwbGVIaWRlKVxyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHJpcHBsZUhpZGUpXHJcbiAgICAvLyBBbmNob3IgdGFncyBjYW4gYmUgZHJhZ2dlZCwgY2F1c2VzIG90aGVyIGhpZGVzIHRvIGZhaWwgLSAjMTUzN1xyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgcmlwcGxlSGlkZSwgeyBwYXNzaXZlOiB0cnVlIH0pXHJcbiAgfSBlbHNlIGlmICghZW5hYmxlZCAmJiB3YXNFbmFibGVkKSB7XHJcbiAgICByZW1vdmVMaXN0ZW5lcnMoZWwpXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVMaXN0ZW5lcnMgKGVsOiBIVE1MRWxlbWVudCkge1xyXG4gIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHJpcHBsZVNob3cpXHJcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHJpcHBsZUhpZGUpXHJcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCByaXBwbGVIaWRlKVxyXG4gIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgcmlwcGxlSGlkZSlcclxuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgcmlwcGxlSGlkZSlcclxuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgcmlwcGxlSGlkZSlcclxuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCByaXBwbGVIaWRlKVxyXG59XHJcblxyXG5mdW5jdGlvbiBkaXJlY3RpdmUgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVk5vZGVEaXJlY3RpdmUsIG5vZGU6IFZOb2RlKSB7XHJcbiAgdXBkYXRlUmlwcGxlKGVsLCBiaW5kaW5nLCBmYWxzZSlcclxuXHJcbiAgLy8gd2FybiBpZiBhbiBpbmxpbmUgZWxlbWVudCBpcyB1c2VkLCB3YWl0aW5nIGZvciBlbCB0byBiZSBpbiB0aGUgRE9NIGZpcnN0XHJcbiAgbm9kZS5jb250ZXh0ICYmIG5vZGUuY29udGV4dC4kbmV4dFRpY2soKCkgPT4ge1xyXG4gICAgY29uc3QgY29tcHV0ZWQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbClcclxuICAgIGlmIChjb21wdXRlZCAmJiBjb21wdXRlZC5kaXNwbGF5ID09PSAnaW5saW5lJykge1xyXG4gICAgICBjb25zdCBjb250ZXh0ID0gKG5vZGUgYXMgYW55KS5mbk9wdGlvbnMgPyBbKG5vZGUgYXMgYW55KS5mbk9wdGlvbnMsIG5vZGUuY29udGV4dF0gOiBbbm9kZS5jb21wb25lbnRJbnN0YW5jZV1cclxuICAgICAgY29uc29sZVdhcm4oJ3YtcmlwcGxlIGNhbiBvbmx5IGJlIHVzZWQgb24gYmxvY2stbGV2ZWwgZWxlbWVudHMnLCAuLi5jb250ZXh0KVxyXG4gICAgfVxyXG4gIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVuYmluZCAoZWw6IEhUTUxFbGVtZW50KSB7XHJcbiAgZGVsZXRlIGVsLl9yaXBwbGVcclxuICByZW1vdmVMaXN0ZW5lcnMoZWwpXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZSAoZWw6IEhUTUxFbGVtZW50LCBiaW5kaW5nOiBWTm9kZURpcmVjdGl2ZSkge1xyXG4gIGlmIChiaW5kaW5nLnZhbHVlID09PSBiaW5kaW5nLm9sZFZhbHVlKSB7XHJcbiAgICByZXR1cm5cclxuICB9XHJcblxyXG4gIGNvbnN0IHdhc0VuYWJsZWQgPSBpc1JpcHBsZUVuYWJsZWQoYmluZGluZy5vbGRWYWx1ZSlcclxuICB1cGRhdGVSaXBwbGUoZWwsIGJpbmRpbmcsIHdhc0VuYWJsZWQpXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICBiaW5kOiBkaXJlY3RpdmUsXHJcbiAgdW5iaW5kLFxyXG4gIHVwZGF0ZVxyXG59XHJcbiJdfQ==