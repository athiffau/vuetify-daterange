import '../../../stylus/components/_date-picker-table.styl';
// Directives
import Touch from '../../../directives/touch';
// Mixins
import Colorable from '../../../mixins/colorable';
import Themeable from '../../../mixins/themeable';
// Utils
import isDateAllowed from '../util/isDateAllowed';
import isDateInRange from '../util/isDateInRange';
import mixins from '../../../util/mixins';
export default mixins(Colorable, Themeable
/* @vue/component */
).extend({
    directives: { Touch },
    props: {
        allowedDates: Function,
        current: String,
        disabled: Boolean,
        format: Function,
        events: {
            type: [Array, Function, Object],
            default: () => null
        },
        eventColor: {
            type: [Array, Function, Object, String],
            default: () => 'warning'
        },
        locale: {
            type: String,
            default: 'en-us'
        },
        min: String,
        max: String,
        readonly: Boolean,
        scrollable: Boolean,
        tableDate: {
            type: String,
            required: true
        },
        value: [String, Array]
    },
    data: () => ({
        isReversing: false
    }),
    computed: {
        computedTransition() {
            return (this.isReversing === !this.$vuetify.rtl) ? 'tab-reverse-transition' : 'tab-transition';
        },
        displayedMonth() {
            return Number(this.tableDate.split('-')[1]) - 1;
        },
        displayedYear() {
            return Number(this.tableDate.split('-')[0]);
        }
    },
    watch: {
        tableDate(newVal, oldVal) {
            this.isReversing = newVal < oldVal;
        }
    },
    methods: {
        genButtonClasses(isAllowed, isFloating, isSelected, isCurrent) {
            return {
                'v-btn--active': isSelected,
                'v-btn--flat': !isSelected,
                'v-btn--icon': isSelected && isAllowed && isFloating,
                'v-btn--floating': isFloating,
                'v-btn--depressed': !isFloating && isSelected,
                'v-btn--disabled': !isAllowed || (this.disabled && isSelected),
                'v-btn--outline': isCurrent && !isSelected,
                ...this.themeClasses
            };
        },
        genButtonEvents(value, isAllowed, mouseEventType) {
            if (this.disabled)
                return undefined;
            return {
                click: () => {
                    isAllowed && !this.readonly && this.$emit('input', value);
                    this.$emit(`click:${mouseEventType}`, value);
                },
                dblclick: () => this.$emit(`dblclick:${mouseEventType}`, value)
            };
        },
        genButton(value, isFloating, mouseEventType, formatter) {
            const isAllowed = isDateAllowed(value, this.min, this.max, this.allowedDates);
            const isSelected = value === this.value || (Array.isArray(this.value) && this.value.indexOf(value) !== -1);
            const isCurrent = value === this.current;
            const setColor = isSelected ? this.setBackgroundColor : this.setTextColor;
            //AT -> Added support for date-range
            //const color = (isSelected || isCurrent) && (this.color || 'accent')
            const color = this.getFinalColor(value, (isSelected || isCurrent) && (this.color || 'accent'));
            return this.$createElement('button', setColor(color, {
                staticClass: 'v-btn',
                'class': this.genButtonClasses(isAllowed, isFloating, isSelected, isCurrent),
                attrs: {
                    type: 'button'
                },
                domProps: {
                    disabled: this.disabled || !isAllowed
                },
                on: this.genButtonEvents(value, isAllowed, mouseEventType)
            }), [
                this.$createElement('div', {
                    staticClass: 'v-btn__content'
                }, [formatter(value)]),
                this.genEvents(value)
            ]);
        },
        getFinalColor(date, color) {
            //AT -> Added support for date-range
            const colorInRange = Array.isArray(this.value) && isDateInRange(date, this.value);
            const colorRangeNode = Array.isArray(this.value) && (this.value.indexOf(date) === 0 || date === this.value[this.value.length - 1]);
            return colorRangeNode ? 'accent darken-4' : colorInRange ? 'accent darken-2' : color;
        },
        getEventColors(date) {
            const arrayize = (v) => Array.isArray(v) ? v : [v];
            let eventData;
            let eventColors = [];
            if (Array.isArray(this.events)) {
                eventData = this.events.includes(date);
            }
            else if (this.events instanceof Function) {
                eventData = this.events(date) || false;
            }
            else if (this.events) {
                eventData = this.events[date] || false;
            }
            else {
                eventData = false;
            }
            if (!eventData) {
                return [];
            }
            else if (eventData !== true) {
                eventColors = arrayize(eventData);
            }
            else if (typeof this.eventColor === 'string') {
                eventColors = [this.eventColor];
            }
            else if (typeof this.eventColor === 'function') {
                eventColors = arrayize(this.eventColor(date));
            }
            else if (Array.isArray(this.eventColor)) {
                eventColors = this.eventColor;
            }
            else {
                eventColors = arrayize(this.eventColor[date]);
            }
            return eventColors.filter(v => v);
        },
        genEvents(date) {
            const eventColors = this.getEventColors(date);
            return eventColors.length ? this.$createElement('div', {
                staticClass: 'v-date-picker-table__events'
            }, eventColors.map(color => this.$createElement('div', this.setBackgroundColor(color)))) : null;
        },
        wheel(e, calculateTableDate) {
            e.preventDefault();
            this.$emit('tableDate', calculateTableDate(e.deltaY));
        },
        touch(value, calculateTableDate) {
            this.$emit('tableDate', calculateTableDate(value));
        },
        genTable(staticClass, children, calculateTableDate) {
            const transition = this.$createElement('transition', {
                props: { name: this.computedTransition }
            }, [this.$createElement('table', { key: this.tableDate }, children)]);
            const touchDirective = {
                name: 'touch',
                value: {
                    left: (e) => (e.offsetX < -15) && this.touch(1, calculateTableDate),
                    right: (e) => (e.offsetX > 15) && this.touch(-1, calculateTableDate)
                }
            };
            return this.$createElement('div', {
                staticClass,
                class: {
                    'v-date-picker-table--disabled': this.disabled,
                    ...this.themeClasses
                },
                on: (!this.disabled && this.scrollable) ? {
                    wheel: (e) => this.wheel(e, calculateTableDate)
                } : undefined,
                directives: [touchDirective]
            }, [transition]);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1waWNrZXItdGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WRGF0ZVBpY2tlci9taXhpbnMvZGF0ZS1waWNrZXItdGFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxvREFBb0QsQ0FBQTtBQUUzRCxhQUFhO0FBQ2IsT0FBTyxLQUF1QixNQUFNLDJCQUEyQixDQUFBO0FBRS9ELFNBQVM7QUFDVCxPQUFPLFNBQVMsTUFBTSwyQkFBMkIsQ0FBQTtBQUNqRCxPQUFPLFNBQVMsTUFBTSwyQkFBMkIsQ0FBQTtBQUVqRCxRQUFRO0FBQ1IsT0FBTyxhQUFzQyxNQUFNLHVCQUF1QixDQUFBO0FBQzFFLE9BQU8sYUFBYSxNQUFNLHVCQUF1QixDQUFBO0FBQ2pELE9BQU8sTUFBTSxNQUFNLHNCQUFzQixDQUFBO0FBVXpDLGVBQWUsTUFBTSxDQUNuQixTQUFTLEVBQ1QsU0FBUztBQUNYLG9CQUFvQjtDQUNuQixDQUFDLE1BQU0sQ0FBQztJQUNQLFVBQVUsRUFBRSxFQUFFLEtBQUssRUFBRTtJQUVyQixLQUFLLEVBQUU7UUFDTCxZQUFZLEVBQUUsUUFBMEQ7UUFDeEUsT0FBTyxFQUFFLE1BQU07UUFDZixRQUFRLEVBQUUsT0FBTztRQUNqQixNQUFNLEVBQUUsUUFBMEQ7UUFDbEUsTUFBTSxFQUFFO1lBQ04sSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUM7WUFDL0IsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUk7U0FDZ0I7UUFDckMsVUFBVSxFQUFFO1lBQ1YsSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDO1lBQ3ZDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxTQUFTO1NBQ2dCO1FBQzFDLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLE9BQU87U0FDakI7UUFDRCxHQUFHLEVBQUUsTUFBTTtRQUNYLEdBQUcsRUFBRSxNQUFNO1FBQ1gsUUFBUSxFQUFFLE9BQU87UUFDakIsVUFBVSxFQUFFLE9BQU87UUFDbkIsU0FBUyxFQUFFO1lBQ1QsSUFBSSxFQUFFLE1BQU07WUFDWixRQUFRLEVBQUUsSUFBSTtTQUNmO1FBQ0QsS0FBSyxFQUFFLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQztLQUN2QjtJQUVELElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ1gsV0FBVyxFQUFFLEtBQUs7S0FDbkIsQ0FBQztJQUVGLFFBQVEsRUFBRTtRQUNSLGtCQUFrQjtZQUNoQixPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQTtRQUNoRyxDQUFDO1FBQ0QsY0FBYztZQUNaLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2pELENBQUM7UUFDRCxhQUFhO1lBQ1gsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUM3QyxDQUFDO0tBQ0Y7SUFFRCxLQUFLLEVBQUU7UUFDTCxTQUFTLENBQUUsTUFBYyxFQUFFLE1BQWM7WUFDdkMsSUFBSSxDQUFDLFdBQVcsR0FBRyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BDLENBQUM7S0FDRjtJQUVELE9BQU8sRUFBRTtRQUNQLGdCQUFnQixDQUFFLFNBQWtCLEVBQUUsVUFBbUIsRUFBRSxVQUFtQixFQUFFLFNBQWtCO1lBQ2hHLE9BQU87Z0JBQ0wsZUFBZSxFQUFFLFVBQVU7Z0JBQzNCLGFBQWEsRUFBRSxDQUFDLFVBQVU7Z0JBQzFCLGFBQWEsRUFBRSxVQUFVLElBQUksU0FBUyxJQUFJLFVBQVU7Z0JBQ3BELGlCQUFpQixFQUFFLFVBQVU7Z0JBQzdCLGtCQUFrQixFQUFFLENBQUMsVUFBVSxJQUFJLFVBQVU7Z0JBQzdDLGlCQUFpQixFQUFFLENBQUMsU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxVQUFVLENBQUM7Z0JBQzlELGdCQUFnQixFQUFFLFNBQVMsSUFBSSxDQUFDLFVBQVU7Z0JBQzFDLEdBQUcsSUFBSSxDQUFDLFlBQVk7YUFDckIsQ0FBQTtRQUNILENBQUM7UUFDRCxlQUFlLENBQUUsS0FBYSxFQUFFLFNBQWtCLEVBQUUsY0FBc0I7WUFDeEUsSUFBSSxJQUFJLENBQUMsUUFBUTtnQkFBRSxPQUFPLFNBQVMsQ0FBQTtZQUVuQyxPQUFPO2dCQUNMLEtBQUssRUFBRSxHQUFHLEVBQUU7b0JBQ1YsU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQTtvQkFDekQsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLGNBQWMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFBO2dCQUM5QyxDQUFDO2dCQUNELFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksY0FBYyxFQUFFLEVBQUUsS0FBSyxDQUFDO2FBQ2hFLENBQUE7UUFDSCxDQUFDO1FBQ0QsU0FBUyxDQUFFLEtBQWEsRUFBRSxVQUFtQixFQUFFLGNBQXNCLEVBQUUsU0FBOEI7WUFDbkcsTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQzdFLE1BQU0sVUFBVSxHQUFHLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUMxRyxNQUFNLFNBQVMsR0FBRyxLQUFLLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQTtZQUN4QyxNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQTtZQUV6RSxvQ0FBb0M7WUFDcEMscUVBQXFFO1lBQ3JFLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUMsVUFBVSxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFBO1lBRTlGLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLEtBQUssRUFBRTtnQkFDbkQsV0FBVyxFQUFFLE9BQU87Z0JBQ3BCLE9BQU8sRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsU0FBUyxDQUFDO2dCQUM1RSxLQUFLLEVBQUU7b0JBQ0wsSUFBSSxFQUFFLFFBQVE7aUJBQ2Y7Z0JBQ0QsUUFBUSxFQUFFO29CQUNSLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsU0FBUztpQkFDdEM7Z0JBQ0QsRUFBRSxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxjQUFjLENBQUM7YUFDM0QsQ0FBQyxFQUFFO2dCQUNGLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFO29CQUN6QixXQUFXLEVBQUUsZ0JBQWdCO2lCQUM5QixFQUFFLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3RCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO2FBQ3RCLENBQUMsQ0FBQTtRQUNKLENBQUM7UUFDRCxhQUFhLENBQUUsSUFBWSxFQUFFLEtBQXFCO1lBQ2hELG9DQUFvQztZQUNwQyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUNqRixNQUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ2pJLE9BQU8sY0FBYyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFBO1FBQ3RGLENBQUM7UUFDRCxjQUFjLENBQUUsSUFBWTtZQUMxQixNQUFNLFFBQVEsR0FBRyxDQUFDLENBQW9CLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUNyRSxJQUFJLFNBQXdDLENBQUE7WUFDNUMsSUFBSSxXQUFXLEdBQWEsRUFBRSxDQUFBO1lBRTlCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzlCLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTthQUN2QztpQkFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLFlBQVksUUFBUSxFQUFFO2dCQUMxQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUE7YUFDdkM7aUJBQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUN0QixTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUE7YUFDdkM7aUJBQU07Z0JBQ0wsU0FBUyxHQUFHLEtBQUssQ0FBQTthQUNsQjtZQUVELElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ2QsT0FBTyxFQUFFLENBQUE7YUFDVjtpQkFBTSxJQUFJLFNBQVMsS0FBSyxJQUFJLEVBQUU7Z0JBQzdCLFdBQVcsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUE7YUFDbEM7aUJBQU0sSUFBSSxPQUFPLElBQUksQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFO2dCQUM5QyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUE7YUFDaEM7aUJBQU0sSUFBSSxPQUFPLElBQUksQ0FBQyxVQUFVLEtBQUssVUFBVSxFQUFFO2dCQUNoRCxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTthQUM5QztpQkFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUN6QyxXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTthQUM5QjtpQkFBTTtnQkFDTCxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTthQUM5QztZQUVELE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ25DLENBQUM7UUFDRCxTQUFTLENBQUUsSUFBWTtZQUNyQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFBO1lBRTdDLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUU7Z0JBQ3JELFdBQVcsRUFBRSw2QkFBNkI7YUFDM0MsRUFBRSxXQUFXLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUE7UUFDakcsQ0FBQztRQUNELEtBQUssQ0FBRSxDQUFhLEVBQUUsa0JBQThDO1lBQ2xFLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQTtZQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQTtRQUN2RCxDQUFDO1FBQ0QsS0FBSyxDQUFFLEtBQWEsRUFBRSxrQkFBOEM7WUFDbEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtRQUNwRCxDQUFDO1FBQ0QsUUFBUSxDQUFFLFdBQW1CLEVBQUUsUUFBdUIsRUFBRSxrQkFBOEM7WUFDcEcsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUU7Z0JBQ25ELEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7YUFDekMsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFFckUsTUFBTSxjQUFjLEdBQUc7Z0JBQ3JCLElBQUksRUFBRSxPQUFPO2dCQUNiLEtBQUssRUFBRTtvQkFDTCxJQUFJLEVBQUUsQ0FBQyxDQUFlLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLGtCQUFrQixDQUFDO29CQUNqRixLQUFLLEVBQUUsQ0FBQyxDQUFlLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLGtCQUFrQixDQUFDO2lCQUNuRjthQUNGLENBQUE7WUFFRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFO2dCQUNoQyxXQUFXO2dCQUNYLEtBQUssRUFBRTtvQkFDTCwrQkFBK0IsRUFBRSxJQUFJLENBQUMsUUFBUTtvQkFDOUMsR0FBRyxJQUFJLENBQUMsWUFBWTtpQkFDckI7Z0JBQ0QsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3hDLEtBQUssRUFBRSxDQUFDLENBQWEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUM7aUJBQzVELENBQUMsQ0FBQyxDQUFDLFNBQVM7Z0JBQ2IsVUFBVSxFQUFFLENBQUMsY0FBYyxDQUFDO2FBQzdCLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFBO1FBQ2xCLENBQUM7S0FDRjtDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi4vLi4vLi4vc3R5bHVzL2NvbXBvbmVudHMvX2RhdGUtcGlja2VyLXRhYmxlLnN0eWwnXHJcblxyXG4vLyBEaXJlY3RpdmVzXHJcbmltcG9ydCBUb3VjaCwgeyBUb3VjaFdyYXBwZXIgfSBmcm9tICcuLi8uLi8uLi9kaXJlY3RpdmVzL3RvdWNoJ1xyXG5cclxuLy8gTWl4aW5zXHJcbmltcG9ydCBDb2xvcmFibGUgZnJvbSAnLi4vLi4vLi4vbWl4aW5zL2NvbG9yYWJsZSdcclxuaW1wb3J0IFRoZW1lYWJsZSBmcm9tICcuLi8uLi8uLi9taXhpbnMvdGhlbWVhYmxlJ1xyXG5cclxuLy8gVXRpbHNcclxuaW1wb3J0IGlzRGF0ZUFsbG93ZWQsIHsgQWxsb3dlZERhdGVGdW5jdGlvbiB9IGZyb20gJy4uL3V0aWwvaXNEYXRlQWxsb3dlZCdcclxuaW1wb3J0IGlzRGF0ZUluUmFuZ2UgZnJvbSAnLi4vdXRpbC9pc0RhdGVJblJhbmdlJ1xyXG5pbXBvcnQgbWl4aW5zIGZyb20gJy4uLy4uLy4uL3V0aWwvbWl4aW5zJ1xyXG5cclxuLy8gVHlwZXNcclxuaW1wb3J0IHsgVk5vZGVDaGlsZHJlbiB9IGZyb20gJ3Z1ZSdcclxuaW1wb3J0IHsgUHJvcFZhbGlkYXRvciB9IGZyb20gJ3Z1ZS90eXBlcy9vcHRpb25zJ1xyXG5pbXBvcnQgeyBEYXRlUGlja2VyRm9ybWF0dGVyIH0gZnJvbSAnLi4vdXRpbC9jcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXInXHJcbmltcG9ydCB7IERhdGVFdmVudHMsIERhdGVFdmVudENvbG9ycywgRGF0ZUV2ZW50Q29sb3JWYWx1ZSB9IGZyb20gJy4uL1ZEYXRlUGlja2VyJ1xyXG5cclxudHlwZSBDYWxjdWxhdGVUYWJsZURhdGVGdW5jdGlvbiA9ICh2OiBudW1iZXIpID0+IHN0cmluZ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgbWl4aW5zKFxyXG4gIENvbG9yYWJsZSxcclxuICBUaGVtZWFibGVcclxuLyogQHZ1ZS9jb21wb25lbnQgKi9cclxuKS5leHRlbmQoe1xyXG4gIGRpcmVjdGl2ZXM6IHsgVG91Y2ggfSxcclxuXHJcbiAgcHJvcHM6IHtcclxuICAgIGFsbG93ZWREYXRlczogRnVuY3Rpb24gYXMgUHJvcFZhbGlkYXRvcjxBbGxvd2VkRGF0ZUZ1bmN0aW9uIHwgdW5kZWZpbmVkPixcclxuICAgIGN1cnJlbnQ6IFN0cmluZyxcclxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxyXG4gICAgZm9ybWF0OiBGdW5jdGlvbiBhcyBQcm9wVmFsaWRhdG9yPERhdGVQaWNrZXJGb3JtYXR0ZXIgfCB1bmRlZmluZWQ+LFxyXG4gICAgZXZlbnRzOiB7XHJcbiAgICAgIHR5cGU6IFtBcnJheSwgRnVuY3Rpb24sIE9iamVjdF0sXHJcbiAgICAgIGRlZmF1bHQ6ICgpID0+IG51bGxcclxuICAgIH0gYXMgYW55IGFzIFByb3BWYWxpZGF0b3I8RGF0ZUV2ZW50cz4sXHJcbiAgICBldmVudENvbG9yOiB7XHJcbiAgICAgIHR5cGU6IFtBcnJheSwgRnVuY3Rpb24sIE9iamVjdCwgU3RyaW5nXSxcclxuICAgICAgZGVmYXVsdDogKCkgPT4gJ3dhcm5pbmcnXHJcbiAgICB9IGFzIGFueSBhcyBQcm9wVmFsaWRhdG9yPERhdGVFdmVudENvbG9ycz4sXHJcbiAgICBsb2NhbGU6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAnZW4tdXMnXHJcbiAgICB9LFxyXG4gICAgbWluOiBTdHJpbmcsXHJcbiAgICBtYXg6IFN0cmluZyxcclxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxyXG4gICAgc2Nyb2xsYWJsZTogQm9vbGVhbixcclxuICAgIHRhYmxlRGF0ZToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgdmFsdWU6IFtTdHJpbmcsIEFycmF5XVxyXG4gIH0sXHJcblxyXG4gIGRhdGE6ICgpID0+ICh7XHJcbiAgICBpc1JldmVyc2luZzogZmFsc2VcclxuICB9KSxcclxuXHJcbiAgY29tcHV0ZWQ6IHtcclxuICAgIGNvbXB1dGVkVHJhbnNpdGlvbiAoKTogc3RyaW5nIHtcclxuICAgICAgcmV0dXJuICh0aGlzLmlzUmV2ZXJzaW5nID09PSAhdGhpcy4kdnVldGlmeS5ydGwpID8gJ3RhYi1yZXZlcnNlLXRyYW5zaXRpb24nIDogJ3RhYi10cmFuc2l0aW9uJ1xyXG4gICAgfSxcclxuICAgIGRpc3BsYXllZE1vbnRoICgpOiBudW1iZXIge1xyXG4gICAgICByZXR1cm4gTnVtYmVyKHRoaXMudGFibGVEYXRlLnNwbGl0KCctJylbMV0pIC0gMVxyXG4gICAgfSxcclxuICAgIGRpc3BsYXllZFllYXIgKCk6IG51bWJlciB7XHJcbiAgICAgIHJldHVybiBOdW1iZXIodGhpcy50YWJsZURhdGUuc3BsaXQoJy0nKVswXSlcclxuICAgIH1cclxuICB9LFxyXG5cclxuICB3YXRjaDoge1xyXG4gICAgdGFibGVEYXRlIChuZXdWYWw6IHN0cmluZywgb2xkVmFsOiBzdHJpbmcpIHtcclxuICAgICAgdGhpcy5pc1JldmVyc2luZyA9IG5ld1ZhbCA8IG9sZFZhbFxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIG1ldGhvZHM6IHtcclxuICAgIGdlbkJ1dHRvbkNsYXNzZXMgKGlzQWxsb3dlZDogYm9vbGVhbiwgaXNGbG9hdGluZzogYm9vbGVhbiwgaXNTZWxlY3RlZDogYm9vbGVhbiwgaXNDdXJyZW50OiBib29sZWFuKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgJ3YtYnRuLS1hY3RpdmUnOiBpc1NlbGVjdGVkLFxyXG4gICAgICAgICd2LWJ0bi0tZmxhdCc6ICFpc1NlbGVjdGVkLFxyXG4gICAgICAgICd2LWJ0bi0taWNvbic6IGlzU2VsZWN0ZWQgJiYgaXNBbGxvd2VkICYmIGlzRmxvYXRpbmcsXHJcbiAgICAgICAgJ3YtYnRuLS1mbG9hdGluZyc6IGlzRmxvYXRpbmcsXHJcbiAgICAgICAgJ3YtYnRuLS1kZXByZXNzZWQnOiAhaXNGbG9hdGluZyAmJiBpc1NlbGVjdGVkLFxyXG4gICAgICAgICd2LWJ0bi0tZGlzYWJsZWQnOiAhaXNBbGxvd2VkIHx8ICh0aGlzLmRpc2FibGVkICYmIGlzU2VsZWN0ZWQpLFxyXG4gICAgICAgICd2LWJ0bi0tb3V0bGluZSc6IGlzQ3VycmVudCAmJiAhaXNTZWxlY3RlZCxcclxuICAgICAgICAuLi50aGlzLnRoZW1lQ2xhc3Nlc1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgZ2VuQnV0dG9uRXZlbnRzICh2YWx1ZTogc3RyaW5nLCBpc0FsbG93ZWQ6IGJvb2xlYW4sIG1vdXNlRXZlbnRUeXBlOiBzdHJpbmcpIHtcclxuICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybiB1bmRlZmluZWRcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgY2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgIGlzQWxsb3dlZCAmJiAhdGhpcy5yZWFkb25seSAmJiB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKVxyXG4gICAgICAgICAgdGhpcy4kZW1pdChgY2xpY2s6JHttb3VzZUV2ZW50VHlwZX1gLCB2YWx1ZSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRibGNsaWNrOiAoKSA9PiB0aGlzLiRlbWl0KGBkYmxjbGljazoke21vdXNlRXZlbnRUeXBlfWAsIHZhbHVlKVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgZ2VuQnV0dG9uICh2YWx1ZTogc3RyaW5nLCBpc0Zsb2F0aW5nOiBib29sZWFuLCBtb3VzZUV2ZW50VHlwZTogc3RyaW5nLCBmb3JtYXR0ZXI6IERhdGVQaWNrZXJGb3JtYXR0ZXIpIHtcclxuICAgICAgY29uc3QgaXNBbGxvd2VkID0gaXNEYXRlQWxsb3dlZCh2YWx1ZSwgdGhpcy5taW4sIHRoaXMubWF4LCB0aGlzLmFsbG93ZWREYXRlcylcclxuICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IHZhbHVlID09PSB0aGlzLnZhbHVlIHx8IChBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpICYmIHRoaXMudmFsdWUuaW5kZXhPZih2YWx1ZSkgIT09IC0xKVxyXG4gICAgICBjb25zdCBpc0N1cnJlbnQgPSB2YWx1ZSA9PT0gdGhpcy5jdXJyZW50XHJcbiAgICAgIGNvbnN0IHNldENvbG9yID0gaXNTZWxlY3RlZCA/IHRoaXMuc2V0QmFja2dyb3VuZENvbG9yIDogdGhpcy5zZXRUZXh0Q29sb3JcclxuXHJcbiAgICAgIC8vQVQgLT4gQWRkZWQgc3VwcG9ydCBmb3IgZGF0ZS1yYW5nZVxyXG4gICAgICAvL2NvbnN0IGNvbG9yID0gKGlzU2VsZWN0ZWQgfHwgaXNDdXJyZW50KSAmJiAodGhpcy5jb2xvciB8fCAnYWNjZW50JylcclxuICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmdldEZpbmFsQ29sb3IodmFsdWUsIChpc1NlbGVjdGVkIHx8IGlzQ3VycmVudCkgJiYgKHRoaXMuY29sb3IgfHwgJ2FjY2VudCcpKVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicsIHNldENvbG9yKGNvbG9yLCB7XHJcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWJ0bicsXHJcbiAgICAgICAgJ2NsYXNzJzogdGhpcy5nZW5CdXR0b25DbGFzc2VzKGlzQWxsb3dlZCwgaXNGbG9hdGluZywgaXNTZWxlY3RlZCwgaXNDdXJyZW50KSxcclxuICAgICAgICBhdHRyczoge1xyXG4gICAgICAgICAgdHlwZTogJ2J1dHRvbidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRvbVByb3BzOiB7XHJcbiAgICAgICAgICBkaXNhYmxlZDogdGhpcy5kaXNhYmxlZCB8fCAhaXNBbGxvd2VkXHJcbiAgICAgICAgfSxcclxuICAgICAgICBvbjogdGhpcy5nZW5CdXR0b25FdmVudHModmFsdWUsIGlzQWxsb3dlZCwgbW91c2VFdmVudFR5cGUpXHJcbiAgICAgIH0pLCBbXHJcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xyXG4gICAgICAgICAgc3RhdGljQ2xhc3M6ICd2LWJ0bl9fY29udGVudCdcclxuICAgICAgICB9LCBbZm9ybWF0dGVyKHZhbHVlKV0pLFxyXG4gICAgICAgIHRoaXMuZ2VuRXZlbnRzKHZhbHVlKVxyXG4gICAgICBdKVxyXG4gICAgfSxcclxuICAgIGdldEZpbmFsQ29sb3IgKGRhdGU6IHN0cmluZywgY29sb3I6IHN0cmluZyB8IGZhbHNlKSB7XHJcbiAgICAgIC8vQVQgLT4gQWRkZWQgc3VwcG9ydCBmb3IgZGF0ZS1yYW5nZVxyXG4gICAgICBjb25zdCBjb2xvckluUmFuZ2UgPSBBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpICYmIGlzRGF0ZUluUmFuZ2UoZGF0ZSwgdGhpcy52YWx1ZSlcclxuICAgICAgY29uc3QgY29sb3JSYW5nZU5vZGUgPSBBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpICYmICh0aGlzLnZhbHVlLmluZGV4T2YoZGF0ZSkgPT09IDAgfHwgZGF0ZSA9PT0gdGhpcy52YWx1ZVt0aGlzLnZhbHVlLmxlbmd0aCAtMV0pICAgXHJcbiAgICAgIHJldHVybiBjb2xvclJhbmdlTm9kZSA/ICdhY2NlbnQgZGFya2VuLTQnIDogY29sb3JJblJhbmdlID8gJ2FjY2VudCBkYXJrZW4tMicgOiBjb2xvclxyXG4gICAgfSxcclxuICAgIGdldEV2ZW50Q29sb3JzIChkYXRlOiBzdHJpbmcpIHtcclxuICAgICAgY29uc3QgYXJyYXlpemUgPSAodjogc3RyaW5nIHwgc3RyaW5nW10pID0+IEFycmF5LmlzQXJyYXkodikgPyB2IDogW3ZdXHJcbiAgICAgIGxldCBldmVudERhdGE6IGJvb2xlYW4gfCBEYXRlRXZlbnRDb2xvclZhbHVlXHJcbiAgICAgIGxldCBldmVudENvbG9yczogc3RyaW5nW10gPSBbXVxyXG5cclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5ldmVudHMpKSB7XHJcbiAgICAgICAgZXZlbnREYXRhID0gdGhpcy5ldmVudHMuaW5jbHVkZXMoZGF0ZSlcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmV2ZW50cyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgZXZlbnREYXRhID0gdGhpcy5ldmVudHMoZGF0ZSkgfHwgZmFsc2VcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmV2ZW50cykge1xyXG4gICAgICAgIGV2ZW50RGF0YSA9IHRoaXMuZXZlbnRzW2RhdGVdIHx8IGZhbHNlXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZXZlbnREYXRhID0gZmFsc2VcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFldmVudERhdGEpIHtcclxuICAgICAgICByZXR1cm4gW11cclxuICAgICAgfSBlbHNlIGlmIChldmVudERhdGEgIT09IHRydWUpIHtcclxuICAgICAgICBldmVudENvbG9ycyA9IGFycmF5aXplKGV2ZW50RGF0YSlcclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5ldmVudENvbG9yID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGV2ZW50Q29sb3JzID0gW3RoaXMuZXZlbnRDb2xvcl1cclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5ldmVudENvbG9yID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgZXZlbnRDb2xvcnMgPSBhcnJheWl6ZSh0aGlzLmV2ZW50Q29sb3IoZGF0ZSkpXHJcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmV2ZW50Q29sb3IpKSB7XHJcbiAgICAgICAgZXZlbnRDb2xvcnMgPSB0aGlzLmV2ZW50Q29sb3JcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBldmVudENvbG9ycyA9IGFycmF5aXplKHRoaXMuZXZlbnRDb2xvcltkYXRlXSlcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGV2ZW50Q29sb3JzLmZpbHRlcih2ID0+IHYpXHJcbiAgICB9LFxyXG4gICAgZ2VuRXZlbnRzIChkYXRlOiBzdHJpbmcpIHtcclxuICAgICAgY29uc3QgZXZlbnRDb2xvcnMgPSB0aGlzLmdldEV2ZW50Q29sb3JzKGRhdGUpXHJcblxyXG4gICAgICByZXR1cm4gZXZlbnRDb2xvcnMubGVuZ3RoID8gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xyXG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1kYXRlLXBpY2tlci10YWJsZV9fZXZlbnRzJ1xyXG4gICAgICB9LCBldmVudENvbG9ycy5tYXAoY29sb3IgPT4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2JywgdGhpcy5zZXRCYWNrZ3JvdW5kQ29sb3IoY29sb3IpKSkpIDogbnVsbFxyXG4gICAgfSxcclxuICAgIHdoZWVsIChlOiBXaGVlbEV2ZW50LCBjYWxjdWxhdGVUYWJsZURhdGU6IENhbGN1bGF0ZVRhYmxlRGF0ZUZ1bmN0aW9uKSB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG4gICAgICB0aGlzLiRlbWl0KCd0YWJsZURhdGUnLCBjYWxjdWxhdGVUYWJsZURhdGUoZS5kZWx0YVkpKVxyXG4gICAgfSxcclxuICAgIHRvdWNoICh2YWx1ZTogbnVtYmVyLCBjYWxjdWxhdGVUYWJsZURhdGU6IENhbGN1bGF0ZVRhYmxlRGF0ZUZ1bmN0aW9uKSB7XHJcbiAgICAgIHRoaXMuJGVtaXQoJ3RhYmxlRGF0ZScsIGNhbGN1bGF0ZVRhYmxlRGF0ZSh2YWx1ZSkpXHJcbiAgICB9LFxyXG4gICAgZ2VuVGFibGUgKHN0YXRpY0NsYXNzOiBzdHJpbmcsIGNoaWxkcmVuOiBWTm9kZUNoaWxkcmVuLCBjYWxjdWxhdGVUYWJsZURhdGU6IENhbGN1bGF0ZVRhYmxlRGF0ZUZ1bmN0aW9uKSB7XHJcbiAgICAgIGNvbnN0IHRyYW5zaXRpb24gPSB0aGlzLiRjcmVhdGVFbGVtZW50KCd0cmFuc2l0aW9uJywge1xyXG4gICAgICAgIHByb3BzOiB7IG5hbWU6IHRoaXMuY29tcHV0ZWRUcmFuc2l0aW9uIH1cclxuICAgICAgfSwgW3RoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RhYmxlJywgeyBrZXk6IHRoaXMudGFibGVEYXRlIH0sIGNoaWxkcmVuKV0pXHJcblxyXG4gICAgICBjb25zdCB0b3VjaERpcmVjdGl2ZSA9IHtcclxuICAgICAgICBuYW1lOiAndG91Y2gnLFxyXG4gICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICBsZWZ0OiAoZTogVG91Y2hXcmFwcGVyKSA9PiAoZS5vZmZzZXRYIDwgLTE1KSAmJiB0aGlzLnRvdWNoKDEsIGNhbGN1bGF0ZVRhYmxlRGF0ZSksXHJcbiAgICAgICAgICByaWdodDogKGU6IFRvdWNoV3JhcHBlcikgPT4gKGUub2Zmc2V0WCA+IDE1KSAmJiB0aGlzLnRvdWNoKC0xLCBjYWxjdWxhdGVUYWJsZURhdGUpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2Jywge1xyXG4gICAgICAgIHN0YXRpY0NsYXNzLFxyXG4gICAgICAgIGNsYXNzOiB7XHJcbiAgICAgICAgICAndi1kYXRlLXBpY2tlci10YWJsZS0tZGlzYWJsZWQnOiB0aGlzLmRpc2FibGVkLFxyXG4gICAgICAgICAgLi4udGhpcy50aGVtZUNsYXNzZXNcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uOiAoIXRoaXMuZGlzYWJsZWQgJiYgdGhpcy5zY3JvbGxhYmxlKSA/IHtcclxuICAgICAgICAgIHdoZWVsOiAoZTogV2hlZWxFdmVudCkgPT4gdGhpcy53aGVlbChlLCBjYWxjdWxhdGVUYWJsZURhdGUpXHJcbiAgICAgICAgfSA6IHVuZGVmaW5lZCxcclxuICAgICAgICBkaXJlY3RpdmVzOiBbdG91Y2hEaXJlY3RpdmVdXHJcbiAgICAgIH0sIFt0cmFuc2l0aW9uXSlcclxuICAgIH1cclxuICB9XHJcbn0pXHJcbiJdfQ==