export const PARSE_REGEX = /^(\d{1,4})-(\d{1,2})(-(\d{1,2}))?([^\d]+(\d{1,2}))?(:(\d{1,2}))?(:(\d{1,2}))?$/;
export const PARSE_TIME = /(\d{1,2})?(:(\d{1,2}))?(:(\d{1,2}))/;
export const DAYS_IN_MONTH = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
export const DAYS_IN_MONTH_LEAP = [0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
export const DAYS_IN_MONTH_MIN = 28;
export const DAYS_IN_MONTH_MAX = 31;
export const MONTH_MAX = 12;
export const MONTH_MIN = 1;
export const DAY_MIN = 1;
export const DAYS_IN_WEEK = 7;
export const MINUTES_IN_HOUR = 60;
export const HOURS_IN_DAY = 24;
export const FIRST_HOUR = 0;
export function parseTime(input) {
    if (typeof input === 'number') {
        // when a number is given, it's minutes since 12:00am
        return input;
    }
    else if (typeof input === 'string') {
        // when a string is given, it's a hh:mm:ss format where seconds are optional
        const parts = PARSE_TIME.exec(input);
        if (!parts) {
            return false;
        }
        return parseInt(parts[1]) * 60 + parseInt(parts[2] || 0);
    }
    else if (typeof input === 'object') {
        // when an object is given, it must have hour and minute
        if (typeof input.hour !== 'number' || typeof input.minute !== 'number') {
            return false;
        }
        return input.hour * 60 + input.minute;
    }
    else {
        // unsupported type
        return false;
    }
}
export function validateTimestamp(input) {
    return !!PARSE_REGEX.exec(input);
}
export function parseTimestamp(input, now) {
    // YYYY-MM-DD hh:mm:ss
    const parts = PARSE_REGEX.exec(input);
    if (!parts)
        return null;
    const timestamp = {
        date: input,
        time: '',
        year: parseInt(parts[1]),
        month: parseInt(parts[2]),
        day: parseInt(parts[4]) || 1,
        hour: parseInt(parts[6]) || 0,
        minute: parseInt(parts[8]) || 0,
        weekday: 0,
        hasDay: !!parts[4],
        hasTime: !!(parts[6] && parts[8]),
        past: false,
        present: false,
        future: false
    };
    updateWeekday(timestamp);
    updateFormatted(timestamp);
    if (now) {
        updateRelative(timestamp, now, timestamp.hasTime);
    }
    return timestamp;
}
export function parseDate(date) {
    return updateFormatted({
        date: '',
        time: '',
        year: date.getFullYear(),
        month: date.getMonth() + 1,
        day: date.getDate(),
        weekday: date.getDay(),
        hour: date.getHours(),
        minute: date.getMinutes(),
        hasDay: true,
        hasTime: true,
        past: false,
        present: true,
        future: false
    });
}
export function getDayIdentifier(timestamp) {
    return timestamp.year * 1000000 + timestamp.month * 100 + timestamp.day;
}
export function getTimeIdentifier(timestamp) {
    return timestamp.hour * 100 + timestamp.minute;
}
export function updateRelative(timestamp, now, time = false) {
    let a = getDayIdentifier(now);
    let b = getDayIdentifier(timestamp);
    let present = a === b;
    if (timestamp.hasTime && time && present) {
        a = getTimeIdentifier(now);
        b = getTimeIdentifier(timestamp);
        present = a === b;
    }
    timestamp.past = b < a;
    timestamp.present = present;
    timestamp.future = b > a;
    return timestamp;
}
export function updateMinutes(timestamp, minutes, now) {
    timestamp.hasTime = true;
    timestamp.hour = Math.floor(minutes / MINUTES_IN_HOUR);
    timestamp.minute = minutes % MINUTES_IN_HOUR;
    timestamp.time = getTime(timestamp);
    if (now) {
        updateRelative(timestamp, now, true);
    }
    return timestamp;
}
export function updateWeekday(timestamp) {
    timestamp.weekday = getWeekday(timestamp);
    return timestamp;
}
export function updateFormatted(timestamp) {
    timestamp.time = getTime(timestamp);
    timestamp.date = getDate(timestamp);
    return timestamp;
}
export function getWeekday(timestamp) {
    if (timestamp.hasDay) {
        const _ = Math.floor;
        const k = timestamp.day;
        const m = ((timestamp.month + 9) % MONTH_MAX) + 1;
        const C = _(timestamp.year / 100);
        const Y = (timestamp.year % 100) - (timestamp.month <= 2 ? 1 : 0);
        return (k + _(2.6 * m - 0.2) - 2 * C + Y + _(Y / 4) + _(C / 4)) % 7;
    }
    return timestamp.weekday;
}
export function isLeapYear(year) {
    return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);
}
export function daysInMonth(year, month) {
    return isLeapYear(year) ? DAYS_IN_MONTH_LEAP[month] : DAYS_IN_MONTH[month];
}
export function copyTimestamp(timestamp) {
    const { date, time, year, month, day, weekday, hour, minute, hasDay, hasTime, past, present, future } = timestamp;
    return { date, time, year, month, day, weekday, hour, minute, hasDay, hasTime, past, present, future };
}
export function padNumber(x, length) {
    let padded = String(x);
    while (padded.length < length) {
        padded = '0' + padded;
    }
    return padded;
}
export function getDate(timestamp) {
    let str = `${padNumber(timestamp.year, 4)}-${padNumber(timestamp.month, 2)}`;
    if (timestamp.hasDay)
        str += `-${padNumber(timestamp.day, 2)}`;
    return str;
}
export function getTime(timestamp) {
    if (!timestamp.hasTime) {
        return '';
    }
    return `${padNumber(timestamp.hour, 2)}:${padNumber(timestamp.minute, 2)}`;
}
export function nextMinutes(timestamp, minutes) {
    timestamp.minute += minutes;
    while (timestamp.minute > MINUTES_IN_HOUR) {
        timestamp.minute -= MINUTES_IN_HOUR;
        timestamp.hour++;
        if (timestamp.hour >= HOURS_IN_DAY) {
            nextDay(timestamp);
            timestamp.hour = FIRST_HOUR;
        }
    }
    return timestamp;
}
export function nextDay(timestamp) {
    timestamp.day++;
    timestamp.weekday = (timestamp.weekday + 1) % DAYS_IN_WEEK;
    if (timestamp.day > DAYS_IN_MONTH_MIN && timestamp.day > daysInMonth(timestamp.year, timestamp.month)) {
        timestamp.day = DAY_MIN;
        timestamp.month++;
        if (timestamp.month > MONTH_MAX) {
            timestamp.month = MONTH_MIN;
            timestamp.year++;
        }
    }
    return timestamp;
}
export function prevDay(timestamp) {
    timestamp.day--;
    timestamp.weekday = (timestamp.weekday + 6) % DAYS_IN_WEEK;
    if (timestamp.day < DAY_MIN) {
        timestamp.month--;
        if (timestamp.month < MONTH_MIN) {
            timestamp.year--;
            timestamp.month = MONTH_MAX;
        }
        timestamp.day = daysInMonth(timestamp.year, timestamp.month);
    }
    return timestamp;
}
export function relativeDays(timestamp, mover = nextDay, days = 1) {
    while (--days >= 0)
        mover(timestamp);
    return timestamp;
}
export function findWeekday(timestamp, weekday, mover = nextDay, maxDays = 6) {
    while (timestamp.weekday !== weekday && --maxDays >= 0)
        mover(timestamp);
    return timestamp;
}
export function getWeekdaySkips(weekdays) {
    const skips = [1, 1, 1, 1, 1, 1, 1];
    const filled = [0, 0, 0, 0, 0, 0, 0];
    for (let i = 0; i < weekdays.length; i++) {
        filled[weekdays[i]] = 1;
    }
    for (let k = 0; k < DAYS_IN_WEEK; k++) {
        let skip = 1;
        for (let j = 1; j < DAYS_IN_WEEK; j++) {
            const next = (k + j) % DAYS_IN_WEEK;
            if (filled[next]) {
                break;
            }
            skip++;
        }
        skips[k] = filled[k] * skip;
    }
    return skips;
}
export function createDayList(start, end, now, weekdaySkips, max = 42, min = 0) {
    const stop = getDayIdentifier(end);
    const days = [];
    let current = copyTimestamp(start);
    let currentIdentifier = 0;
    let stopped = currentIdentifier === stop;
    if (stop < getDayIdentifier(start)) {
        return days;
    }
    while ((!stopped || days.length < min) && days.length < max) {
        currentIdentifier = getDayIdentifier(current);
        stopped = stopped || currentIdentifier === stop;
        if (weekdaySkips[current.weekday] === 0) {
            current = nextDay(current);
            continue;
        }
        const day = copyTimestamp(current);
        updateFormatted(day);
        updateRelative(day, now);
        days.push(day);
        current = relativeDays(current, nextDay, weekdaySkips[current.weekday]);
    }
    return days;
}
export function createIntervalList(timestamp, first, minutes, count, now) {
    const intervals = [];
    for (let i = 0; i < count; i++) {
        const mins = (first + i) * minutes;
        const int = copyTimestamp(timestamp);
        intervals.push(updateMinutes(int, mins, now));
    }
    return intervals;
}
export function createNativeLocaleFormatter(locale, getOptions) {
    const emptyFormatter = (_t, _s) => '';
    if (typeof Intl === 'undefined' || typeof Intl.DateTimeFormat === 'undefined') {
        return emptyFormatter;
    }
    return (timestamp, short) => {
        try {
            const intlFormatter = new Intl.DateTimeFormat(locale || undefined, getOptions(timestamp, short));
            const time = `${padNumber(timestamp.hour, 2)}:${padNumber(timestamp.minute, 2)}`;
            const date = timestamp.date;
            return intlFormatter.format(new Date(`${date}T${time}:00+00:00`));
        }
        catch (e) {
            return '';
        }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXN0YW1wLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVkNhbGVuZGFyL3V0aWwvdGltZXN0YW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBVyxnRkFBZ0YsQ0FBQTtBQUNuSCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQVcscUNBQXFDLENBQUE7QUFFdkUsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFhLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDMUYsTUFBTSxDQUFDLE1BQU0sa0JBQWtCLEdBQWEsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUMvRixNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxFQUFFLENBQUE7QUFDbkMsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFBO0FBQ25DLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUE7QUFDM0IsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQTtBQUMxQixNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFBO0FBQ3hCLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLENBQUE7QUFDN0IsTUFBTSxDQUFDLE1BQU0sZUFBZSxHQUFHLEVBQUUsQ0FBQTtBQUNqQyxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsRUFBRSxD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QUFPLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFBO1NBQ2xFO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLEVBQUUsQ0FBQTtTQUNWO0lBQ0gsQ0FBQyxDQUFBO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5leHBvcnQgY29uc3QgUEFSU0VfUkVHRVg6IFJlZ0V4cCA9IC9eKFxcZHsxLDR9KS0oXFxkezEsMn0pKC0oXFxkezEsMn0pKT8oW15cXGRdKyhcXGR7MSwyfSkpPyg6KFxcZHsxLDJ9KSk/KDooXFxkezEsMn0pKT8kL1xyXG5leHBvcnQgY29uc3QgUEFSU0VfVElNRTogUmVnRXhwID0gLyhcXGR7MSwyfSk/KDooXFxkezEsMn0pKT8oOihcXGR7MSwyfSkpL1xyXG5cclxuZXhwb3J0IGNvbnN0IERBWVNfSU5fTU9OVEg6IG51bWJlcltdID0gWzAsIDMxLCAyOCwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdXHJcbmV4cG9ydCBjb25zdCBEQVlTX0lOX01PTlRIX0xFQVA6IG51bWJlcltdID0gWzAsIDMxLCAyOSwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdXHJcbmV4cG9ydCBjb25zdCBEQVlTX0lOX01PTlRIX01JTiA9IDI4XHJcbmV4cG9ydCBjb25zdCBEQVlTX0lOX01PTlRIX01BWCA9IDMxXHJcbmV4cG9ydCBjb25zdCBNT05USF9NQVggPSAxMlxyXG5leHBvcnQgY29uc3QgTU9OVEhfTUlOID0gMVxyXG5leHBvcnQgY29uc3QgREFZX01JTiA9IDFcclxuZXhwb3J0IGNvbnN0IERBWVNfSU5fV0VFSyA9IDdcclxuZXhwb3J0IGNvbnN0IE1JTlVURVNfSU5fSE9VUiA9IDYwXHJcbmV4cG9ydCBjb25zdCBIT1VSU19JTl9EQVkgPSAyNFxyXG5leHBvcnQgY29uc3QgRklSU1RfSE9VUiA9IDBcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVlRpbWVzdGFtcCB7XHJcbiAgZGF0ZTogc3RyaW5nXHJcbiAgdGltZTogc3RyaW5nXHJcbiAgeWVhcjogbnVtYmVyXHJcbiAgbW9udGg6IG51bWJlclxyXG4gIGRheTogbnVtYmVyXHJcbiAgd2Vla2RheTogbnVtYmVyXHJcbiAgaG91cjogbnVtYmVyXHJcbiAgbWludXRlOiBudW1iZXJcclxuICBoYXNEYXk6IGJvb2xlYW5cclxuICBoYXNUaW1lOiBib29sZWFuXHJcbiAgcGFzdDogYm9vbGVhblxyXG4gIHByZXNlbnQ6IGJvb2xlYW5cclxuICBmdXR1cmU6IGJvb2xlYW5cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBWVGltZU9iamVjdCB7XHJcbiAgaG91cjogbnVtYmVyXHJcbiAgbWludXRlOiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgVlRpbWUgPSBudW1iZXIgfCBzdHJpbmcgfCBWVGltZU9iamVjdFxyXG5cclxuZXhwb3J0IHR5cGUgVlRpbWVzdGFtcEZvcm1hdHRlciA9ICh0aW1lc3RhbXA6IFZUaW1lc3RhbXAsIHNob3J0OiBib29sZWFuKSA9PiBzdHJpbmdcclxuXHJcbmV4cG9ydCB0eXBlIFZUaW1lc3RhbXBGb3JtYXRPcHRpb25zID0gKHRpbWVzdGFtcDogVlRpbWVzdGFtcCwgc2hvcnQ6IGJvb2xlYW4pID0+IG9iamVjdFxyXG5cclxuZXhwb3J0IHR5cGUgVlRpbWVzdGFtcE9wZXJhdGlvbiA9ICh0aW1lc3RhbXA6IFZUaW1lc3RhbXApID0+IFZUaW1lc3RhbXBcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVRpbWUgKGlucHV0OiBhbnkpOiBudW1iZXIgfCBmYWxzZSB7XHJcbiAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ251bWJlcicpIHtcclxuICAgIC8vIHdoZW4gYSBudW1iZXIgaXMgZ2l2ZW4sIGl0J3MgbWludXRlcyBzaW5jZSAxMjowMGFtXHJcbiAgICByZXR1cm4gaW5wdXRcclxuICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHtcclxuICAgIC8vIHdoZW4gYSBzdHJpbmcgaXMgZ2l2ZW4sIGl0J3MgYSBoaDptbTpzcyBmb3JtYXQgd2hlcmUgc2Vjb25kcyBhcmUgb3B0aW9uYWxcclxuICAgIGNvbnN0IHBhcnRzID0gUEFSU0VfVElNRS5leGVjKGlucHV0KVxyXG4gICAgaWYgKCFwYXJ0cykge1xyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICAgIHJldHVybiBwYXJzZUludChwYXJ0c1sxXSkgKiA2MCArIHBhcnNlSW50KHBhcnRzWzJdIHx8IDApXHJcbiAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdvYmplY3QnKSB7XHJcbiAgICAvLyB3aGVuIGFuIG9iamVjdCBpcyBnaXZlbiwgaXQgbXVzdCBoYXZlIGhvdXIgYW5kIG1pbnV0ZVxyXG4gICAgaWYgKHR5cGVvZiBpbnB1dC5ob3VyICE9PSAnbnVtYmVyJyB8fCB0eXBlb2YgaW5wdXQubWludXRlICE9PSAnbnVtYmVyJykge1xyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICAgIHJldHVybiBpbnB1dC5ob3VyICogNjAgKyBpbnB1dC5taW51dGVcclxuICB9IGVsc2Uge1xyXG4gICAgLy8gdW5zdXBwb3J0ZWQgdHlwZVxyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVUaW1lc3RhbXAgKGlucHV0OiBhbnkpOiBib29sZWFuIHtcclxuICByZXR1cm4gISFQQVJTRV9SRUdFWC5leGVjKGlucHV0KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VUaW1lc3RhbXAgKGlucHV0OiBzdHJpbmcsIG5vdz86IFZUaW1lc3RhbXApOiBWVGltZXN0YW1wIHwgbnVsbCB7XHJcbiAgLy8gWVlZWS1NTS1ERCBoaDptbTpzc1xyXG4gIGNvbnN0IHBhcnRzID0gUEFSU0VfUkVHRVguZXhlYyhpbnB1dClcclxuXHJcbiAgaWYgKCFwYXJ0cykgcmV0dXJuIG51bGxcclxuXHJcbiAgY29uc3QgdGltZXN0YW1wOiBWVGltZXN0YW1wID0ge1xyXG4gICAgZGF0ZTogaW5wdXQsXHJcbiAgICB0aW1lOiAnJyxcclxuICAgIHllYXI6IHBhcnNlSW50KHBhcnRzWzFdKSxcclxuICAgIG1vbnRoOiBwYXJzZUludChwYXJ0c1syXSksXHJcbiAgICBkYXk6IHBhcnNlSW50KHBhcnRzWzRdKSB8fCAxLFxyXG4gICAgaG91cjogcGFyc2VJbnQocGFydHNbNl0pIHx8IDAsXHJcbiAgICBtaW51dGU6IHBhcnNlSW50KHBhcnRzWzhdKSB8fCAwLFxyXG4gICAgd2Vla2RheTogMCxcclxuICAgIGhhc0RheTogISFwYXJ0c1s0XSxcclxuICAgIGhhc1RpbWU6ICEhKHBhcnRzWzZdICYmIHBhcnRzWzhdKSxcclxuICAgIHBhc3Q6IGZhbHNlLFxyXG4gICAgcHJlc2VudDogZmFsc2UsXHJcbiAgICBmdXR1cmU6IGZhbHNlXHJcbiAgfVxyXG5cclxuICB1cGRhdGVXZWVrZGF5KHRpbWVzdGFtcClcclxuICB1cGRhdGVGb3JtYXR0ZWQodGltZXN0YW1wKVxyXG5cclxuICBpZiAobm93KSB7XHJcbiAgICB1cGRhdGVSZWxhdGl2ZSh0aW1lc3RhbXAsIG5vdywgdGltZXN0YW1wLmhhc1RpbWUpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gdGltZXN0YW1wXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZURhdGUgKGRhdGU6IERhdGUpOiBWVGltZXN0YW1wIHtcclxuICByZXR1cm4gdXBkYXRlRm9ybWF0dGVkKHtcclxuICAgIGRhdGU6ICcnLFxyXG4gICAgdGltZTogJycsXHJcbiAgICB5ZWFyOiBkYXRlLmdldEZ1bGxZZWFyKCksXHJcbiAgICBtb250aDogZGF0ZS5nZXRNb250aCgpICsgMSxcclxuICAgIGRheTogZGF0ZS5nZXREYXRlKCksXHJcbiAgICB3ZWVrZGF5OiBkYXRlLmdldERheSgpLFxyXG4gICAgaG91cjogZGF0ZS5nZXRIb3VycygpLFxyXG4gICAgbWludXRlOiBkYXRlLmdldE1pbnV0ZXMoKSxcclxuICAgIGhhc0RheTogdHJ1ZSxcclxuICAgIGhhc1RpbWU6IHRydWUsXHJcbiAgICBwYXN0OiBmYWxzZSxcclxuICAgIHByZXNlbnQ6IHRydWUsXHJcbiAgICBmdXR1cmU6IGZhbHNlXHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldERheUlkZW50aWZpZXIgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCk6IG51bWJlciB7XHJcbiAgcmV0dXJuIHRpbWVzdGFtcC55ZWFyICogMTAwMDAwMCArIHRpbWVzdGFtcC5tb250aCAqIDEwMCArIHRpbWVzdGFtcC5kYXlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWVJZGVudGlmaWVyICh0aW1lc3RhbXA6IFZUaW1lc3RhbXApOiBudW1iZXIge1xyXG4gIHJldHVybiB0aW1lc3RhbXAuaG91ciAqIDEwMCArIHRpbWVzdGFtcC5taW51dGVcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlbGF0aXZlICh0aW1lc3RhbXA6IFZUaW1lc3RhbXAsIG5vdzogVlRpbWVzdGFtcCwgdGltZSA9IGZhbHNlKTogVlRpbWVzdGFtcCB7XHJcbiAgbGV0IGEgPSBnZXREYXlJZGVudGlmaWVyKG5vdylcclxuICBsZXQgYiA9IGdldERheUlkZW50aWZpZXIodGltZXN0YW1wKVxyXG4gIGxldCBwcmVzZW50ID0gYSA9PT0gYlxyXG5cclxuICBpZiAodGltZXN0YW1wLmhhc1RpbWUgJiYgdGltZSAmJiBwcmVzZW50KSB7XHJcbiAgICBhID0gZ2V0VGltZUlkZW50aWZpZXIobm93KVxyXG4gICAgYiA9IGdldFRpbWVJZGVudGlmaWVyKHRpbWVzdGFtcClcclxuICAgIHByZXNlbnQgPSBhID09PSBiXHJcbiAgfVxyXG5cclxuICB0aW1lc3RhbXAucGFzdCA9IGIgPCBhXHJcbiAgdGltZXN0YW1wLnByZXNlbnQgPSBwcmVzZW50XHJcbiAgdGltZXN0YW1wLmZ1dHVyZSA9IGIgPiBhXHJcblxyXG4gIHJldHVybiB0aW1lc3RhbXBcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZU1pbnV0ZXMgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCwgbWludXRlczogbnVtYmVyLCBub3c/OiBWVGltZXN0YW1wKTogVlRpbWVzdGFtcCB7XHJcbiAgdGltZXN0YW1wLmhhc1RpbWUgPSB0cnVlXHJcbiAgdGltZXN0YW1wLmhvdXIgPSBNYXRoLmZsb29yKG1pbnV0ZXMgLyBNSU5VVEVTX0lOX0hPVVIpXHJcbiAgdGltZXN0YW1wLm1pbnV0ZSA9IG1pbnV0ZXMgJSBNSU5VVEVTX0lOX0hPVVJcclxuICB0aW1lc3RhbXAudGltZSA9IGdldFRpbWUodGltZXN0YW1wKVxyXG4gIGlmIChub3cpIHtcclxuICAgIHVwZGF0ZVJlbGF0aXZlKHRpbWVzdGFtcCwgbm93LCB0cnVlKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRpbWVzdGFtcFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlV2Vla2RheSAodGltZXN0YW1wOiBWVGltZXN0YW1wKTogVlRpbWVzdGFtcCB7XHJcbiAgdGltZXN0YW1wLndlZWtkYXkgPSBnZXRXZWVrZGF5KHRpbWVzdGFtcClcclxuXHJcbiAgcmV0dXJuIHRpbWVzdGFtcFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRm9ybWF0dGVkICh0aW1lc3RhbXA6IFZUaW1lc3RhbXApOiBWVGltZXN0YW1wIHtcclxuICB0aW1lc3RhbXAudGltZSA9IGdldFRpbWUodGltZXN0YW1wKVxyXG4gIHRpbWVzdGFtcC5kYXRlID0gZ2V0RGF0ZSh0aW1lc3RhbXApXHJcblxyXG4gIHJldHVybiB0aW1lc3RhbXBcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtkYXkgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCk6IG51bWJlciB7XHJcbiAgaWYgKHRpbWVzdGFtcC5oYXNEYXkpIHtcclxuICAgIGNvbnN0IF8gPSBNYXRoLmZsb29yXHJcbiAgICBjb25zdCBrID0gdGltZXN0YW1wLmRheVxyXG4gICAgY29uc3QgbSA9ICgodGltZXN0YW1wLm1vbnRoICsgOSkgJSBNT05USF9NQVgpICsgMVxyXG4gICAgY29uc3QgQyA9IF8odGltZXN0YW1wLnllYXIgLyAxMDApXHJcbiAgICBjb25zdCBZID0gKHRpbWVzdGFtcC55ZWFyICUgMTAwKSAtICh0aW1lc3RhbXAubW9udGggPD0gMiA/IDEgOiAwKVxyXG5cclxuICAgIHJldHVybiAoayArIF8oMi42ICogbSAtIDAuMikgLSAyICogQyArIFkgKyBfKFkgLyA0KSArIF8oQyAvIDQpKSAlIDdcclxuICB9XHJcblxyXG4gIHJldHVybiB0aW1lc3RhbXAud2Vla2RheVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNMZWFwWWVhciAoeWVhcjogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuICgoeWVhciAlIDQgPT09IDApICYmICh5ZWFyICUgMTAwICE9PSAwKSkgfHwgKHllYXIgJSA0MDAgPT09IDApXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkYXlzSW5Nb250aCAoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XHJcbiAgcmV0dXJuIGlzTGVhcFllYXIoeWVhcikgPyBEQVlTX0lOX01PTlRIX0xFQVBbbW9udGhdIDogREFZU19JTl9NT05USFttb250aF1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHlUaW1lc3RhbXAgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCk6IFZUaW1lc3RhbXAge1xyXG4gIGNvbnN0IHsgZGF0ZSwgdGltZSwgeWVhciwgbW9udGgsIGRheSwgd2Vla2RheSwgaG91ciwgbWludXRlLCBoYXNEYXksIGhhc1RpbWUsIHBhc3QsIHByZXNlbnQsIGZ1dHVyZSB9ID0gdGltZXN0YW1wXHJcblxyXG4gIHJldHVybiB7IGRhdGUsIHRpbWUsIHllYXIsIG1vbnRoLCBkYXksIHdlZWtkYXksIGhvdXIsIG1pbnV0ZSwgaGFzRGF5LCBoYXNUaW1lLCBwYXN0LCBwcmVzZW50LCBmdXR1cmUgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGFkTnVtYmVyICh4OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcclxuICBsZXQgcGFkZGVkID0gU3RyaW5nKHgpXHJcbiAgd2hpbGUgKHBhZGRlZC5sZW5ndGggPCBsZW5ndGgpIHtcclxuICAgIHBhZGRlZCA9ICcwJyArIHBhZGRlZFxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHBhZGRlZFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0ZSAodGltZXN0YW1wOiBWVGltZXN0YW1wKTogc3RyaW5nIHtcclxuICBsZXQgc3RyID0gYCR7cGFkTnVtYmVyKHRpbWVzdGFtcC55ZWFyLCA0KX0tJHtwYWROdW1iZXIodGltZXN0YW1wLm1vbnRoLCAyKX1gXHJcblxyXG4gIGlmICh0aW1lc3RhbXAuaGFzRGF5KSBzdHIgKz0gYC0ke3BhZE51bWJlcih0aW1lc3RhbXAuZGF5LCAyKX1gXHJcblxyXG4gIHJldHVybiBzdHJcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWUgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCk6IHN0cmluZyB7XHJcbiAgaWYgKCF0aW1lc3RhbXAuaGFzVGltZSkge1xyXG4gICAgcmV0dXJuICcnXHJcbiAgfVxyXG5cclxuICByZXR1cm4gYCR7cGFkTnVtYmVyKHRpbWVzdGFtcC5ob3VyLCAyKX06JHtwYWROdW1iZXIodGltZXN0YW1wLm1pbnV0ZSwgMil9YFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbmV4dE1pbnV0ZXMgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCwgbWludXRlczogbnVtYmVyKTogVlRpbWVzdGFtcCB7XHJcbiAgdGltZXN0YW1wLm1pbnV0ZSArPSBtaW51dGVzXHJcbiAgd2hpbGUgKHRpbWVzdGFtcC5taW51dGUgPiBNSU5VVEVTX0lOX0hPVVIpIHtcclxuICAgIHRpbWVzdGFtcC5taW51dGUgLT0gTUlOVVRFU19JTl9IT1VSXHJcbiAgICB0aW1lc3RhbXAuaG91cisrXHJcbiAgICBpZiAodGltZXN0YW1wLmhvdXIgPj0gSE9VUlNfSU5fREFZKSB7XHJcbiAgICAgIG5leHREYXkodGltZXN0YW1wKVxyXG4gICAgICB0aW1lc3RhbXAuaG91ciA9IEZJUlNUX0hPVVJcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB0aW1lc3RhbXBcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG5leHREYXkgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCk6IFZUaW1lc3RhbXAge1xyXG4gIHRpbWVzdGFtcC5kYXkrK1xyXG4gIHRpbWVzdGFtcC53ZWVrZGF5ID0gKHRpbWVzdGFtcC53ZWVrZGF5ICsgMSkgJSBEQVlTX0lOX1dFRUtcclxuICBpZiAodGltZXN0YW1wLmRheSA+IERBWVNfSU5fTU9OVEhfTUlOICYmIHRpbWVzdGFtcC5kYXkgPiBkYXlzSW5Nb250aCh0aW1lc3RhbXAueWVhciwgdGltZXN0YW1wLm1vbnRoKSkge1xyXG4gICAgdGltZXN0YW1wLmRheSA9IERBWV9NSU5cclxuICAgIHRpbWVzdGFtcC5tb250aCsrXHJcbiAgICBpZiAodGltZXN0YW1wLm1vbnRoID4gTU9OVEhfTUFYKSB7XHJcbiAgICAgIHRpbWVzdGFtcC5tb250aCA9IE1PTlRIX01JTlxyXG4gICAgICB0aW1lc3RhbXAueWVhcisrXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdGltZXN0YW1wXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmV2RGF5ICh0aW1lc3RhbXA6IFZUaW1lc3RhbXApOiBWVGltZXN0YW1wIHtcclxuICB0aW1lc3RhbXAuZGF5LS1cclxuICB0aW1lc3RhbXAud2Vla2RheSA9ICh0aW1lc3RhbXAud2Vla2RheSArIDYpICUgREFZU19JTl9XRUVLXHJcbiAgaWYgKHRpbWVzdGFtcC5kYXkgPCBEQVlfTUlOKSB7XHJcbiAgICB0aW1lc3RhbXAubW9udGgtLVxyXG4gICAgaWYgKHRpbWVzdGFtcC5tb250aCA8IE1PTlRIX01JTikge1xyXG4gICAgICB0aW1lc3RhbXAueWVhci0tXHJcbiAgICAgIHRpbWVzdGFtcC5tb250aCA9IE1PTlRIX01BWFxyXG4gICAgfVxyXG4gICAgdGltZXN0YW1wLmRheSA9IGRheXNJbk1vbnRoKHRpbWVzdGFtcC55ZWFyLCB0aW1lc3RhbXAubW9udGgpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gdGltZXN0YW1wXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZWxhdGl2ZURheXMgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCxcclxuICBtb3ZlcjogVlRpbWVzdGFtcE9wZXJhdGlvbiA9IG5leHREYXksIGRheXMgPSAxKTogVlRpbWVzdGFtcCB7XHJcbiAgd2hpbGUgKC0tZGF5cyA+PSAwKSBtb3Zlcih0aW1lc3RhbXApXHJcblxyXG4gIHJldHVybiB0aW1lc3RhbXBcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRXZWVrZGF5ICh0aW1lc3RhbXA6IFZUaW1lc3RhbXAsIHdlZWtkYXk6IG51bWJlcixcclxuICBtb3ZlcjogVlRpbWVzdGFtcE9wZXJhdGlvbiA9IG5leHREYXksIG1heERheXMgPSA2KTogVlRpbWVzdGFtcCB7XHJcbiAgd2hpbGUgKHRpbWVzdGFtcC53ZWVrZGF5ICE9PSB3ZWVrZGF5ICYmIC0tbWF4RGF5cyA+PSAwKSBtb3Zlcih0aW1lc3RhbXApXHJcblxyXG4gIHJldHVybiB0aW1lc3RhbXBcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtkYXlTa2lwcyAod2Vla2RheXM6IG51bWJlcltdKTogbnVtYmVyW10ge1xyXG4gIGNvbnN0IHNraXBzOiBudW1iZXJbXSA9IFsxLCAxLCAxLCAxLCAxLCAxLCAxXVxyXG4gIGNvbnN0IGZpbGxlZDogbnVtYmVyW10gPSBbMCwgMCwgMCwgMCwgMCwgMCwgMF1cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHdlZWtkYXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBmaWxsZWRbd2Vla2RheXNbaV1dID0gMVxyXG4gIH1cclxuICBmb3IgKGxldCBrID0gMDsgayA8IERBWVNfSU5fV0VFSzsgaysrKSB7XHJcbiAgICBsZXQgc2tpcCA9IDFcclxuICAgIGZvciAobGV0IGogPSAxOyBqIDwgREFZU19JTl9XRUVLOyBqKyspIHtcclxuICAgICAgY29uc3QgbmV4dCA9IChrICsgaikgJSBEQVlTX0lOX1dFRUtcclxuICAgICAgaWYgKGZpbGxlZFtuZXh0XSkge1xyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIH1cclxuICAgICAgc2tpcCsrXHJcbiAgICB9XHJcbiAgICBza2lwc1trXSA9IGZpbGxlZFtrXSAqIHNraXBcclxuICB9XHJcblxyXG4gIHJldHVybiBza2lwc1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGF5TGlzdCAoc3RhcnQ6IFZUaW1lc3RhbXAsIGVuZDogVlRpbWVzdGFtcCwgbm93OiBWVGltZXN0YW1wLFxyXG4gIHdlZWtkYXlTa2lwczogbnVtYmVyW10sIG1heCA9IDQyLCBtaW4gPSAwKTogVlRpbWVzdGFtcFtdIHtcclxuICBjb25zdCBzdG9wID0gZ2V0RGF5SWRlbnRpZmllcihlbmQpXHJcbiAgY29uc3QgZGF5czogVlRpbWVzdGFtcFtdID0gW11cclxuICBsZXQgY3VycmVudCA9IGNvcHlUaW1lc3RhbXAoc3RhcnQpXHJcbiAgbGV0IGN1cnJlbnRJZGVudGlmaWVyID0gMFxyXG4gIGxldCBzdG9wcGVkID0gY3VycmVudElkZW50aWZpZXIgPT09IHN0b3BcclxuXHJcbiAgaWYgKHN0b3AgPCBnZXREYXlJZGVudGlmaWVyKHN0YXJ0KSkge1xyXG4gICAgcmV0dXJuIGRheXNcclxuICB9XHJcblxyXG4gIHdoaWxlICgoIXN0b3BwZWQgfHwgZGF5cy5sZW5ndGggPCBtaW4pICYmIGRheXMubGVuZ3RoIDwgbWF4KSB7XHJcbiAgICBjdXJyZW50SWRlbnRpZmllciA9IGdldERheUlkZW50aWZpZXIoY3VycmVudClcclxuICAgIHN0b3BwZWQgPSBzdG9wcGVkIHx8IGN1cnJlbnRJZGVudGlmaWVyID09PSBzdG9wXHJcbiAgICBpZiAod2Vla2RheVNraXBzW2N1cnJlbnQud2Vla2RheV0gPT09IDApIHtcclxuICAgICAgY3VycmVudCA9IG5leHREYXkoY3VycmVudClcclxuICAgICAgY29udGludWVcclxuICAgIH1cclxuICAgIGNvbnN0IGRheSA9IGNvcHlUaW1lc3RhbXAoY3VycmVudClcclxuICAgIHVwZGF0ZUZvcm1hdHRlZChkYXkpXHJcbiAgICB1cGRhdGVSZWxhdGl2ZShkYXksIG5vdylcclxuICAgIGRheXMucHVzaChkYXkpXHJcbiAgICBjdXJyZW50ID0gcmVsYXRpdmVEYXlzKGN1cnJlbnQsIG5leHREYXksIHdlZWtkYXlTa2lwc1tjdXJyZW50LndlZWtkYXldKVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRheXNcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUludGVydmFsTGlzdCAodGltZXN0YW1wOiBWVGltZXN0YW1wLCBmaXJzdDogbnVtYmVyLFxyXG4gIG1pbnV0ZXM6IG51bWJlciwgY291bnQ6IG51bWJlciwgbm93PzogVlRpbWVzdGFtcCk6IFZUaW1lc3RhbXBbXSB7XHJcbiAgY29uc3QgaW50ZXJ2YWxzOiBWVGltZXN0YW1wW10gPSBbXVxyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgIGNvbnN0IG1pbnMgPSAoZmlyc3QgKyBpKSAqIG1pbnV0ZXNcclxuICAgIGNvbnN0IGludCA9IGNvcHlUaW1lc3RhbXAodGltZXN0YW1wKVxyXG4gICAgaW50ZXJ2YWxzLnB1c2godXBkYXRlTWludXRlcyhpbnQsIG1pbnMsIG5vdykpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gaW50ZXJ2YWxzXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIgKGxvY2FsZTogc3RyaW5nLCBnZXRPcHRpb25zOiBWVGltZXN0YW1wRm9ybWF0T3B0aW9ucyk6IFZUaW1lc3RhbXBGb3JtYXR0ZXIge1xyXG4gIGNvbnN0IGVtcHR5Rm9ybWF0dGVyOiBWVGltZXN0YW1wRm9ybWF0dGVyID0gKF90LCBfcykgPT4gJydcclxuXHJcbiAgaWYgKHR5cGVvZiBJbnRsID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgSW50bC5EYXRlVGltZUZvcm1hdCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHJldHVybiBlbXB0eUZvcm1hdHRlclxyXG4gIH1cclxuXHJcbiAgcmV0dXJuICh0aW1lc3RhbXAsIHNob3J0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBpbnRsRm9ybWF0dGVyID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlIHx8IHVuZGVmaW5lZCwgZ2V0T3B0aW9ucyh0aW1lc3RhbXAsIHNob3J0KSlcclxuICAgICAgY29uc3QgdGltZSA9IGAke3BhZE51bWJlcih0aW1lc3RhbXAuaG91ciwgMil9OiR7cGFkTnVtYmVyKHRpbWVzdGFtcC5taW51dGUsIDIpfWBcclxuICAgICAgY29uc3QgZGF0ZSA9IHRpbWVzdGFtcC5kYXRlXHJcbiAgICAgIHJldHVybiBpbnRsRm9ybWF0dGVyLmZvcm1hdChuZXcgRGF0ZShgJHtkYXRlfVQke3RpbWV9OjAwKzAwOjAwYCkpXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHJldHVybiAnJ1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=