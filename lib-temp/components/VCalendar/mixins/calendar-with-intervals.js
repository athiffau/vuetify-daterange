// Mixins
import CalendarBase from './calendar-base';
// Util
import props from '../util/props';
import { parseTime, copyTimestamp, updateMinutes, createDayList, createIntervalList, createNativeLocaleFormatter } from '../util/timestamp';
/* @vue/component */
export default CalendarBase.extend({
    name: 'calendar-with-intervals',
    props: props.intervals,
    computed: {
        parsedFirstInterval() {
            return parseInt(this.firstInterval);
        },
        parsedIntervalMinutes() {
            return parseInt(this.intervalMinutes);
        },
        parsedIntervalCount() {
            return parseInt(this.intervalCount);
        },
        parsedIntervalHeight() {
            return parseFloat(this.intervalHeight);
        },
        firstMinute() {
            return this.parsedFirstInterval * this.parsedIntervalMinutes;
        },
        bodyHeight() {
            return this.parsedIntervalCount * this.parsedIntervalHeight;
        },
        days() {
            return createDayList(this.parsedStart, this.parsedEnd, this.times.today, this.weekdaySkips, this.maxDays);
        },
        intervals() {
            const days = this.days;
            const first = this.parsedFirstInterval;
            const minutes = this.parsedIntervalMinutes;
            const count = this.parsedIntervalCount;
            const now = this.times.now;
            return days.map(d => createIntervalList(d, first, minutes, count, now));
        },
        intervalFormatter() {
            if (this.intervalFormat) {
                return this.intervalFormat;
            }
            const longOptions = { timeZone: 'UTC', hour12: true, hour: '2-digit', minute: '2-digit' };
            const shortOptions = { timeZone: 'UTC', hour12: true, hour: 'numeric', minute: '2-digit' };
            const shortHourOptions = { timeZone: 'UTC', hour12: true, hour: 'numeric' };
            return createNativeLocaleFormatter(this.locale, (tms, short) => short ? (tms.minute === 0 ? shortHourOptions : shortOptions) : longOptions);
        }
    },
    methods: {
        showIntervalLabelDefault(interval) {
            const first = this.intervals[0][0];
            const isFirst = first.hour === interval.hour && first.minute === interval.minute;
            return !isFirst && interval.minute === 0;
        },
        intervalStyleDefault(_interval) {
            return undefined;
        },
        getTimestampAtEvent(e, day) {
            const timestamp = copyTimestamp(day);
            const bounds = e.currentTarget.getBoundingClientRect();
            const baseMinutes = this.firstMinute;
            const touchEvent = e;
            const mouseEvent = e;
            const touches = touchEvent.changedTouches || touchEvent.touches;
            const clientY = touches && touches[0] ? touches[0].clientY : mouseEvent.clientY;
            const addIntervals = (clientY - bounds.top) / this.parsedIntervalHeight;
            const addMinutes = Math.floor(addIntervals * this.parsedIntervalMinutes);
            const minutes = baseMinutes + addMinutes;
            return updateMinutes(timestamp, minutes, this.times.now);
        },
        getSlotScope(timestamp) {
            const scope = copyTimestamp(timestamp);
            scope.timeToY = this.timeToY;
            scope.minutesToPixels = this.minutesToPixels;
            return scope;
        },
        scrollToTime(time) {
            const y = this.timeToY(time);
            const pane = this.$refs.scrollArea;
            if (y === false || !pane) {
                return false;
            }
            pane.scrollTop = y;
            return true;
        },
        minutesToPixels(minutes) {
            return minutes / this.parsedIntervalMinutes * this.parsedIntervalHeight;
        },
        timeToY(time, clamp = true) {
            const minutes = parseTime(time);
            if (minutes === false) {
                return false;
            }
            const min = this.firstMinute;
            const gap = this.parsedIntervalCount * this.parsedIntervalMinutes;
            const delta = (minutes - min) / gap;
            let y = delta * this.bodyHeight;
            if (clamp) {
                if (y < 0) {
                    y = 0;
                }
                if (y > this.bodyHeight) {
                    y = this.bodyHeight;
                }
            }
            return y;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItd2l0aC1pbnRlcnZhbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WQ2FsZW5kYXIvbWl4aW5zL2NhbGVuZGFyLXdpdGgtaW50ZXJ2YWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLFNBQVM7QUFDVCxPQUFPLFlBQVksTUFBTSxpQkFBaUIsQ0FBQTtBQUUxQyxPQUFPO0FBQ1AsT0FBTyxLQUFLLE1BQU0sZUFBZSxDQUFBO0FBQ2pDLE9BQU8sRUFJTCxTQUFTLEVBQ1QsYUFBYSxFQUNiLGFBQWEsRUFDYixhQUFhLEVBQ2Isa0JBQWtCLEVBQ2xCLDJCQUEyQixFQUM1QixNQUFNLG1CQUFtQixDQUFBO0FBRTFCLG9CQUFvQjtBQUNwQixlQUFlLFlBQVksQ0FBQyxNQUFNLENBQUM7SUFDakMsSUFBSSxFQUFFLHlCQUF5QjtJQUUvQixLQUFLLEVBQUUsS0FBSyxDQUFDLFNBQVM7SUFFdEIsUUFBUSxFQUFFO1FBQ1IsbUJBQW1CO1lBQ2pCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUNyQyxDQUFDO1FBQ0QscUJBQXFCO1lBQ25CLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUN2QyxDQUFDO1FBQ0QsbUJBQW1CO1lBQ2pCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUNyQyxDQUFDO1FBQ0Qsb0JBQW9CO1lBQ2xCLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUN4QyxDQUFDO1FBQ0QsV0FBVztZQUNULE9BQU8sSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQTtRQUM5RCxDQUFDO1FBQ0QsVUFBVTtZQUNSLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQTtRQUM3RCxDQUFDO1FBQ0Qs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QUFxQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQTtRQUN6RSxDQUFDO1FBQ0QsT0FBTyxDQUFFLElBQVcsRUFBRSxLQUFLLEdBQUcsSUFBSTtZQUNoQyxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7WUFFL0IsSUFBSSxPQUFPLEtBQUssS0FBSyxFQUFFO2dCQUNyQixPQUFPLEtBQUssQ0FBQTthQUNiO1lBRUQsTUFBTSxHQUFHLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQTtZQUNwQyxNQUFNLEdBQUcsR0FBVyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFBO1lBQ3pFLE1BQU0sS0FBSyxHQUFXLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQTtZQUMzQyxJQUFJLENBQUMsR0FBVyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTtZQUV2QyxJQUFJLEtBQUssRUFBRTtnQkFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7b0JBQ1QsQ0FBQyxHQUFHLENBQUMsQ0FBQTtpQkFDTjtnQkFDRCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFO29CQUN2QixDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTtpQkFDcEI7YUFDRjtZQUVELE9BQU8sQ0FBQyxDQUFBO1FBQ1YsQ0FBQztLQUNGO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbi8vIE1peGluc1xyXG5pbXBvcnQgQ2FsZW5kYXJCYXNlIGZyb20gJy4vY2FsZW5kYXItYmFzZSdcclxuXHJcbi8vIFV0aWxcclxuaW1wb3J0IHByb3BzIGZyb20gJy4uL3V0aWwvcHJvcHMnXHJcbmltcG9ydCB7XHJcbiAgVlRpbWVzdGFtcCxcclxuICBWVGltZSxcclxuICBWVGltZXN0YW1wRm9ybWF0dGVyLFxyXG4gIHBhcnNlVGltZSxcclxuICBjb3B5VGltZXN0YW1wLFxyXG4gIHVwZGF0ZU1pbnV0ZXMsXHJcbiAgY3JlYXRlRGF5TGlzdCxcclxuICBjcmVhdGVJbnRlcnZhbExpc3QsXHJcbiAgY3JlYXRlTmF0aXZlTG9jYWxlRm9ybWF0dGVyXHJcbn0gZnJvbSAnLi4vdXRpbC90aW1lc3RhbXAnXHJcblxyXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xyXG5leHBvcnQgZGVmYXVsdCBDYWxlbmRhckJhc2UuZXh0ZW5kKHtcclxuICBuYW1lOiAnY2FsZW5kYXItd2l0aC1pbnRlcnZhbHMnLFxyXG5cclxuICBwcm9wczogcHJvcHMuaW50ZXJ2YWxzLFxyXG5cclxuICBjb21wdXRlZDoge1xyXG4gICAgcGFyc2VkRmlyc3RJbnRlcnZhbCAoKTogbnVtYmVyIHtcclxuICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuZmlyc3RJbnRlcnZhbClcclxuICAgIH0sXHJcbiAgICBwYXJzZWRJbnRlcnZhbE1pbnV0ZXMgKCk6IG51bWJlciB7XHJcbiAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLmludGVydmFsTWludXRlcylcclxuICAgIH0sXHJcbiAgICBwYXJzZWRJbnRlcnZhbENvdW50ICgpOiBudW1iZXIge1xyXG4gICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5pbnRlcnZhbENvdW50KVxyXG4gICAgfSxcclxuICAgIHBhcnNlZEludGVydmFsSGVpZ2h0ICgpOiBudW1iZXIge1xyXG4gICAgICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLmludGVydmFsSGVpZ2h0KVxyXG4gICAgfSxcclxuICAgIGZpcnN0TWludXRlICgpOiBudW1iZXIge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYXJzZWRGaXJzdEludGVydmFsICogdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXNcclxuICAgIH0sXHJcbiAgICBib2R5SGVpZ2h0ICgpOiBudW1iZXIge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYXJzZWRJbnRlcnZhbENvdW50ICogdGhpcy5wYXJzZWRJbnRlcnZhbEhlaWdodFxyXG4gICAgfSxcclxuICAgIGRheXMgKCk6IFZUaW1lc3RhbXBbXSB7XHJcbiAgICAgIHJldHVybiBjcmVhdGVEYXlMaXN0KFxyXG4gICAgICAgIHRoaXMucGFyc2VkU3RhcnQsXHJcbiAgICAgICAgdGhpcy5wYXJzZWRFbmQsXHJcbiAgICAgICAgdGhpcy50aW1lcy50b2RheSxcclxuICAgICAgICB0aGlzLndlZWtkYXlTa2lwcyxcclxuICAgICAgICB0aGlzLm1heERheXNcclxuICAgICAgKVxyXG4gICAgfSxcclxuICAgIGludGVydmFscyAoKTogVlRpbWVzdGFtcFtdW10ge1xyXG4gICAgICBjb25zdCBkYXlzOiBWVGltZXN0YW1wW10gPSB0aGlzLmRheXNcclxuICAgICAgY29uc3QgZmlyc3Q6IG51bWJlciA9IHRoaXMucGFyc2VkRmlyc3RJbnRlcnZhbFxyXG4gICAgICBjb25zdCBtaW51dGVzOiBudW1iZXIgPSB0aGlzLnBhcnNlZEludGVydmFsTWludXRlc1xyXG4gICAgICBjb25zdCBjb3VudDogbnVtYmVyID0gdGhpcy5wYXJzZWRJbnRlcnZhbENvdW50XHJcbiAgICAgIGNvbnN0IG5vdzogVlRpbWVzdGFtcCA9IHRoaXMudGltZXMubm93XHJcblxyXG4gICAgICByZXR1cm4gZGF5cy5tYXAoZCA9PiBjcmVhdGVJbnRlcnZhbExpc3QoZCwgZmlyc3QsIG1pbnV0ZXMsIGNvdW50LCBub3cpKVxyXG4gICAgfSxcclxuICAgIGludGVydmFsRm9ybWF0dGVyICgpOiBWVGltZXN0YW1wRm9ybWF0dGVyIHtcclxuICAgICAgaWYgKHRoaXMuaW50ZXJ2YWxGb3JtYXQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnRlcnZhbEZvcm1hdCBhcyBWVGltZXN0YW1wRm9ybWF0dGVyXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGxvbmdPcHRpb25zID0geyB0aW1lWm9uZTogJ1VUQycsIGhvdXIxMjogdHJ1ZSwgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9XHJcbiAgICAgIGNvbnN0IHNob3J0T3B0aW9ucyA9IHsgdGltZVpvbmU6ICdVVEMnLCBob3VyMTI6IHRydWUsIGhvdXI6ICdudW1lcmljJywgbWludXRlOiAnMi1kaWdpdCcgfVxyXG4gICAgICBjb25zdCBzaG9ydEhvdXJPcHRpb25zID0geyB0aW1lWm9uZTogJ1VUQycsIGhvdXIxMjogdHJ1ZSwgaG91cjogJ251bWVyaWMnIH1cclxuXHJcbiAgICAgIHJldHVybiBjcmVhdGVOYXRpdmVMb2NhbGVGb3JtYXR0ZXIoXHJcbiAgICAgICAgdGhpcy5sb2NhbGUsXHJcbiAgICAgICAgKHRtcywgc2hvcnQpID0+IHNob3J0ID8gKHRtcy5taW51dGUgPT09IDAgPyBzaG9ydEhvdXJPcHRpb25zIDogc2hvcnRPcHRpb25zKSA6IGxvbmdPcHRpb25zXHJcbiAgICAgIClcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBtZXRob2RzOiB7XHJcbiAgICBzaG93SW50ZXJ2YWxMYWJlbERlZmF1bHQgKGludGVydmFsOiBWVGltZXN0YW1wKTogYm9vbGVhbiB7XHJcbiAgICAgIGNvbnN0IGZpcnN0OiBWVGltZXN0YW1wID0gdGhpcy5pbnRlcnZhbHNbMF1bMF1cclxuICAgICAgY29uc3QgaXNGaXJzdDogYm9vbGVhbiA9IGZpcnN0LmhvdXIgPT09IGludGVydmFsLmhvdXIgJiYgZmlyc3QubWludXRlID09PSBpbnRlcnZhbC5taW51dGVcclxuICAgICAgcmV0dXJuICFpc0ZpcnN0ICYmIGludGVydmFsLm1pbnV0ZSA9PT0gMFxyXG4gICAgfSxcclxuICAgIGludGVydmFsU3R5bGVEZWZhdWx0IChfaW50ZXJ2YWw6IFZUaW1lc3RhbXApOiBvYmplY3QgfCB1bmRlZmluZWQge1xyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkXHJcbiAgICB9LFxyXG4gICAgZ2V0VGltZXN0YW1wQXRFdmVudCAoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQsIGRheTogVlRpbWVzdGFtcCk6IFZUaW1lc3RhbXAge1xyXG4gICAgICBjb25zdCB0aW1lc3RhbXA6IFZUaW1lc3RhbXAgPSBjb3B5VGltZXN0YW1wKGRheSlcclxuICAgICAgY29uc3QgYm91bmRzID0gKGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuICAgICAgY29uc3QgYmFzZU1pbnV0ZXM6IG51bWJlciA9IHRoaXMuZmlyc3RNaW51dGVcclxuICAgICAgY29uc3QgdG91Y2hFdmVudDogVG91Y2hFdmVudCA9IGUgYXMgVG91Y2hFdmVudFxyXG4gICAgICBjb25zdCBtb3VzZUV2ZW50OiBNb3VzZUV2ZW50ID0gZSBhcyBNb3VzZUV2ZW50XHJcbiAgICAgIGNvbnN0IHRvdWNoZXM6IFRvdWNoTGlzdCA9IHRvdWNoRXZlbnQuY2hhbmdlZFRvdWNoZXMgfHwgdG91Y2hFdmVudC50b3VjaGVzXHJcbiAgICAgIGNvbnN0IGNsaWVudFk6IG51bWJlciA9IHRvdWNoZXMgJiYgdG91Y2hlc1swXSA/IHRvdWNoZXNbMF0uY2xpZW50WSA6IG1vdXNlRXZlbnQuY2xpZW50WVxyXG4gICAgICBjb25zdCBhZGRJbnRlcnZhbHM6IG51bWJlciA9IChjbGllbnRZIC0gYm91bmRzLnRvcCkgLyB0aGlzLnBhcnNlZEludGVydmFsSGVpZ2h0XHJcbiAgICAgIGNvbnN0IGFkZE1pbnV0ZXM6IG51bWJlciA9IE1hdGguZmxvb3IoYWRkSW50ZXJ2YWxzICogdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXMpXHJcbiAgICAgIGNvbnN0IG1pbnV0ZXM6IG51bWJlciA9IGJhc2VNaW51dGVzICsgYWRkTWludXRlc1xyXG5cclxuICAgICAgcmV0dXJuIHVwZGF0ZU1pbnV0ZXModGltZXN0YW1wLCBtaW51dGVzLCB0aGlzLnRpbWVzLm5vdylcclxuICAgIH0sXHJcbiAgICBnZXRTbG90U2NvcGUgKHRpbWVzdGFtcDogVlRpbWVzdGFtcCk6IGFueSB7XHJcbiAgICAgIGNvbnN0IHNjb3BlID0gY29weVRpbWVzdGFtcCh0aW1lc3RhbXApIGFzIGFueVxyXG4gICAgICBzY29wZS50aW1lVG9ZID0gdGhpcy50aW1lVG9ZXHJcbiAgICAgIHNjb3BlLm1pbnV0ZXNUb1BpeGVscyA9IHRoaXMubWludXRlc1RvUGl4ZWxzXHJcbiAgICAgIHJldHVybiBzY29wZVxyXG4gICAgfSxcclxuICAgIHNjcm9sbFRvVGltZSAodGltZTogVlRpbWUpOiBib29sZWFuIHtcclxuICAgICAgY29uc3QgeSA9IHRoaXMudGltZVRvWSh0aW1lKVxyXG4gICAgICBjb25zdCBwYW5lID0gdGhpcy4kcmVmcy5zY3JvbGxBcmVhIGFzIEhUTUxFbGVtZW50XHJcblxyXG4gICAgICBpZiAoeSA9PT0gZmFsc2UgfHwgIXBhbmUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgfVxyXG5cclxuICAgICAgcGFuZS5zY3JvbGxUb3AgPSB5XHJcblxyXG4gICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSxcclxuICAgIG1pbnV0ZXNUb1BpeGVscyAobWludXRlczogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgcmV0dXJuIG1pbnV0ZXMgLyB0aGlzLnBhcnNlZEludGVydmFsTWludXRlcyAqIHRoaXMucGFyc2VkSW50ZXJ2YWxIZWlnaHRcclxuICAgIH0sXHJcbiAgICB0aW1lVG9ZICh0aW1lOiBWVGltZSwgY2xhbXAgPSB0cnVlKTogbnVtYmVyIHwgZmFsc2Uge1xyXG4gICAgICBjb25zdCBtaW51dGVzID0gcGFyc2VUaW1lKHRpbWUpXHJcblxyXG4gICAgICBpZiAobWludXRlcyA9PT0gZmFsc2UpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgbWluOiBudW1iZXIgPSB0aGlzLmZpcnN0TWludXRlXHJcbiAgICAgIGNvbnN0IGdhcDogbnVtYmVyID0gdGhpcy5wYXJzZWRJbnRlcnZhbENvdW50ICogdGhpcy5wYXJzZWRJbnRlcnZhbE1pbnV0ZXNcclxuICAgICAgY29uc3QgZGVsdGE6IG51bWJlciA9IChtaW51dGVzIC0gbWluKSAvIGdhcFxyXG4gICAgICBsZXQgeTogbnVtYmVyID0gZGVsdGEgKiB0aGlzLmJvZHlIZWlnaHRcclxuXHJcbiAgICAgIGlmIChjbGFtcCkge1xyXG4gICAgICAgIGlmICh5IDwgMCkge1xyXG4gICAgICAgICAgeSA9IDBcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHkgPiB0aGlzLmJvZHlIZWlnaHQpIHtcclxuICAgICAgICAgIHkgPSB0aGlzLmJvZHlIZWlnaHRcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB5XHJcbiAgICB9XHJcbiAgfVxyXG59KVxyXG4iXX0=