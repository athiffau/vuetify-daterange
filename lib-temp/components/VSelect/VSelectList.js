import '../../stylus/components/_cards.styl';
// Components
import VCheckbox from '../VCheckbox';
import VDivider from '../VDivider';
import VSubheader from '../VSubheader';
import { VList, VListTile, VListTileAction, VListTileContent, VListTileTitle } from '../VList';
// Mixins
import Colorable from '../../mixins/colorable';
import Themeable from '../../mixins/themeable';
// Helpers
import { escapeHTML, getPropertyFromItem } from '../../util/helpers';
/* @vue/component */
export default {
    name: 'v-select-list',
    mixins: [
        Colorable,
        Themeable
    ],
    props: {
        action: Boolean,
        dense: Boolean,
        hideSelected: Boolean,
        items: {
            type: Array,
            default: () => []
        },
        itemAvatar: {
            type: [String, Array, Function],
            default: 'avatar'
        },
        itemDisabled: {
            type: [String, Array, Function],
            default: 'disabled'
        },
        itemText: {
            type: [String, Array, Function],
            default: 'text'
        },
        itemValue: {
            type: [String, Array, Function],
            default: 'value'
        },
        noDataText: String,
        noFilter: Boolean,
        searchInput: {
            default: null
        },
        selectedItems: {
            type: Array,
            default: () => []
        }
    },
    computed: {
        parsedItems() {
            return this.selectedItems.map(item => this.getValue(item));
        },
        tileActiveClass() {
            return Object.keys(this.setTextColor(this.color).class || {}).join(' ');
        },
        staticNoDataTile() {
            const tile = {
                on: {
                    mousedown: e => e.preventDefault() // Prevent onBlur from being called
                }
            };
            return this.$createElement(VListTile, tile, [
                this.genTileContent(this.noDataText)
            ]);
        }
    },
    methods: {
        genAction(item, inputValue) {
            const data = {
                on: {
                    click: e => {
                        e.stopPropagation();
                        this.$emit('select', item);
                    }
                }
            };
            return this.$createElement(VListTileAction, data, [
                this.$createElement(VCheckbox, {
                    props: {
                        color: this.color,
                        inputValue
                    }
                })
            ]);
        },
        genDivider(props) {
            return this.$createElement(VDivider, { props });
        },
        genFilteredText(text) {
            text = (text || '').toString();
            if (!this.searchInput || this.noFilter)
                return escapeHTML(text);
            const { start, middle, end } = this.getMaskedCharacters(text);
            return `${escapeHTML(start)}${this.genHighlight(middle)}${escapeHTML(end)}`;
        },
        genHeader(props) {
            return this.$createElement(VSubheader, { props }, props.header);
        },
        genHighlight(text) {
            return `<span class="v-list__tile__mask">${escapeHTML(text)}</span>`;
        },
        getMaskedCharacters(text) {
            const searchInput = (this.searchInput || '').toString().toLocaleLowerCase();
            const index = text.toLocaleLowerCase().indexOf(searchInput);
            if (index < 0)
                return { start: '', middle: text, end: '' };
            const start = text.slice(0, index);
            const middle = text.slice(index, index + searchInput.length);
            const end = text.slice(index + searchInput.length);
            return { start, middle, end };
        },
        genTile(item, disabled = null, avatar = false, value = this.hasItem(item)) {
            if (item === Object(item)) {
                avatar = this.getAvatar(item);
                disabled = disabled !== null
                    ? disabled
                    : this.getDisabled(item);
            }
            const tile = {
                on: {
                    mousedown: e => {
                        // Prevent onBlur from being called
                        e.preventDefault();
                    },
                    click: () => disabled || this.$emit('select', item)
                },
                props: {
                    activeClass: this.tileActiveClass,
                    avatar,
                    disabled,
                    ripple: true,
                    value
                }
            };
            if (!this.$scopedSlots.item) {
                return this.$createElement(VListTile, tile, [
                    this.action && !this.hideSelected && this.items.length > 0
                        ? this.genAction(item, value)
                        : null,
                    this.genTileContent(item)
                ]);
            }
            const parent = this;
            const scopedSlot = this.$scopedSlots.item({ parent, item, tile });
            return this.needsTile(scopedSlot)
                ? this.$createElement(VListTile, tile, scopedSlot)
                : scopedSlot;
        },
        genTileContent(item) {
            const innerHTML = this.genFilteredText(this.getText(item));
            return this.$createElement(VListTileContent, [this.$createElement(VListTileTitle, {
                    domProps: { innerHTML }
                })]);
        },
        hasItem(item) {
            return this.parsedItems.indexOf(this.getValue(item)) > -1;
        },
        needsTile(slot) {
            return slot.length !== 1 ||
                slot[0].componentOptions == null ||
                slot[0].componentOptions.Ctor.options.name !== 'v-list-tile';
        },
        getAvatar(item) {
            return Boolean(getPropertyFromItem(item, this.itemAvatar, false));
        },
        getDisabled(item) {
            return Boolean(getPropertyFromItem(item, this.itemDisabled, false));
        },
        getText(item) {
            return String(getPropertyFromItem(item, this.itemText, item));
        },
        getValue(item) {
            return getPropertyFromItem(item, this.itemValue, this.getText(item));
        }
    },
    render() {
        const children = [];
        for (const item of this.items) {
            if (this.hideSelected &&
                this.hasItem(item))
                continue;
            if (item == null)
                children.push(this.genTile(item));
            else if (item.header)
                children.push(this.genHeader(item));
            else if (item.divider)
                children.push(this.genDivider(item));
            else
                children.push(this.genTile(item));
        }
        children.length || children.push(this.$slots['no-data'] || this.staticNoDataTile);
        this.$slots['prepend-item'] && children.unshift(this.$slots['prepend-item']);
        this.$slots['append-item'] && children.push(this.$slots['append-item']);
        return this.$createElement('div', {
            staticClass: 'v-select-list v-card',
            'class': this.themeClasses
        }, [
            this.$createElement(VList, {
                props: {
                    dense: this.dense
                }
            }, children)
        ]);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlNlbGVjdExpc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WU2VsZWN0L1ZTZWxlY3RMaXN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8scUNBQXFDLENBQUE7QUFFNUMsYUFBYTtBQUNiLE9BQU8sU0FBUyxNQUFNLGNBQWMsQ0FBQTtBQUNwQyxPQUFPLFFBQVEsTUFBTSxhQUFhLENBQUE7QUFDbEMsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sRUFDTCxLQUFLLEVBQ0wsU0FBUyxFQUNULGVBQWUsRUFDZixnQkFBZ0IsRUFDaEIsY0FBYyxFQUNmLE1BQU0sVUFBVSxDQUFBO0FBRWpCLFNBQVM7QUFDVCxPQUFPLFNBQVMsTUFBTSx3QkFBd0IsQ0FBQTtBQUM5QyxPQUFPLFNBQVMsTUFBTSx3QkFBd0IsQ0FBQTtBQUU5QyxVQUFVO0FBQ1YsT0FBTyxFQUNMLFVBQVUsRUFDVixtQkFBbUIsRUFDcEIsTUFBTSxvQkFBb0IsQ0FBQTtBQUUzQixvQkFBb0I7QUFDcEIsZUFBZTtJQUNiLElBQUksRUFBRSxlQUFlO0lBRXJCLE1BQU0sRUFBRTtRQUNOLFNBQVM7UUFDVCxTQUFTO0tBQ1Y7SUFFRCxLQUFLLEVBQUU7UUFDTCxNQUFNLEVBQUUsT0FBTztRQUNmLEtBQUssRUFBRSxPQUFPO1FBQ2QsWUFBWSxFQUFFLE9BQU87UUFDckIsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLEtBQUs7WUFDWCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtTQUNsQjtRQUNELFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDO1lBQy9CLE9BQU8sRUFBRSxRQUFRO1NBQ2xCO1FBQ0QsWUFBWSxFQUFFO1lBQ1osSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUM7WUFDL0IsT0FBTyxFQUFFLFVB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LENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1FBRWpGLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUE7UUFFNUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQTtRQUV2RSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFO1lBQ2hDLFdBQVcsRUFBRSxzQkFBc0I7WUFDbkMsT0FBTyxFQUFFLElBQUksQ0FBQyxZQUFZO1NBQzNCLEVBQUU7WUFDRCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRTtnQkFDekIsS0FBSyxFQUFFO29CQUNMLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztpQkFDbEI7YUFDRixFQUFFLFFBQVEsQ0FBQztTQUNiLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuLi8uLi9zdHlsdXMvY29tcG9uZW50cy9fY2FyZHMuc3R5bCdcclxuXHJcbi8vIENvbXBvbmVudHNcclxuaW1wb3J0IFZDaGVja2JveCBmcm9tICcuLi9WQ2hlY2tib3gnXHJcbmltcG9ydCBWRGl2aWRlciBmcm9tICcuLi9WRGl2aWRlcidcclxuaW1wb3J0IFZTdWJoZWFkZXIgZnJvbSAnLi4vVlN1YmhlYWRlcidcclxuaW1wb3J0IHtcclxuICBWTGlzdCxcclxuICBWTGlzdFRpbGUsXHJcbiAgVkxpc3RUaWxlQWN0aW9uLFxyXG4gIFZMaXN0VGlsZUNvbnRlbnQsXHJcbiAgVkxpc3RUaWxlVGl0bGVcclxufSBmcm9tICcuLi9WTGlzdCdcclxuXHJcbi8vIE1peGluc1xyXG5pbXBvcnQgQ29sb3JhYmxlIGZyb20gJy4uLy4uL21peGlucy9jb2xvcmFibGUnXHJcbmltcG9ydCBUaGVtZWFibGUgZnJvbSAnLi4vLi4vbWl4aW5zL3RoZW1lYWJsZSdcclxuXHJcbi8vIEhlbHBlcnNcclxuaW1wb3J0IHtcclxuICBlc2NhcGVIVE1MLFxyXG4gIGdldFByb3BlcnR5RnJvbUl0ZW1cclxufSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnXHJcblxyXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgbmFtZTogJ3Ytc2VsZWN0LWxpc3QnLFxyXG5cclxuICBtaXhpbnM6IFtcclxuICAgIENvbG9yYWJsZSxcclxuICAgIFRoZW1lYWJsZVxyXG4gIF0sXHJcblxyXG4gIHByb3BzOiB7XHJcbiAgICBhY3Rpb246IEJvb2xlYW4sXHJcbiAgICBkZW5zZTogQm9vbGVhbixcclxuICAgIGhpZGVTZWxlY3RlZDogQm9vbGVhbixcclxuICAgIGl0ZW1zOiB7XHJcbiAgICAgIHR5cGU6IEFycmF5LFxyXG4gICAgICBkZWZhdWx0OiAoKSA9PiBbXVxyXG4gICAgfSxcclxuICAgIGl0ZW1BdmF0YXI6IHtcclxuICAgICAgdHlwZTogW1N0cmluZywgQXJyYXksIEZ1bmN0aW9uXSxcclxuICAgICAgZGVmYXVsdDogJ2F2YXRhcidcclxuICAgIH0sXHJcbiAgICBpdGVtRGlzYWJsZWQ6IHtcclxuICAgICAgdHlwZTogW1N0cmluZywgQXJyYXksIEZ1bmN0aW9uXSxcclxuICAgICAgZGVmYXVsdDogJ2Rpc2FibGVkJ1xyXG4gICAgfSxcclxuICAgIGl0ZW1UZXh0OiB7XHJcbiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5LCBGdW5jdGlvbl0sXHJcbiAgICAgIGRlZmF1bHQ6ICd0ZXh0J1xyXG4gICAgfSxcclxuICAgIGl0ZW1WYWx1ZToge1xyXG4gICAgICB0eXBlOiBbU3RyaW5nLCBBcnJheSwgRnVuY3Rpb25dLFxyXG4gICAgICBkZWZhdWx0OiAndmFsdWUnXHJcbiAgICB9LFxyXG4gICAgbm9EYXRhVGV4dDogU3RyaW5nLFxyXG4gICAgbm9GaWx0ZXI6IEJvb2xlYW4sXHJcbiAgICBzZWFyY2hJbnB1dDoge1xyXG4gICAgICBkZWZhdWx0OiBudWxsXHJcbiAgICB9LFxyXG4gICAgc2VsZWN0ZWRJdGVtczoge1xyXG4gICAgICB0eXBlOiBBcnJheSxcclxuICAgICAgZGVmYXVsdDogKCkgPT4gW11cclxuICAgIH1cclxuICB9LFxyXG5cclxuICBjb21wdXRlZDoge1xyXG4gICAgcGFyc2VkSXRlbXMgKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZEl0ZW1zLm1hcChpdGVtID0+IHRoaXMuZ2V0VmFsdWUoaXRlbSkpXHJcbiAgICB9LFxyXG4gICAgdGlsZUFjdGl2ZUNsYXNzICgpIHtcclxuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuc2V0VGV4dENvbG9yKHRoaXMuY29sb3IpLmNsYXNzIHx8IHt9KS5qb2luKCcgJylcclxuICAgIH0sXHJcbiAgICBzdGF0aWNOb0RhdGFUaWxlICgpIHtcclxuICAgICAgY29uc3QgdGlsZSA9IHtcclxuICAgICAgICBvbjoge1xyXG4gICAgICAgICAgbW91c2Vkb3duOiBlID0+IGUucHJldmVudERlZmF1bHQoKSAvLyBQcmV2ZW50IG9uQmx1ciBmcm9tIGJlaW5nIGNhbGxlZFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVkxpc3RUaWxlLCB0aWxlLCBbXHJcbiAgICAgICAgdGhpcy5nZW5UaWxlQ29udGVudCh0aGlzLm5vRGF0YVRleHQpXHJcbiAgICAgIF0pXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgbWV0aG9kczoge1xyXG4gICAgZ2VuQWN0aW9uIChpdGVtLCBpbnB1dFZhbHVlKSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgb246IHtcclxuICAgICAgICAgIGNsaWNrOiBlID0+IHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxyXG4gICAgICAgICAgICB0aGlzLiRlbWl0KCdzZWxlY3QnLCBpdGVtKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVkxpc3RUaWxlQWN0aW9uLCBkYXRhLCBbXHJcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudChWQ2hlY2tib3gsIHtcclxuICAgICAgICAgIHByb3BzOiB7XHJcbiAgICAgICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yLFxyXG4gICAgICAgICAgICBpbnB1dFZhbHVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgXSlcclxuICAgIH0sXHJcbiAgICBnZW5EaXZpZGVyIChwcm9wcykge1xyXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudChWRGl2aWRlciwgeyBwcm9wcyB9KVxyXG4gICAgfSxcclxuICAgIGdlbkZpbHRlcmVkVGV4dCAodGV4dCkge1xyXG4gICAgICB0ZXh0ID0gKHRleHQgfHwgJycpLnRvU3RyaW5nKClcclxuXHJcbiAgICAgIGlmICghdGhpcy5zZWFyY2hJbnB1dCB8fCB0aGlzLm5vRmlsdGVyKSByZXR1cm4gZXNjYXBlSFRNTCh0ZXh0KVxyXG5cclxuICAgICAgY29uc3QgeyBzdGFydCwgbWlkZGxlLCBlbmQgfSA9IHRoaXMuZ2V0TWFza2VkQ2hhcmFjdGVycyh0ZXh0KVxyXG5cclxuICAgICAgcmV0dXJuIGAke2VzY2FwZUhUTUwoc3RhcnQpfSR7dGhpcy5nZW5IaWdobGlnaHQobWlkZGxlKX0ke2VzY2FwZUhUTUwoZW5kKX1gXHJcbiAgICB9LFxyXG4gICAgZ2VuSGVhZGVyIChwcm9wcykge1xyXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudChWU3ViaGVhZGVyLCB7IHByb3BzIH0sIHByb3BzLmhlYWRlcilcclxuICAgIH0sXHJcbiAgICBnZW5IaWdobGlnaHQgKHRleHQpIHtcclxuICAgICAgcmV0dXJuIGA8c3BhbiBjbGFzcz1cInYtbGlzdF9fdGlsZV9fbWFza1wiPiR7ZXNjYXBlSFRNTCh0ZXh0KX08L3NwYW4+YFxyXG4gICAgfSxcclxuICAgIGdldE1hc2tlZENoYXJhY3RlcnMgKHRleHQpIHtcclxuICAgICAgY29uc3Qgc2VhcmNoSW5wdXQgPSAodGhpcy5zZWFyY2hJbnB1dCB8fCAnJykudG9TdHJpbmcoKS50b0xvY2FsZUxvd2VyQ2FzZSgpXHJcbiAgICAgIGNvbnN0IGluZGV4ID0gdGV4dC50b0xvY2FsZUxvd2VyQ2FzZSgpLmluZGV4T2Yoc2VhcmNoSW5wdXQpXHJcblxyXG4gICAgICBpZiAoaW5kZXggPCAwKSByZXR1cm4geyBzdGFydDogJycsIG1pZGRsZTogdGV4dCwgZW5kOiAnJyB9XHJcblxyXG4gICAgICBjb25zdCBzdGFydCA9IHRleHQuc2xpY2UoMCwgaW5kZXgpXHJcbiAgICAgIGNvbnN0IG1pZGRsZSA9IHRleHQuc2xpY2UoaW5kZXgsIGluZGV4ICsgc2VhcmNoSW5wdXQubGVuZ3RoKVxyXG4gICAgICBjb25zdCBlbmQgPSB0ZXh0LnNsaWNlKGluZGV4ICsgc2VhcmNoSW5wdXQubGVuZ3RoKVxyXG4gICAgICByZXR1cm4geyBzdGFydCwgbWlkZGxlLCBlbmQgfVxyXG4gICAgfSxcclxuICAgIGdlblRpbGUgKFxyXG4gICAgICBpdGVtLFxyXG4gICAgICBkaXNhYmxlZCA9IG51bGwsXHJcbiAgICAgIGF2YXRhciA9IGZhbHNlLFxyXG4gICAgICB2YWx1ZSA9IHRoaXMuaGFzSXRlbShpdGVtKVxyXG4gICAgKSB7XHJcbiAgICAgIGlmIChpdGVtID09PSBPYmplY3QoaXRlbSkpIHtcclxuICAgICAgICBhdmF0YXIgPSB0aGlzLmdldEF2YXRhcihpdGVtKVxyXG4gICAgICAgIGRpc2FibGVkID0gZGlzYWJsZWQgIT09IG51bGxcclxuICAgICAgICAgID8gZGlzYWJsZWRcclxuICAgICAgICAgIDogdGhpcy5nZXREaXNhYmxlZChpdGVtKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB0aWxlID0ge1xyXG4gICAgICAgIG9uOiB7XHJcbiAgICAgICAgICBtb3VzZWRvd246IGUgPT4ge1xyXG4gICAgICAgICAgICAvLyBQcmV2ZW50IG9uQmx1ciBmcm9tIGJlaW5nIGNhbGxlZFxyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjbGljazogKCkgPT4gZGlzYWJsZWQgfHwgdGhpcy4kZW1pdCgnc2VsZWN0JywgaXRlbSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByb3BzOiB7XHJcbiAgICAgICAgICBhY3RpdmVDbGFzczogdGhpcy50aWxlQWN0aXZlQ2xhc3MsXHJcbiAgICAgICAgICBhdmF0YXIsXHJcbiAgICAgICAgICBkaXNhYmxlZCxcclxuICAgICAgICAgIHJpcHBsZTogdHJ1ZSxcclxuICAgICAgICAgIHZhbHVlXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXRoaXMuJHNjb3BlZFNsb3RzLml0ZW0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudChWTGlzdFRpbGUsIHRpbGUsIFtcclxuICAgICAgICAgIHRoaXMuYWN0aW9uICYmICF0aGlzLmhpZGVTZWxlY3RlZCAmJiB0aGlzLml0ZW1zLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgPyB0aGlzLmdlbkFjdGlvbihpdGVtLCB2YWx1ZSlcclxuICAgICAgICAgICAgOiBudWxsLFxyXG4gICAgICAgICAgdGhpcy5nZW5UaWxlQ29udGVudChpdGVtKVxyXG4gICAgICAgIF0pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXNcclxuICAgICAgY29uc3Qgc2NvcGVkU2xvdCA9IHRoaXMuJHNjb3BlZFNsb3RzLml0ZW0oeyBwYXJlbnQsIGl0ZW0sIHRpbGUgfSlcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLm5lZWRzVGlsZShzY29wZWRTbG90KVxyXG4gICAgICAgID8gdGhpcy4kY3JlYXRlRWxlbWVudChWTGlzdFRpbGUsIHRpbGUsIHNjb3BlZFNsb3QpXHJcbiAgICAgICAgOiBzY29wZWRTbG90XHJcbiAgICB9LFxyXG4gICAgZ2VuVGlsZUNvbnRlbnQgKGl0ZW0pIHtcclxuICAgICAgY29uc3QgaW5uZXJIVE1MID0gdGhpcy5nZW5GaWx0ZXJlZFRleHQodGhpcy5nZXRUZXh0KGl0ZW0pKVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVkxpc3RUaWxlQ29udGVudCxcclxuICAgICAgICBbdGhpcy4kY3JlYXRlRWxlbWVudChWTGlzdFRpbGVUaXRsZSwge1xyXG4gICAgICAgICAgZG9tUHJvcHM6IHsgaW5uZXJIVE1MIH1cclxuICAgICAgICB9KV1cclxuICAgICAgKVxyXG4gICAgfSxcclxuICAgIGhhc0l0ZW0gKGl0ZW0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFyc2VkSXRlbXMuaW5kZXhPZih0aGlzLmdldFZhbHVlKGl0ZW0pKSA+IC0xXHJcbiAgICB9LFxyXG4gICAgbmVlZHNUaWxlIChzbG90KSB7XHJcbiAgICAgIHJldHVybiBzbG90Lmxlbmd0aCAhPT0gMSB8fFxyXG4gICAgICAgIHNsb3RbMF0uY29tcG9uZW50T3B0aW9ucyA9PSBudWxsIHx8XHJcbiAgICAgICAgc2xvdFswXS5jb21wb25lbnRPcHRpb25zLkN0b3Iub3B0aW9ucy5uYW1lICE9PSAndi1saXN0LXRpbGUnXHJcbiAgICB9LFxyXG4gICAgZ2V0QXZhdGFyIChpdGVtKSB7XHJcbiAgICAgIHJldHVybiBCb29sZWFuKGdldFByb3BlcnR5RnJvbUl0ZW0oaXRlbSwgdGhpcy5pdGVtQXZhdGFyLCBmYWxzZSkpXHJcbiAgICB9LFxyXG4gICAgZ2V0RGlzYWJsZWQgKGl0ZW0pIHtcclxuICAgICAgcmV0dXJuIEJvb2xlYW4oZ2V0UHJvcGVydHlGcm9tSXRlbShpdGVtLCB0aGlzLml0ZW1EaXNhYmxlZCwgZmFsc2UpKVxyXG4gICAgfSxcclxuICAgIGdldFRleHQgKGl0ZW0pIHtcclxuICAgICAgcmV0dXJuIFN0cmluZyhnZXRQcm9wZXJ0eUZyb21JdGVtKGl0ZW0sIHRoaXMuaXRlbVRleHQsIGl0ZW0pKVxyXG4gICAgfSxcclxuICAgIGdldFZhbHVlIChpdGVtKSB7XHJcbiAgICAgIHJldHVybiBnZXRQcm9wZXJ0eUZyb21JdGVtKGl0ZW0sIHRoaXMuaXRlbVZhbHVlLCB0aGlzLmdldFRleHQoaXRlbSkpXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgcmVuZGVyICgpIHtcclxuICAgIGNvbnN0IGNoaWxkcmVuID0gW11cclxuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLml0ZW1zKSB7XHJcbiAgICAgIGlmICh0aGlzLmhpZGVTZWxlY3RlZCAmJlxyXG4gICAgICAgIHRoaXMuaGFzSXRlbShpdGVtKVxyXG4gICAgICApIGNvbnRpbnVlXHJcblxyXG4gICAgICBpZiAoaXRlbSA9PSBudWxsKSBjaGlsZHJlbi5wdXNoKHRoaXMuZ2VuVGlsZShpdGVtKSlcclxuICAgICAgZWxzZSBpZiAoaXRlbS5oZWFkZXIpIGNoaWxkcmVuLnB1c2godGhpcy5nZW5IZWFkZXIoaXRlbSkpXHJcbiAgICAgIGVsc2UgaWYgKGl0ZW0uZGl2aWRlcikgY2hpbGRyZW4ucHVzaCh0aGlzLmdlbkRpdmlkZXIoaXRlbSkpXHJcbiAgICAgIGVsc2UgY2hpbGRyZW4ucHVzaCh0aGlzLmdlblRpbGUoaXRlbSkpXHJcbiAgICB9XHJcblxyXG4gICAgY2hpbGRyZW4ubGVuZ3RoIHx8IGNoaWxkcmVuLnB1c2godGhpcy4kc2xvdHNbJ25vLWRhdGEnXSB8fCB0aGlzLnN0YXRpY05vRGF0YVRpbGUpXHJcblxyXG4gICAgdGhpcy4kc2xvdHNbJ3ByZXBlbmQtaXRlbSddICYmIGNoaWxkcmVuLnVuc2hpZnQodGhpcy4kc2xvdHNbJ3ByZXBlbmQtaXRlbSddKVxyXG5cclxuICAgIHRoaXMuJHNsb3RzWydhcHBlbmQtaXRlbSddICYmIGNoaWxkcmVuLnB1c2godGhpcy4kc2xvdHNbJ2FwcGVuZC1pdGVtJ10pXHJcblxyXG4gICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcclxuICAgICAgc3RhdGljQ2xhc3M6ICd2LXNlbGVjdC1saXN0IHYtY2FyZCcsXHJcbiAgICAgICdjbGFzcyc6IHRoaXMudGhlbWVDbGFzc2VzXHJcbiAgICB9LCBbXHJcbiAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVkxpc3QsIHtcclxuICAgICAgICBwcm9wczoge1xyXG4gICAgICAgICAgZGVuc2U6IHRoaXMuZGVuc2VcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGNoaWxkcmVuKVxyXG4gICAgXSlcclxuICB9XHJcbn1cclxuIl19