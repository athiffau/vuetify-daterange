// Mixins
import Colorable from '../../mixins/colorable';
// Utilities
import mixins from '../../util/mixins';
import { genPoints } from './helpers/core';
import { genPath } from './helpers/path';
export default mixins(Colorable).extend({
    name: 'VSparkline',
    props: {
        autoDraw: Boolean,
        autoDrawDuration: {
            type: Number,
            default: 2000
        },
        autoDrawEasing: {
            type: String,
            default: 'ease'
        },
        color: {
            type: String,
            default: 'primary'
        },
        fill: {
            type: Boolean,
            default: false
        },
        gradient: {
            type: Array,
            default: () => ([])
        },
        gradientDirection: {
            type: String,
            validator: (val) => ['top', 'bottom', 'left', 'right'].includes(val),
            default: 'top'
        },
        height: {
            type: [String, Number],
            default: 75
        },
        labels: {
            type: Array,
            default: () => ([])
        },
        lineWidth: {
            type: [String, Number],
            default: 4
        },
        padding: {
            type: [String, Number],
            default: 8
        },
        smooth: {
            type: [Boolean, Number, String],
            default: false
        },
        showLabels: Boolean,
        type: {
            type: String,
            default: 'trend',
            validator: (val) => ['trend', 'bar'].includes(val)
        },
        value: {
            type: Array,
            default: () => ([])
        },
        width: {
            type: [Number, String],
            default: 300
        }
    },
    data: () => ({
        lastLength: 0
    }),
    computed: {
        boundary() {
            const padding = Number(this.padding);
            const height = Number(this.height);
            const width = Number(this.width);
            return {
                minX: padding,
                minY: padding,
                maxX: width - padding,
                maxY: height - padding
            };
        },
        hasLabels() {
            return Boolean(this.showLabels ||
                this.labels.length > 0 ||
                this.$scopedSlots.label);
        },
        parsedLabels() {
            const labels = [];
            const points = this.points;
            const len = points.length;
            for (let i = 0; labels.length < len; i++) {
                const item = points[i];
                let value = this.labels[i];
                if (!value) {
                    value = item === Object(item)
                        ? item.value
                        : item;
                }
                labels.push({
                    ...item,
                    value: String(value)
                });
            }
            return labels;
        },
        points() {
            return genPoints(this.value.slice(), this.boundary);
        },
        textY() {
            return this.boundary.maxY + 6;
        }
    },
    watch: {
        value: {
            immediate: true,
            handler() {
                this.$nextTick(() => {
                    if (!this.autoDraw || this.type === 'bar')
                        return;
                    const path = this.$refs.path;
                    const length = path.getTotalLength();
                    if (!this.fill) {
                        path.style.transition = 'none';
                        path.style.strokeDasharray = length + ' ' + length;
                        path.style.strokeDashoffset = Math.abs(length - (this.lastLength || 0)).toString();
                        path.getBoundingClientRect();
                        path.style.transition = `stroke-dashoffset ${this.autoDrawDuration}ms ${this.autoDrawEasing}`;
                        path.style.strokeDashoffset = '0';
                    }
                    else {
                        path.style.transformOrigin = 'bottom center';
                        path.style.transition = 'none';
                        path.style.transform = `scaleY(0)`;
                        path.getBoundingClientRect();
                        path.style.transition = `transform ${this.autoDrawDuration}ms ${this.autoDrawEasing}`;
                        path.style.transform = `scaleY(1)`;
                    }
                    this.lastLength = length;
                });
            }
        }
    },
    methods: {
        genGradient() {
            const gradientDirection = this.gradientDirection;
            const gradient = this.gradient.slice();
            // Pushes empty string to force
            // a fallback to currentColor
            if (!gradient.length)
                gradient.push('');
            const len = Math.max(gradient.length - 1, 1);
            const stops = gradient.reverse().map((color, index) => this.$createElement('stop', {
                attrs: {
                    offset: index / len,
                    'stop-color': color || this.color || 'currentColor'
                }
            }));
            return this.$createElement('defs', [
                this.$createElement('linearGradient', {
                    attrs: {
                        id: this._uid,
                        x1: +(gradientDirection === 'left'),
                        y1: +(gradientDirection === 'top'),
                        x2: +(gradientDirection === 'right'),
                        y2: +(gradientDirection === 'bottom')
                    }
                }, stops)
            ]);
        },
        genG(children) {
            return this.$createElement('g', {
                style: {
                    fontSize: '8',
                    textAnchor: 'middle',
                    dominantBaseline: 'mathematical',
                    fill: this.color || 'currentColor'
                }
            }, children);
        },
        genLabels() {
            if (!this.hasLabels)
                return undefined;
            return this.genG(this.parsedLabels.map(this.genText));
        },
        genPath() {
            const radius = this.smooth === true ? 8 : Number(this.smooth);
            return this.$createElement('path', {
                attrs: {
                    id: this._uid,
                    d: genPath(this.points.slice(), radius, this.fill, Number(this.height)),
                    fill: this.fill ? `url(#${this._uid})` : 'none',
                    stroke: this.fill ? 'none' : `url(#${this._uid})`
                },
                ref: 'path'
            });
        },
        genText(item, index) {
            const children = this.$scopedSlots.label
                ? this.$scopedSlots.label({ index, value: item.value })
                : item.value;
            return this.$createElement('text', {
                attrs: {
                    x: item.x,
                    y: this.textY
                }
            }, [children]);
        },
        genBar() {
            if (!this.value || this.value.length < 2)
                return undefined;
            const { width, height, padding, lineWidth } = this;
            const viewWidth = width || this.value.length * Number(padding) * 2;
            const viewHeight = height || 75;
            const boundary = {
                minX: Number(padding),
                minY: Number(padding),
                maxX: Number(viewWidth) - Number(padding),
                maxY: Number(viewHeight) - Number(padding)
            };
            const props = {
                ...this.$props
            };
            props.points = genPoints(this.value, boundary);
            const totalWidth = boundary.maxX / (props.points.length - 1);
            props.boundary = boundary;
            props.lineWidth = lineWidth || (totalWidth - Number(padding || 5));
            props.offsetX = (totalWidth - props.lineWidth) / 2;
            return this.$createElement('svg', {
                attrs: {
                    width: '100%',
                    height: '25%',
                    viewBox: `0 0 ${viewWidth} ${viewHeight}`
                }
            }, [
                this.genGradient(),
                this.genClipPath(props.offsetX, 'sparkline-bar-' + this._uid),
                this.showLabels ? this.genBarLabels(props) : undefined,
                this.$createElement('g', {
                    attrs: {
                        transform: `scale(1,-1) translate(0,-${boundary.maxY})`,
                        'clip-path': `url(#sparkline-bar-${this._uid}-clip)`,
                        fill: `url(#${this._uid})`
                    }
                }, [
                    this.$createElement('rect', {
                        attrs: {
                            x: 0,
                            y: 0,
                            width: viewWidth,
                            height: viewHeight
                        }
                    })
                ])
            ]);
        },
        genClipPath(offsetX, id) {
            const { maxY } = this.boundary;
            const rounding = typeof this.smooth === 'number'
                ? this.smooth
                : this.smooth ? 2 : 0;
            return this.$createElement('clipPath', {
                attrs: {
                    id: `${id}-clip`
                }
            }, this.points.map(item => this.$createElement('rect', {
                attrs: {
                    x: item.x - offsetX,
                    y: 0,
                    width: this.lineWidth,
                    height: Math.max(maxY - item.y, 0),
                    rx: rounding,
                    ry: rounding
                }
            }, [
                this.autoDraw ? this.$createElement('animate', {
                    attrs: {
                        attributeName: 'height',
                        from: 0,
                        to: maxY - item.y,
                        dur: `${this.autoDrawDuration}ms`,
                        fill: 'freeze'
                    }
                }) : undefined
            ])));
        },
        genBarLabels(props) {
            const offsetX = (props.offsetX || 0) / 2;
            const children = props.points.map(item => (this.$createElement('text', {
                attrs: {
                    x: item.x - offsetX * -0.45 - 10,
                    y: props.boundary.maxY + 10
                }
            }, item.value.toString())));
            return this.genG(children);
        },
        genTrend() {
            return this.$createElement('svg', this.setTextColor(this.color, {
                attrs: {
                    'stroke-width': this.lineWidth || 1,
                    width: '100%',
                    height: '25%',
                    viewBox: `0 0 ${this.width} ${this.height}`
                }
            }), [
                this.genGradient(),
                this.genLabels(),
                this.genPath()
            ]);
        }
    },
    render(h) {
        if (this.value.length < 2)
            return undefined;
        return this.type === 'trend'
            ? this.genTrend()
            : this.genBar();
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlNwYXJrbGluZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZTcGFya2xpbmUvVlNwYXJrbGluZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTO0FBQ1QsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFFOUMsWUFBWTtBQUNaLE9BQU8sTUFBc0IsTUFBTSxtQkFBbUIsQ0FBQTtBQUN0RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFDMUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBc0N4QyxlQUFlLE1BQU0sQ0FPbkIsU0FBUyxDQUNWLENBQUMsTUFBTSxDQUFDO0lBQ1AsSUFBSSxFQUFFLFlBQVk7SUFFbEIsS0FBSyxFQUFFO1FBQ0wsUUFBUSxFQUFFLE9BQU87UUFDakIsZ0JBQWdCLEVBQUU7WUFDaEIsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsY0FBYyxFQUFFO1lBQ2QsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsTUFBTTtTQUNoQjtRQUNELEtBQUssRUFBRTtZQUNMLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLFNBQVM7U0FDbkI7UUFDRCxJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsT0FBTztZQUNiLE9BQU8sRUFBRSxLQUFLO1NBQ2Y7UUFDRCxRQUFRLEVBQUU7WUFDUixJQUFJLEVBQUUsS0FBdUI7WUFDN0IsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQ3BCO1FBQ0QsaUJBQWlCLEVBQUU7WUFDakIsSUFBSSxFQUFFLE1BQW1EO1lBQ3pELFNBQVMsRUFBRSxDQUFDLEdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDO1lB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QUE7UUFDSixDQUFDO0tBQ0Y7SUFFRCxNQUFNLENBQUUsQ0FBQztRQUNQLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUFFLE9BQU8sU0FBa0IsQ0FBQTtRQUVwRCxPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssT0FBTztZQUMxQixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFBO0lBQ25CLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBNaXhpbnNcclxuaW1wb3J0IENvbG9yYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvY29sb3JhYmxlJ1xyXG5cclxuLy8gVXRpbGl0aWVzXHJcbmltcG9ydCBtaXhpbnMsIHsgRXh0cmFjdFZ1ZSB9IGZyb20gJy4uLy4uL3V0aWwvbWl4aW5zJ1xyXG5pbXBvcnQgeyBnZW5Qb2ludHMgfSBmcm9tICcuL2hlbHBlcnMvY29yZSdcclxuaW1wb3J0IHsgZ2VuUGF0aCB9IGZyb20gJy4vaGVscGVycy9wYXRoJ1xyXG5cclxuLy8gVHlwZXNcclxuaW1wb3J0IFZ1ZSwgeyBWTm9kZSB9IGZyb20gJ3Z1ZSdcclxuaW1wb3J0IHsgUHJvcCwgUHJvcFZhbGlkYXRvciB9IGZyb20gJ3Z1ZS90eXBlcy9vcHRpb25zJ1xyXG5cclxuZXhwb3J0IHR5cGUgU3BhcmtsaW5lSXRlbSA9IG51bWJlciB8IHsgdmFsdWU6IG51bWJlciB9XHJcblxyXG5leHBvcnQgdHlwZSBTcGFya2xpbmVUZXh0ID0ge1xyXG4gIHg6IG51bWJlclxyXG4gIHZhbHVlOiBzdHJpbmdcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBCb3VuZGFyeSB7XHJcbiAgbWluWDogbnVtYmVyXHJcbiAgbWluWTogbnVtYmVyXHJcbiAgbWF4WDogbnVtYmVyXHJcbiAgbWF4WTogbnVtYmVyXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUG9pbnQge1xyXG4gIHg6IG51bWJlclxyXG4gIHk6IG51bWJlclxyXG4gIHZhbHVlOiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBCYXJUZXh0IHtcclxuICBwb2ludHM6IFBvaW50W11cclxuICBib3VuZGFyeTogQm91bmRhcnlcclxuICBvZmZzZXRYOiBudW1iZXJcclxufVxyXG5cclxuaW50ZXJmYWNlIG9wdGlvbnMgZXh0ZW5kcyBWdWUge1xyXG4gICRyZWZzOiB7XHJcbiAgICBwYXRoOiBTVkdQYXRoRWxlbWVudFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgbWl4aW5zPG9wdGlvbnMgJlxyXG4vKiBlc2xpbnQtZGlzYWJsZSBpbmRlbnQgKi9cclxuICBFeHRyYWN0VnVlPFtcclxuICAgIHR5cGVvZiBDb2xvcmFibGVcclxuICBdPlxyXG4vKiBlc2xpbnQtZW5hYmxlIGluZGVudCAqL1xyXG4+KFxyXG4gIENvbG9yYWJsZVxyXG4pLmV4dGVuZCh7XHJcbiAgbmFtZTogJ1ZTcGFya2xpbmUnLFxyXG5cclxuICBwcm9wczoge1xyXG4gICAgYXV0b0RyYXc6IEJvb2xlYW4sXHJcbiAgICBhdXRvRHJhd0R1cmF0aW9uOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgZGVmYXVsdDogMjAwMFxyXG4gICAgfSxcclxuICAgIGF1dG9EcmF3RWFzaW5nOiB7XHJcbiAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgZGVmYXVsdDogJ2Vhc2UnXHJcbiAgICB9LFxyXG4gICAgY29sb3I6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAncHJpbWFyeSdcclxuICAgIH0sXHJcbiAgICBmaWxsOiB7XHJcbiAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgZ3JhZGllbnQ6IHtcclxuICAgICAgdHlwZTogQXJyYXkgYXMgUHJvcDxzdHJpbmdbXT4sXHJcbiAgICAgIGRlZmF1bHQ6ICgpID0+IChbXSlcclxuICAgIH0sXHJcbiAgICBncmFkaWVudERpcmVjdGlvbjoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcgYXMgUHJvcDwndG9wJyB8ICdib3R0b20nIHwgJ2xlZnQnIHwgJ3JpZ2h0Jz4sXHJcbiAgICAgIHZhbGlkYXRvcjogKHZhbDogc3RyaW5nKSA9PiBbJ3RvcCcsICdib3R0b20nLCAnbGVmdCcsICdyaWdodCddLmluY2x1ZGVzKHZhbCksXHJcbiAgICAgIGRlZmF1bHQ6ICd0b3AnXHJcbiAgICB9LFxyXG4gICAgaGVpZ2h0OiB7XHJcbiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0sXHJcbiAgICAgIGRlZmF1bHQ6IDc1XHJcbiAgICB9LFxyXG4gICAgbGFiZWxzOiB7XHJcbiAgICAgIHR5cGU6IEFycmF5IGFzIFByb3A8U3BhcmtsaW5lSXRlbVtdPixcclxuICAgICAgZGVmYXVsdDogKCkgPT4gKFtdKVxyXG4gICAgfSxcclxuICAgIGxpbmVXaWR0aDoge1xyXG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxyXG4gICAgICBkZWZhdWx0OiA0XHJcbiAgICB9LFxyXG4gICAgcGFkZGluZzoge1xyXG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxyXG4gICAgICBkZWZhdWx0OiA4XHJcbiAgICB9LFxyXG4gICAgc21vb3RoOiB7XHJcbiAgICAgIHR5cGU6IFtCb29sZWFuLCBOdW1iZXIsIFN0cmluZ10sXHJcbiAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgc2hvd0xhYmVsczogQm9vbGVhbixcclxuICAgIHR5cGU6IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAndHJlbmQnLFxyXG4gICAgICB2YWxpZGF0b3I6ICh2YWw6IHN0cmluZykgPT4gWyd0cmVuZCcsICdiYXInXS5pbmNsdWRlcyh2YWwpXHJcbiAgICB9IGFzIFByb3BWYWxpZGF0b3I8J3RyZW5kJyB8ICdiYXInPixcclxuICAgIHZhbHVlOiB7XHJcbiAgICAgIHR5cGU6IEFycmF5IGFzIFByb3A8U3BhcmtsaW5lSXRlbVtdPixcclxuICAgICAgZGVmYXVsdDogKCkgPT4gKFtdKVxyXG4gICAgfSxcclxuICAgIHdpZHRoOiB7XHJcbiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sXHJcbiAgICAgIGRlZmF1bHQ6IDMwMFxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGRhdGE6ICgpID0+ICh7XHJcbiAgICBsYXN0TGVuZ3RoOiAwXHJcbiAgfSksXHJcblxyXG4gIGNvbXB1dGVkOiB7XHJcbiAgICBib3VuZGFyeSAoKTogQm91bmRhcnkge1xyXG4gICAgICBjb25zdCBwYWRkaW5nID0gTnVtYmVyKHRoaXMucGFkZGluZylcclxuICAgICAgY29uc3QgaGVpZ2h0ID0gTnVtYmVyKHRoaXMuaGVpZ2h0KVxyXG4gICAgICBjb25zdCB3aWR0aCA9IE51bWJlcih0aGlzLndpZHRoKVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtaW5YOiBwYWRkaW5nLFxyXG4gICAgICAgIG1pblk6IHBhZGRpbmcsXHJcbiAgICAgICAgbWF4WDogd2lkdGggLSBwYWRkaW5nLFxyXG4gICAgICAgIG1heFk6IGhlaWdodCAtIHBhZGRpbmdcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGhhc0xhYmVscyAoKTogYm9vbGVhbiB7XHJcbiAgICAgIHJldHVybiBCb29sZWFuKFxyXG4gICAgICAgIHRoaXMuc2hvd0xhYmVscyB8fFxyXG4gICAgICAgIHRoaXMubGFiZWxzLmxlbmd0aCA+IDAgfHxcclxuICAgICAgICB0aGlzLiRzY29wZWRTbG90cy5sYWJlbFxyXG4gICAgICApXHJcbiAgICB9LFxyXG4gICAgcGFyc2VkTGFiZWxzICgpOiBTcGFya2xpbmVUZXh0W10ge1xyXG4gICAgICBjb25zdCBsYWJlbHMgPSBbXVxyXG4gICAgICBjb25zdCBwb2ludHMgPSB0aGlzLnBvaW50c1xyXG4gICAgICBjb25zdCBsZW4gPSBwb2ludHMubGVuZ3RoXHJcblxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgbGFiZWxzLmxlbmd0aCA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHBvaW50c1tpXVxyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMubGFiZWxzW2ldXHJcblxyXG4gICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgIHZhbHVlID0gaXRlbSA9PT0gT2JqZWN0KGl0ZW0pXHJcbiAgICAgICAgICAgID8gaXRlbS52YWx1ZVxyXG4gICAgICAgICAgICA6IGl0ZW1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxhYmVscy5wdXNoKHtcclxuICAgICAgICAgIC4uLml0ZW0sXHJcbiAgICAgICAgICB2YWx1ZTogU3RyaW5nKHZhbHVlKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBsYWJlbHNcclxuICAgIH0sXHJcbiAgICBwb2ludHMgKCk6IFBvaW50W10ge1xyXG4gICAgICByZXR1cm4gZ2VuUG9pbnRzKHRoaXMudmFsdWUuc2xpY2UoKSwgdGhpcy5ib3VuZGFyeSlcclxuICAgIH0sXHJcbiAgICB0ZXh0WSAoKTogbnVtYmVyIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYm91bmRhcnkubWF4WSArIDZcclxuICAgIH1cclxuICB9LFxyXG5cclxuICB3YXRjaDoge1xyXG4gICAgdmFsdWU6IHtcclxuICAgICAgaW1tZWRpYXRlOiB0cnVlLFxyXG4gICAgICBoYW5kbGVyICgpIHtcclxuICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXRoaXMuYXV0b0RyYXcgfHwgdGhpcy50eXBlID09PSAnYmFyJykgcmV0dXJuXHJcblxyXG4gICAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuJHJlZnMucGF0aFxyXG4gICAgICAgICAgY29uc3QgbGVuZ3RoID0gcGF0aC5nZXRUb3RhbExlbmd0aCgpXHJcblxyXG4gICAgICAgICAgaWYgKCF0aGlzLmZpbGwpIHtcclxuICAgICAgICAgICAgcGF0aC5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnXHJcbiAgICAgICAgICAgIHBhdGguc3R5bGUuc3Ryb2tlRGFzaGFycmF5ID0gbGVuZ3RoICsgJyAnICsgbGVuZ3RoXHJcbiAgICAgICAgICAgIHBhdGguc3R5bGUuc3Ryb2tlRGFzaG9mZnNldCA9IE1hdGguYWJzKGxlbmd0aCAtICh0aGlzLmxhc3RMZW5ndGggfHwgMCkpLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgcGF0aC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxyXG4gICAgICAgICAgICBwYXRoLnN0eWxlLnRyYW5zaXRpb24gPSBgc3Ryb2tlLWRhc2hvZmZzZXQgJHt0aGlzLmF1dG9EcmF3RHVyYXRpb259bXMgJHt0aGlzLmF1dG9EcmF3RWFzaW5nfWBcclxuICAgICAgICAgICAgcGF0aC5zdHlsZS5zdHJva2VEYXNob2Zmc2V0ID0gJzAnXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwYXRoLnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICdib3R0b20gY2VudGVyJ1xyXG4gICAgICAgICAgICBwYXRoLnN0eWxlLnRyYW5zaXRpb24gPSAnbm9uZSdcclxuICAgICAgICAgICAgcGF0aC5zdHlsZS50cmFuc2Zvcm0gPSBgc2NhbGVZKDApYFxyXG4gICAgICAgICAgICBwYXRoLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXHJcbiAgICAgICAgICAgIHBhdGguc3R5bGUudHJhbnNpdGlvbiA9IGB0cmFuc2Zvcm0gJHt0aGlzLmF1dG9EcmF3RHVyYXRpb259bXMgJHt0aGlzLmF1dG9EcmF3RWFzaW5nfWBcclxuICAgICAgICAgICAgcGF0aC5zdHlsZS50cmFuc2Zvcm0gPSBgc2NhbGVZKDEpYFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5sYXN0TGVuZ3RoID0gbGVuZ3RoXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIG1ldGhvZHM6IHtcclxuICAgIGdlbkdyYWRpZW50ICgpIHtcclxuICAgICAgY29uc3QgZ3JhZGllbnREaXJlY3Rpb24gPSB0aGlzLmdyYWRpZW50RGlyZWN0aW9uXHJcbiAgICAgIGNvbnN0IGdyYWRpZW50ID0gdGhpcy5ncmFkaWVudC5zbGljZSgpXHJcblxyXG4gICAgICAvLyBQdXNoZXMgZW1wdHkgc3RyaW5nIHRvIGZvcmNlXHJcbiAgICAgIC8vIGEgZmFsbGJhY2sgdG8gY3VycmVudENvbG9yXHJcbiAgICAgIGlmICghZ3JhZGllbnQubGVuZ3RoKSBncmFkaWVudC5wdXNoKCcnKVxyXG5cclxuICAgICAgY29uc3QgbGVuID0gTWF0aC5tYXgoZ3JhZGllbnQubGVuZ3RoIC0gMSwgMSlcclxuICAgICAgY29uc3Qgc3RvcHMgPSBncmFkaWVudC5yZXZlcnNlKCkubWFwKChjb2xvciwgaW5kZXgpID0+XHJcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgnc3RvcCcsIHtcclxuICAgICAgICAgIGF0dHJzOiB7XHJcbiAgICAgICAgICAgIG9mZnNldDogaW5kZXggLyBsZW4sXHJcbiAgICAgICAgICAgICdzdG9wLWNvbG9yJzogY29sb3IgfHwgdGhpcy5jb2xvciB8fCAnY3VycmVudENvbG9yJ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIClcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdkZWZzJywgW1xyXG4gICAgICAgIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2xpbmVhckdyYWRpZW50Jywge1xyXG4gICAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgICAgaWQ6IHRoaXMuX3VpZCxcclxuICAgICAgICAgICAgeDE6ICsoZ3JhZGllbnREaXJlY3Rpb24gPT09ICdsZWZ0JyksXHJcbiAgICAgICAgICAgIHkxOiArKGdyYWRpZW50RGlyZWN0aW9uID09PSAndG9wJyksXHJcbiAgICAgICAgICAgIHgyOiArKGdyYWRpZW50RGlyZWN0aW9uID09PSAncmlnaHQnKSxcclxuICAgICAgICAgICAgeTI6ICsoZ3JhZGllbnREaXJlY3Rpb24gPT09ICdib3R0b20nKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIHN0b3BzKVxyXG4gICAgICBdKVxyXG4gICAgfSxcclxuICAgIGdlbkcgKGNoaWxkcmVuOiBWTm9kZVtdKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdnJywge1xyXG4gICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICBmb250U2l6ZTogJzgnLFxyXG4gICAgICAgICAgdGV4dEFuY2hvcjogJ21pZGRsZScsXHJcbiAgICAgICAgICBkb21pbmFudEJhc2VsaW5lOiAnbWF0aGVtYXRpY2FsJyxcclxuICAgICAgICAgIGZpbGw6IHRoaXMuY29sb3IgfHwgJ2N1cnJlbnRDb2xvcidcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGNoaWxkcmVuKVxyXG4gICAgfSxcclxuICAgIGdlbkxhYmVscyAoKSB7XHJcbiAgICAgIGlmICghdGhpcy5oYXNMYWJlbHMpIHJldHVybiB1bmRlZmluZWRcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLmdlbkcodGhpcy5wYXJzZWRMYWJlbHMubWFwKHRoaXMuZ2VuVGV4dCkpXHJcbiAgICB9LFxyXG4gICAgZ2VuUGF0aCAoKSB7XHJcbiAgICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMuc21vb3RoID09PSB0cnVlID8gOCA6IE51bWJlcih0aGlzLnNtb290aClcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdwYXRoJywge1xyXG4gICAgICAgIGF0dHJzOiB7XHJcbiAgICAgICAgICBpZDogdGhpcy5fdWlkLFxyXG4gICAgICAgICAgZDogZ2VuUGF0aCh0aGlzLnBvaW50cy5zbGljZSgpLCByYWRpdXMsIHRoaXMuZmlsbCwgTnVtYmVyKHRoaXMuaGVpZ2h0KSksXHJcbiAgICAgICAgICBmaWxsOiB0aGlzLmZpbGwgPyBgdXJsKCMke3RoaXMuX3VpZH0pYCA6ICdub25lJyxcclxuICAgICAgICAgIHN0cm9rZTogdGhpcy5maWxsID8gJ25vbmUnIDogYHVybCgjJHt0aGlzLl91aWR9KWBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlZjogJ3BhdGgnXHJcbiAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgZ2VuVGV4dCAoaXRlbTogU3BhcmtsaW5lVGV4dCwgaW5kZXg6IG51bWJlcikge1xyXG4gICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuJHNjb3BlZFNsb3RzLmxhYmVsXHJcbiAgICAgICAgPyB0aGlzLiRzY29wZWRTbG90cy5sYWJlbCh7IGluZGV4LCB2YWx1ZTogaXRlbS52YWx1ZSB9KVxyXG4gICAgICAgIDogaXRlbS52YWx1ZVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RleHQnLCB7XHJcbiAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgIHg6IGl0ZW0ueCxcclxuICAgICAgICAgIHk6IHRoaXMudGV4dFlcclxuICAgICAgICB9XHJcbiAgICAgIH0sIFtjaGlsZHJlbl0pXHJcbiAgICB9LFxyXG4gICAgZ2VuQmFyICgpIHtcclxuICAgICAgaWYgKCF0aGlzLnZhbHVlIHx8IHRoaXMudmFsdWUubGVuZ3RoIDwgMikgcmV0dXJuIHVuZGVmaW5lZCBhcyBuZXZlclxyXG4gICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIHBhZGRpbmcsIGxpbmVXaWR0aCB9ID0gdGhpc1xyXG4gICAgICBjb25zdCB2aWV3V2lkdGggPSB3aWR0aCB8fCB0aGlzLnZhbHVlLmxlbmd0aCAqIE51bWJlcihwYWRkaW5nKSAqIDJcclxuICAgICAgY29uc3Qgdmlld0hlaWdodCA9IGhlaWdodCB8fCA3NVxyXG4gICAgICBjb25zdCBib3VuZGFyeTogQm91bmRhcnkgPSB7XHJcbiAgICAgICAgbWluWDogTnVtYmVyKHBhZGRpbmcpLFxyXG4gICAgICAgIG1pblk6IE51bWJlcihwYWRkaW5nKSxcclxuICAgICAgICBtYXhYOiBOdW1iZXIodmlld1dpZHRoKSAtIE51bWJlcihwYWRkaW5nKSxcclxuICAgICAgICBtYXhZOiBOdW1iZXIodmlld0hlaWdodCkgLSBOdW1iZXIocGFkZGluZylcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBwcm9wcyA9IHtcclxuICAgICAgICAuLi50aGlzLiRwcm9wc1xyXG4gICAgICB9XHJcblxyXG4gICAgICBwcm9wcy5wb2ludHMgPSBnZW5Qb2ludHModGhpcy52YWx1ZSwgYm91bmRhcnkpXHJcblxyXG4gICAgICBjb25zdCB0b3RhbFdpZHRoID0gYm91bmRhcnkubWF4WCAvIChwcm9wcy5wb2ludHMubGVuZ3RoIC0gMSlcclxuXHJcbiAgICAgIHByb3BzLmJvdW5kYXJ5ID0gYm91bmRhcnlcclxuICAgICAgcHJvcHMubGluZVdpZHRoID0gbGluZVdpZHRoIHx8ICh0b3RhbFdpZHRoIC0gTnVtYmVyKHBhZGRpbmcgfHwgNSkpXHJcbiAgICAgIHByb3BzLm9mZnNldFggPSAodG90YWxXaWR0aCAtIHByb3BzLmxpbmVXaWR0aCkgLyAyXHJcblxyXG4gICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnc3ZnJywge1xyXG4gICAgICAgIGF0dHJzOiB7XHJcbiAgICAgICAgICB3aWR0aDogJzEwMCUnLFxyXG4gICAgICAgICAgaGVpZ2h0OiAnMjUlJyxcclxuICAgICAgICAgIHZpZXdCb3g6IGAwIDAgJHt2aWV3V2lkdGh9ICR7dmlld0hlaWdodH1gXHJcbiAgICAgICAgfVxyXG4gICAgICB9LCBbXHJcbiAgICAgICAgdGhpcy5nZW5HcmFkaWVudCgpLFxyXG4gICAgICAgIHRoaXMuZ2VuQ2xpcFBhdGgocHJvcHMub2Zmc2V0WCwgJ3NwYXJrbGluZS1iYXItJyArIHRoaXMuX3VpZCksXHJcbiAgICAgICAgdGhpcy5zaG93TGFiZWxzID8gdGhpcy5nZW5CYXJMYWJlbHMocHJvcHMgYXMgQmFyVGV4dCkgOiB1bmRlZmluZWQgYXMgbmV2ZXIsXHJcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgnZycsIHtcclxuICAgICAgICAgIGF0dHJzOiB7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybTogYHNjYWxlKDEsLTEpIHRyYW5zbGF0ZSgwLC0ke2JvdW5kYXJ5Lm1heFl9KWAsXHJcbiAgICAgICAgICAgICdjbGlwLXBhdGgnOiBgdXJsKCNzcGFya2xpbmUtYmFyLSR7dGhpcy5fdWlkfS1jbGlwKWAsXHJcbiAgICAgICAgICAgIGZpbGw6IGB1cmwoIyR7dGhpcy5fdWlkfSlgXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgW1xyXG4gICAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgncmVjdCcsIHtcclxuICAgICAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgICAgICB4OiAwLFxyXG4gICAgICAgICAgICAgIHk6IDAsXHJcbiAgICAgICAgICAgICAgd2lkdGg6IHZpZXdXaWR0aCxcclxuICAgICAgICAgICAgICBoZWlnaHQ6IHZpZXdIZWlnaHRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKVxyXG4gICAgICBdKVxyXG4gICAgfSxcclxuICAgIGdlbkNsaXBQYXRoIChvZmZzZXRYOiBudW1iZXIsIGlkOiBzdHJpbmcpIHtcclxuICAgICAgY29uc3QgeyBtYXhZIH0gPSB0aGlzLmJvdW5kYXJ5XHJcbiAgICAgIGNvbnN0IHJvdW5kaW5nID0gdHlwZW9mIHRoaXMuc21vb3RoID09PSAnbnVtYmVyJ1xyXG4gICAgICAgID8gdGhpcy5zbW9vdGhcclxuICAgICAgICA6IHRoaXMuc21vb3RoID8gMiA6IDBcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdjbGlwUGF0aCcsIHtcclxuICAgICAgICBhdHRyczoge1xyXG4gICAgICAgICAgaWQ6IGAke2lkfS1jbGlwYFxyXG4gICAgICAgIH1cclxuICAgICAgfSwgdGhpcy5wb2ludHMubWFwKGl0ZW0gPT5cclxuICAgICAgICB0aGlzLiRjcmVhdGVFbGVtZW50KCdyZWN0Jywge1xyXG4gICAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgICAgeDogaXRlbS54IC0gb2Zmc2V0WCxcclxuICAgICAgICAgICAgeTogMCxcclxuICAgICAgICAgICAgd2lkdGg6IHRoaXMubGluZVdpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KG1heFkgLSBpdGVtLnksIDApLFxyXG4gICAgICAgICAgICByeDogcm91bmRpbmcsXHJcbiAgICAgICAgICAgIHJ5OiByb3VuZGluZ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIFtcclxuICAgICAgICAgIHRoaXMuYXV0b0RyYXcgPyB0aGlzLiRjcmVhdGVFbGVtZW50KCdhbmltYXRlJywge1xyXG4gICAgICAgICAgICBhdHRyczoge1xyXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdoZWlnaHQnLFxyXG4gICAgICAgICAgICAgIGZyb206IDAsXHJcbiAgICAgICAgICAgICAgdG86IG1heFkgLSBpdGVtLnksXHJcbiAgICAgICAgICAgICAgZHVyOiBgJHt0aGlzLmF1dG9EcmF3RHVyYXRpb259bXNgLFxyXG4gICAgICAgICAgICAgIGZpbGw6ICdmcmVlemUnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pIDogdW5kZWZpbmVkIGFzIG5ldmVyXHJcbiAgICAgICAgXSlcclxuICAgICAgKSlcclxuICAgIH0sXHJcbiAgICBnZW5CYXJMYWJlbHMgKHByb3BzOiBCYXJUZXh0KTogVk5vZGUge1xyXG4gICAgICBjb25zdCBvZmZzZXRYID0gKHByb3BzLm9mZnNldFggfHwgMCkgLyAyXHJcblxyXG4gICAgICBjb25zdCBjaGlsZHJlbiA9IHByb3BzLnBvaW50cy5tYXAoaXRlbSA9PiAoXHJcbiAgICAgICAgdGhpcy4kY3JlYXRlRWxlbWVudCgndGV4dCcsIHtcclxuICAgICAgICAgIGF0dHJzOiB7XHJcbiAgICAgICAgICAgIHg6IGl0ZW0ueCAtIG9mZnNldFggKiAtMC40NSAtIDEwLFxyXG4gICAgICAgICAgICB5OiBwcm9wcy5ib3VuZGFyeS5tYXhZICsgMTBcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCBpdGVtLnZhbHVlLnRvU3RyaW5nKCkpXHJcbiAgICAgICkpXHJcblxyXG4gICAgICByZXR1cm4gdGhpcy5nZW5HKGNoaWxkcmVuKVxyXG4gICAgfSxcclxuICAgIGdlblRyZW5kICgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3N2ZycsIHRoaXMuc2V0VGV4dENvbG9yKHRoaXMuY29sb3IsIHtcclxuICAgICAgICBhdHRyczoge1xyXG4gICAgICAgICAgJ3N0cm9rZS13aWR0aCc6IHRoaXMubGluZVdpZHRoIHx8IDEsXHJcbiAgICAgICAgICB3aWR0aDogJzEwMCUnLFxyXG4gICAgICAgICAgaGVpZ2h0OiAnMjUlJyxcclxuICAgICAgICAgIHZpZXdCb3g6IGAwIDAgJHt0aGlzLndpZHRofSAke3RoaXMuaGVpZ2h0fWBcclxuICAgICAgICB9XHJcbiAgICAgIH0pLCBbXHJcbiAgICAgICAgdGhpcy5nZW5HcmFkaWVudCgpLFxyXG4gICAgICAgIHRoaXMuZ2VuTGFiZWxzKCksXHJcbiAgICAgICAgdGhpcy5nZW5QYXRoKClcclxuICAgICAgXSlcclxuICAgIH1cclxuICB9LFxyXG5cclxuICByZW5kZXIgKGgpOiBWTm9kZSB7XHJcbiAgICBpZiAodGhpcy52YWx1ZS5sZW5ndGggPCAyKSByZXR1cm4gdW5kZWZpbmVkIGFzIG5ldmVyXHJcblxyXG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ3RyZW5kJ1xyXG4gICAgICA/IHRoaXMuZ2VuVHJlbmQoKVxyXG4gICAgICA6IHRoaXMuZ2VuQmFyKClcclxuICB9XHJcbn0pXHJcbiJdfQ==