// Components
import VTimePickerTitle from './VTimePickerTitle';
import VTimePickerClock from './VTimePickerClock';
// Mixins
import Picker from '../../mixins/picker';
// Utils
import { createRange } from '../../util/helpers';
import pad from '../VDatePicker/util/pad';
import mixins from '../../util/mixins';
const rangeHours24 = createRange(24);
const rangeHours12am = createRange(12);
const rangeHours12pm = rangeHours12am.map(v => v + 12);
const range60 = createRange(60);
const selectingTimes = { hour: 1, minute: 2, second: 3 };
const selectingNames = { 1: 'hour', 2: 'minute', 3: 'second' };
export { selectingTimes };
export default mixins(Picker
/* @vue/component */
).extend({
    name: 'v-time-picker',
    props: {
        allowedHours: Function,
        allowedMinutes: Function,
        allowedSeconds: Function,
        disabled: Boolean,
        format: {
            type: String,
            default: 'ampm',
            validator(val) {
                return ['ampm', '24hr'].includes(val);
            }
        },
        min: String,
        max: String,
        readonly: Boolean,
        scrollable: Boolean,
        useSeconds: Boolean,
        value: null
    },
    data() {
        return {
            inputHour: null,
            inputMinute: null,
            inputSecond: null,
            lazyInputHour: null,
            lazyInputMinute: null,
            lazyInputSecond: null,
            period: 'am',
            selecting: selectingTimes.hour
        };
    },
    computed: {
        selectingHour: {
            get() {
                return this.selecting === selectingTimes.hour;
            },
            set(v) {
                this.selecting = selectingTimes.hour;
            }
        },
        selectingMinute: {
            get() {
                return this.selecting === selectingTimes.minute;
            },
            set(v) {
                this.selecting = selectingTimes.minute;
            }
        },
        selectingSecond: {
            get() {
                return this.selecting === selectingTimes.second;
            },
            set(v) {
                this.selecting = selectingTimes.second;
            }
        },
        isAllowedHourCb() {
            if (!this.min && !this.max)
                return this.allowedHours;
            const minHour = this.min ? Number(this.min.split(':')[0]) : 0;
            const maxHour = this.max ? Number(this.max.split(':')[0]) : 23;
            return (val) => {
                return val >= minHour * 1 &&
                    val <= maxHour * 1 &&
                    (!this.allowedHours || this.allowedHours(val));
            };
        },
        isAllowedMinuteCb() {
            const isHourAllowed = !this.allowedHours || this.allowedHours(this.inputHour);
            if (!this.min && !this.max) {
                return isHourAllowed ? this.allowedMinutes : () => false;
            }
            const [minHour, minMinute] = this.min ? this.min.split(':').map(Number) : [0, 0];
            const [maxHour, maxMinute] = this.max ? this.max.split(':').map(Number) : [23, 59];
            const minTime = minHour * 60 + minMinute * 1;
            const maxTime = maxHour * 60 + maxMinute * 1;
            return (val) => {
                const time = 60 * this.inputHour + val;
                return time >= minTime &&
                    time <= maxTime &&
                    isHourAllowed &&
                    (!this.allowedMinutes || this.allowedMinutes(val));
            };
        },
        isAllowedSecondCb() {
            const isHourAllowed = !this.allowedHours || this.allowedHours(this.inputHour);
            const isMinuteAllowed = !this.allowedMinutes || this.allowedMinutes(this.inputMinute);
            if (!this.min && !this.max) {
                return isHourAllowed && isMinuteAllowed ? this.allowedSeconds : () => false;
            }
            const [minHour, minMinute, minSecond] = this.min ? this.min.split(':').map(Number) : [0, 0, 0];
            const [maxHour, maxMinute, maxSecond] = this.max ? this.max.split(':').map(Number) : [23, 59, 59];
            const minTime = minHour * 3600 + minMinute * 60 + (minSecond || 0) * 1;
            const maxTime = maxHour * 3600 + maxMinute * 60 + (maxSecond || 0) * 1;
            return (val) => {
                const time = 3600 * this.inputHour + 60 * this.inputMinute + val;
                return time >= minTime &&
                    time <= maxTime &&
                    isHourAllowed && isMinuteAllowed &&
                    (!this.allowedSeconds || this.allowedSeconds(val));
            };
        },
        isAmPm() {
            return this.format === 'ampm';
        }
    },
    watch: {
        value: 'setInputData'
    },
    mounted() {
        this.setInputData(this.value);
    },
    methods: {
        genValue() {
            if (this.inputHour != null && this.inputMinute != null && (!this.useSeconds || this.inputSecond != null)) {
                return `${pad(this.inputHour)}:${pad(this.inputMinute)}` + (this.useSeconds ? `:${pad(this.inputSecond)}` : '');
            }
            return null;
        },
        emitValue() {
            const value = this.genValue();
            if (value !== null)
                this.$emit('input', value);
        },
        setPeriod(period) {
            this.period = period;
            if (this.inputHour != null) {
                const newHour = this.inputHour + (period === 'am' ? -12 : 12);
                this.inputHour = this.firstAllowed('hour', newHour);
                this.emitValue();
            }
        },
        setInputData(value) {
            if (value == null || value === '') {
                this.inputHour = null;
                this.inputMinute = null;
                this.inputSecond = null;
            }
            else if (value instanceof Date) {
                this.inputHour = value.getHours();
                this.inputMinute = value.getMinutes();
                this.inputSecond = value.getSeconds();
            }
            else {
                const [, hour, minute, , second, period] = value.trim().toLowerCase().match(/^(\d+):(\d+)(:(\d+))?([ap]m)?$/) || new Array(6);
                this.inputHour = period ? this.convert12to24(parseInt(hour, 10), period) : parseInt(hour, 10);
                this.inputMinute = parseInt(minute, 10);
                this.inputSecond = parseInt(second || 0, 10);
            }
            this.period = (this.inputHour == null || this.inputHour < 12) ? 'am' : 'pm';
        },
        convert24to12(hour) {
            return hour ? ((hour - 1) % 12 + 1) : 12;
        },
        convert12to24(hour, period) {
            return hour % 12 + (period === 'pm' ? 12 : 0);
        },
        onInput(value) {
            if (this.selecting === selectingTimes.hour) {
                this.inputHour = this.isAmPm ? this.convert12to24(value, this.period) : value;
            }
            else if (this.selecting === selectingTimes.minute) {
                this.inputMinute = value;
            }
            else {
                this.inputSecond = value;
            }
            this.emitValue();
        },
        onChange(value) {
            this.$emit(`click:${selectingNames[this.selecting]}`, value);
            const emitChange = this.selecting === (this.useSeconds ? selectingTimes.second : selectingTimes.minute);
            if (this.selecting === selectingTimes.hour) {
                this.selecting = selectingTimes.minute;
            }
            else if (this.useSeconds && this.selecting === selectingTimes.minute) {
                this.selecting = selectingTimes.second;
            }
            if (this.inputHour === this.lazyInputHour &&
                this.inputMinute === this.lazyInputMinute &&
                (!this.useSeconds || this.inputSecond === this.lazyInputSecond))
                return;
            const time = this.genValue();
            if (time === null)
                return;
            this.lazyInputHour = this.inputHour;
            this.lazyInputMinute = this.inputMinute;
            this.useSeconds && (this.lazyInputSecond = this.inputSecond);
            emitChange && this.$emit('change', time);
        },
        firstAllowed(type, value) {
            const allowedFn = type === 'hour' ? this.isAllowedHourCb : (type === 'minute' ? this.isAllowedMinuteCb : this.isAllowedSecondCb);
            if (!allowedFn)
                return value;
            // TODO: clean up
            const range = type === 'minute'
                ? range60
                : (type === 'second'
                    ? range60
                    : (this.isAmPm
                        ? (value < 12
                            ? rangeHours12am
                            : rangeHours12pm)
                        : rangeHours24));
            const first = range.find(v => allowedFn((v + value) % range.length + range[0]));
            return ((first || 0) + value) % range.length + range[0];
        },
        genClock() {
            return this.$createElement(VTimePickerClock, {
                props: {
                    allowedValues: this.selecting === selectingTimes.hour
                        ? this.isAllowedHourCb
                        : (this.selecting === selectingTimes.minute
                            ? this.isAllowedMinuteCb
                            : this.isAllowedSecondCb),
                    color: this.color,
                    dark: this.dark,
                    disabled: this.disabled,
                    double: this.selecting === selectingTimes.hour && !this.isAmPm,
                    format: this.selecting === selectingTimes.hour
                        ? (this.isAmPm ? this.convert24to12 : (val) => val)
                        : (val) => pad(val, 2),
                    light: this.light,
                    max: this.selecting === selectingTimes.hour ? (this.isAmPm && this.period === 'am' ? 11 : 23) : 59,
                    min: this.selecting === selectingTimes.hour && this.isAmPm && this.period === 'pm' ? 12 : 0,
                    readonly: this.readonly,
                    scrollable: this.scrollable,
                    size: Number(this.width) - ((!this.fullWidth && this.landscape) ? 80 : 20),
                    step: this.selecting === selectingTimes.hour ? 1 : 5,
                    value: this.selecting === selectingTimes.hour
                        ? this.inputHour
                        : (this.selecting === selectingTimes.minute
                            ? this.inputMinute
                            : this.inputSecond)
                },
                on: {
                    input: this.onInput,
                    change: this.onChange
                },
                ref: 'clock'
            });
        },
        genPickerBody() {
            return this.$createElement('div', {
                staticClass: 'v-time-picker-clock__container',
                key: this.selecting
            }, [this.genClock()]);
        },
        genPickerTitle() {
            return this.$createElement(VTimePickerTitle, {
                props: {
                    ampm: this.isAmPm,
                    disabled: this.disabled,
                    hour: this.inputHour,
                    minute: this.inputMinute,
                    second: this.inputSecond,
                    period: this.period,
                    readonly: this.readonly,
                    useSeconds: this.useSeconds,
                    selecting: this.selecting
                },
                on: {
                    'update:selecting': (value) => (this.selecting = value),
                    'update:period': this.setPeriod
                },
                ref: 'title',
                slot: 'title'
            });
        }
    },
    render() {
        return this.genPicker('v-picker--time');
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRpbWVQaWNrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WVGltZVBpY2tlci9WVGltZVBpY2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxhQUFhO0FBQ2IsT0FBTyxnQkFBZ0IsTUFBTSxvQkFBb0IsQ0FBQTtBQUNqRCxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFBO0FBRWpELFNBQVM7QUFDVCxPQUFPLE1BQU0sTUFBTSxxQkFBcUIsQ0FBQTtBQUV4QyxRQUFRO0FBQ1IsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQ2hELE9BQU8sR0FBRyxNQUFNLHlCQUF5QixDQUFBO0FBQ3pDLE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFBO0FBTXRDLE1BQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNwQyxNQUFNLGNBQWMsR0FBRyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDdEMsTUFBTSxjQUFjLEdBQUcsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQTtBQUN0RCxNQUFNLE9BQU8sR0FBRyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDL0IsTUFBTSxjQUFjLEdBSWhCLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUNyQyxNQUFNLGNBQWMsR0FBRyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUE7QUFDOUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxDQUFBO0FBSXpCLGVBQWUsTUFBTSxDQUNuQixNQUFNO0FBQ1Isb0JBQW9CO0NBQ25CLENBQUMsTUFBTSxDQUFDO0lBQ1AsSUFBSSxFQUFFLGVBQWU7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R0FBRyxLQUFLLENBQUM7b0JBQ2xFLGVBQWUsRUFBRSxJQUFJLENBQUMsU0FBUztpQkFDaEM7Z0JBQ0QsR0FBRyxFQUFFLE9BQU87Z0JBQ1osSUFBSSxFQUFFLE9BQU87YUFDZCxDQUFDLENBQUE7UUFDSixDQUFDO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLENBQUE7SUFDekMsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvbXBvbmVudHNcclxuaW1wb3J0IFZUaW1lUGlja2VyVGl0bGUgZnJvbSAnLi9WVGltZVBpY2tlclRpdGxlJ1xyXG5pbXBvcnQgVlRpbWVQaWNrZXJDbG9jayBmcm9tICcuL1ZUaW1lUGlja2VyQ2xvY2snXHJcblxyXG4vLyBNaXhpbnNcclxuaW1wb3J0IFBpY2tlciBmcm9tICcuLi8uLi9taXhpbnMvcGlja2VyJ1xyXG5cclxuLy8gVXRpbHNcclxuaW1wb3J0IHsgY3JlYXRlUmFuZ2UgfSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnXHJcbmltcG9ydCBwYWQgZnJvbSAnLi4vVkRhdGVQaWNrZXIvdXRpbC9wYWQnXHJcbmltcG9ydCBtaXhpbnMgZnJvbSAnLi4vLi4vdXRpbC9taXhpbnMnXHJcblxyXG4vLyBUeXBlc1xyXG5pbXBvcnQgeyBWTm9kZSB9IGZyb20gJ3Z1ZSdcclxuaW1wb3J0IHsgUHJvcFZhbGlkYXRvciB9IGZyb20gJ3Z1ZS90eXBlcy9vcHRpb25zJ1xyXG5cclxuY29uc3QgcmFuZ2VIb3VyczI0ID0gY3JlYXRlUmFuZ2UoMjQpXHJcbmNvbnN0IHJhbmdlSG91cnMxMmFtID0gY3JlYXRlUmFuZ2UoMTIpXHJcbmNvbnN0IHJhbmdlSG91cnMxMnBtID0gcmFuZ2VIb3VyczEyYW0ubWFwKHYgPT4gdiArIDEyKVxyXG5jb25zdCByYW5nZTYwID0gY3JlYXRlUmFuZ2UoNjApXHJcbmNvbnN0IHNlbGVjdGluZ1RpbWVzOiB7XHJcbiAgaG91cjogMVxyXG4gIG1pbnV0ZTogMlxyXG4gIHNlY29uZDogM1xyXG59ID0geyBob3VyOiAxLCBtaW51dGU6IDIsIHNlY29uZDogMyB9XHJcbmNvbnN0IHNlbGVjdGluZ05hbWVzID0geyAxOiAnaG91cicsIDI6ICdtaW51dGUnLCAzOiAnc2Vjb25kJyB9XHJcbmV4cG9ydCB7IHNlbGVjdGluZ1RpbWVzIH1cclxuXHJcbnR5cGUgUGVyaW9kID0gJ2FtJyB8ICdwbSdcclxuXHJcbmV4cG9ydCBkZWZhdWx0IG1peGlucyhcclxuICBQaWNrZXJcclxuLyogQHZ1ZS9jb21wb25lbnQgKi9cclxuKS5leHRlbmQoe1xyXG4gIG5hbWU6ICd2LXRpbWUtcGlja2VyJyxcclxuXHJcbiAgcHJvcHM6IHtcclxuICAgIGFsbG93ZWRIb3VyczogRnVuY3Rpb24sXHJcbiAgICBhbGxvd2VkTWludXRlczogRnVuY3Rpb24sXHJcbiAgICBhbGxvd2VkU2Vjb25kczogRnVuY3Rpb24sXHJcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcclxuICAgIGZvcm1hdDoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGRlZmF1bHQ6ICdhbXBtJyxcclxuICAgICAgdmFsaWRhdG9yICh2YWwpIHtcclxuICAgICAgICByZXR1cm4gWydhbXBtJywgJzI0aHInXS5pbmNsdWRlcyh2YWwpXHJcbiAgICAgIH1cclxuICAgIH0gYXMgUHJvcFZhbGlkYXRvcjwnYW1wbScgfCAnMjRocic+LFxyXG4gICAgbWluOiBTdHJpbmcsXHJcbiAgICBtYXg6IFN0cmluZyxcclxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxyXG4gICAgc2Nyb2xsYWJsZTogQm9vbGVhbixcclxuICAgIHVzZVNlY29uZHM6IEJvb2xlYW4sXHJcbiAgICB2YWx1ZTogbnVsbCBhcyBhbnkgYXMgUHJvcFZhbGlkYXRvcjxhbnk+XHJcbiAgfSxcclxuXHJcbiAgZGF0YSAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpbnB1dEhvdXI6IG51bGwgYXMgbnVtYmVyIHwgbnVsbCxcclxuICAgICAgaW5wdXRNaW51dGU6IG51bGwgYXMgbnVtYmVyIHwgbnVsbCxcclxuICAgICAgaW5wdXRTZWNvbmQ6IG51bGwgYXMgbnVtYmVyIHwgbnVsbCxcclxuICAgICAgbGF6eUlucHV0SG91cjogbnVsbCBhcyBudW1iZXIgfCBudWxsLFxyXG4gICAgICBsYXp5SW5wdXRNaW51dGU6IG51bGwgYXMgbnVtYmVyIHwgbnVsbCxcclxuICAgICAgbGF6eUlucHV0U2Vjb25kOiBudWxsIGFzIG51bWJlciB8IG51bGwsXHJcbiAgICAgIHBlcmlvZDogJ2FtJyBhcyBQZXJpb2QsXHJcbiAgICAgIHNlbGVjdGluZzogc2VsZWN0aW5nVGltZXMuaG91ciBhcyAxIHwgMiB8IDNcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBjb21wdXRlZDoge1xyXG4gICAgc2VsZWN0aW5nSG91cjoge1xyXG4gICAgICBnZXQgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMuaG91clxyXG4gICAgICB9LFxyXG4gICAgICBzZXQgKHY6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGluZyA9IHNlbGVjdGluZ1RpbWVzLmhvdXJcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNlbGVjdGluZ01pbnV0ZToge1xyXG4gICAgICBnZXQgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMubWludXRlXHJcbiAgICAgIH0sXHJcbiAgICAgIHNldCAodjogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW5nID0gc2VsZWN0aW5nVGltZXMubWludXRlXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZWxlY3RpbmdTZWNvbmQ6IHtcclxuICAgICAgZ2V0ICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLnNlY29uZFxyXG4gICAgICB9LFxyXG4gICAgICBzZXQgKHY6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGluZyA9IHNlbGVjdGluZ1RpbWVzLnNlY29uZFxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgaXNBbGxvd2VkSG91ckNiICgpIHtcclxuICAgICAgaWYgKCF0aGlzLm1pbiAmJiAhdGhpcy5tYXgpIHJldHVybiB0aGlzLmFsbG93ZWRIb3Vyc1xyXG5cclxuICAgICAgY29uc3QgbWluSG91ciA9IHRoaXMubWluID8gTnVtYmVyKHRoaXMubWluLnNwbGl0KCc6JylbMF0pIDogMFxyXG4gICAgICBjb25zdCBtYXhIb3VyID0gdGhpcy5tYXggPyBOdW1iZXIodGhpcy5tYXguc3BsaXQoJzonKVswXSkgOiAyM1xyXG5cclxuICAgICAgcmV0dXJuICh2YWw6IG51bWJlcikgPT4ge1xyXG4gICAgICAgIHJldHVybiB2YWwgPj0gbWluSG91ciAqIDEgJiZcclxuICAgICAgICAgIHZhbCA8PSBtYXhIb3VyICogMSAmJlxyXG4gICAgICAgICAgKCF0aGlzLmFsbG93ZWRIb3VycyB8fCB0aGlzLmFsbG93ZWRIb3Vycyh2YWwpKVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgaXNBbGxvd2VkTWludXRlQ2IgKCkge1xyXG4gICAgICBjb25zdCBpc0hvdXJBbGxvd2VkID0gIXRoaXMuYWxsb3dlZEhvdXJzIHx8IHRoaXMuYWxsb3dlZEhvdXJzKHRoaXMuaW5wdXRIb3VyKVxyXG4gICAgICBpZiAoIXRoaXMubWluICYmICF0aGlzLm1heCkge1xyXG4gICAgICAgIHJldHVybiBpc0hvdXJBbGxvd2VkID8gdGhpcy5hbGxvd2VkTWludXRlcyA6ICgpID0+IGZhbHNlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IFttaW5Ib3VyLCBtaW5NaW51dGVdID0gdGhpcy5taW4gPyB0aGlzLm1pbi5zcGxpdCgnOicpLm1hcChOdW1iZXIpIDogWzAsIDBdXHJcbiAgICAgIGNvbnN0IFttYXhIb3VyLCBtYXhNaW51dGVdID0gdGhpcy5tYXggPyB0aGlzLm1heC5zcGxpdCgnOicpLm1hcChOdW1iZXIpIDogWzIzLCA1OV1cclxuICAgICAgY29uc3QgbWluVGltZSA9IG1pbkhvdXIgKiA2MCArIG1pbk1pbnV0ZSAqIDFcclxuICAgICAgY29uc3QgbWF4VGltZSA9IG1heEhvdXIgKiA2MCArIG1heE1pbnV0ZSAqIDFcclxuXHJcbiAgICAgIHJldHVybiAodmFsOiBudW1iZXIpID0+IHtcclxuICAgICAgICBjb25zdCB0aW1lID0gNjAgKiB0aGlzLmlucHV0SG91ciEgKyB2YWxcclxuICAgICAgICByZXR1cm4gdGltZSA+PSBtaW5UaW1lICYmXHJcbiAgICAgICAgICB0aW1lIDw9IG1heFRpbWUgJiZcclxuICAgICAgICAgIGlzSG91ckFsbG93ZWQgJiZcclxuICAgICAgICAgICghdGhpcy5hbGxvd2VkTWludXRlcyB8fCB0aGlzLmFsbG93ZWRNaW51dGVzKHZhbCkpXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBpc0FsbG93ZWRTZWNvbmRDYiAoKSB7XHJcbiAgICAgIGNvbnN0IGlzSG91ckFsbG93ZWQgPSAhdGhpcy5hbGxvd2VkSG91cnMgfHwgdGhpcy5hbGxvd2VkSG91cnModGhpcy5pbnB1dEhvdXIpXHJcbiAgICAgIGNvbnN0IGlzTWludXRlQWxsb3dlZCA9ICF0aGlzLmFsbG93ZWRNaW51dGVzIHx8IHRoaXMuYWxsb3dlZE1pbnV0ZXModGhpcy5pbnB1dE1pbnV0ZSlcclxuICAgICAgaWYgKCF0aGlzLm1pbiAmJiAhdGhpcy5tYXgpIHtcclxuICAgICAgICByZXR1cm4gaXNIb3VyQWxsb3dlZCAmJiBpc01pbnV0ZUFsbG93ZWQgPyB0aGlzLmFsbG93ZWRTZWNvbmRzIDogKCkgPT4gZmFsc2VcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgW21pbkhvdXIsIG1pbk1pbnV0ZSwgbWluU2Vjb25kXSA9IHRoaXMubWluID8gdGhpcy5taW4uc3BsaXQoJzonKS5tYXAoTnVtYmVyKSA6IFswLCAwLCAwXVxyXG4gICAgICBjb25zdCBbbWF4SG91ciwgbWF4TWludXRlLCBtYXhTZWNvbmRdID0gdGhpcy5tYXggPyB0aGlzLm1heC5zcGxpdCgnOicpLm1hcChOdW1iZXIpIDogWzIzLCA1OSwgNTldXHJcbiAgICAgIGNvbnN0IG1pblRpbWUgPSBtaW5Ib3VyICogMzYwMCArIG1pbk1pbnV0ZSAqIDYwICsgKG1pblNlY29uZCB8fCAwKSAqIDFcclxuICAgICAgY29uc3QgbWF4VGltZSA9IG1heEhvdXIgKiAzNjAwICsgbWF4TWludXRlICogNjAgKyAobWF4U2Vjb25kIHx8IDApICogMVxyXG5cclxuICAgICAgcmV0dXJuICh2YWw6IG51bWJlcikgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRpbWUgPSAzNjAwICogdGhpcy5pbnB1dEhvdXIhICsgNjAgKiB0aGlzLmlucHV0TWludXRlISArIHZhbFxyXG4gICAgICAgIHJldHVybiB0aW1lID49IG1pblRpbWUgJiZcclxuICAgICAgICAgIHRpbWUgPD0gbWF4VGltZSAmJlxyXG4gICAgICAgICAgaXNIb3VyQWxsb3dlZCAmJiBpc01pbnV0ZUFsbG93ZWQgJiZcclxuICAgICAgICAgICghdGhpcy5hbGxvd2VkU2Vjb25kcyB8fCB0aGlzLmFsbG93ZWRTZWNvbmRzKHZhbCkpXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBpc0FtUG0gKCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXQgPT09ICdhbXBtJ1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIHdhdGNoOiB7XHJcbiAgICB2YWx1ZTogJ3NldElucHV0RGF0YSdcclxuICB9LFxyXG5cclxuICBtb3VudGVkICgpIHtcclxuICAgIHRoaXMuc2V0SW5wdXREYXRhKHRoaXMudmFsdWUpXHJcbiAgfSxcclxuXHJcbiAgbWV0aG9kczoge1xyXG4gICAgZ2VuVmFsdWUgKCkge1xyXG4gICAgICBpZiAodGhpcy5pbnB1dEhvdXIgIT0gbnVsbCAmJiB0aGlzLmlucHV0TWludXRlICE9IG51bGwgJiYgKCF0aGlzLnVzZVNlY29uZHMgfHwgdGhpcy5pbnB1dFNlY29uZCAhPSBudWxsKSkge1xyXG4gICAgICAgIHJldHVybiBgJHtwYWQodGhpcy5pbnB1dEhvdXIpfToke3BhZCh0aGlzLmlucHV0TWludXRlKX1gICsgKHRoaXMudXNlU2Vjb25kcyA/IGA6JHtwYWQodGhpcy5pbnB1dFNlY29uZCEpfWAgOiAnJylcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH0sXHJcbiAgICBlbWl0VmFsdWUgKCkge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2VuVmFsdWUoKVxyXG4gICAgICBpZiAodmFsdWUgIT09IG51bGwpIHRoaXMuJGVtaXQoJ2lucHV0JywgdmFsdWUpXHJcbiAgICB9LFxyXG4gICAgc2V0UGVyaW9kIChwZXJpb2Q6IFBlcmlvZCkge1xyXG4gICAgICB0aGlzLnBlcmlvZCA9IHBlcmlvZFxyXG4gICAgICBpZiAodGhpcy5pbnB1dEhvdXIgIT0gbnVsbCkge1xyXG4gICAgICAgIGNvbnN0IG5ld0hvdXIgPSB0aGlzLmlucHV0SG91ciEgKyAocGVyaW9kID09PSAnYW0nID8gLTEyIDogMTIpXHJcbiAgICAgICAgdGhpcy5pbnB1dEhvdXIgPSB0aGlzLmZpcnN0QWxsb3dlZCgnaG91cicsIG5ld0hvdXIpXHJcbiAgICAgICAgdGhpcy5lbWl0VmFsdWUoKVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgc2V0SW5wdXREYXRhICh2YWx1ZTogc3RyaW5nIHwgbnVsbCB8IERhdGUpIHtcclxuICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT09ICcnKSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dEhvdXIgPSBudWxsXHJcbiAgICAgICAgdGhpcy5pbnB1dE1pbnV0ZSA9IG51bGxcclxuICAgICAgICB0aGlzLmlucHV0U2Vjb25kID0gbnVsbFxyXG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkge1xyXG4gICAgICAgIHRoaXMuaW5wdXRIb3VyID0gdmFsdWUuZ2V0SG91cnMoKVxyXG4gICAgICAgIHRoaXMuaW5wdXRNaW51dGUgPSB2YWx1ZS5nZXRNaW51dGVzKClcclxuICAgICAgICB0aGlzLmlucHV0U2Vjb25kID0gdmFsdWUuZ2V0U2Vjb25kcygpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgWywgaG91ciwgbWludXRlLCAsIHNlY29uZCwgcGVyaW9kXSA9IHZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eKFxcZCspOihcXGQrKSg6KFxcZCspKT8oW2FwXW0pPyQvKSB8fCBuZXcgQXJyYXkoNilcclxuXHJcbiAgICAgICAgdGhpcy5pbnB1dEhvdXIgPSBwZXJpb2QgPyB0aGlzLmNvbnZlcnQxMnRvMjQocGFyc2VJbnQoaG91ciwgMTApLCBwZXJpb2QgYXMgUGVyaW9kKSA6IHBhcnNlSW50KGhvdXIsIDEwKVxyXG4gICAgICAgIHRoaXMuaW5wdXRNaW51dGUgPSBwYXJzZUludChtaW51dGUsIDEwKVxyXG4gICAgICAgIHRoaXMuaW5wdXRTZWNvbmQgPSBwYXJzZUludChzZWNvbmQgfHwgMCwgMTApXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMucGVyaW9kID0gKHRoaXMuaW5wdXRIb3VyID09IG51bGwgfHwgdGhpcy5pbnB1dEhvdXIgPCAxMikgPyAnYW0nIDogJ3BtJ1xyXG4gICAgfSxcclxuICAgIGNvbnZlcnQyNHRvMTIgKGhvdXI6IG51bWJlcikge1xyXG4gICAgICByZXR1cm4gaG91ciA/ICgoaG91ciAtIDEpICUgMTIgKyAxKSA6IDEyXHJcbiAgICB9LFxyXG4gICAgY29udmVydDEydG8yNCAoaG91cjogbnVtYmVyLCBwZXJpb2Q6IFBlcmlvZCkge1xyXG4gICAgICByZXR1cm4gaG91ciAlIDEyICsgKHBlcmlvZCA9PT0gJ3BtJyA/IDEyIDogMClcclxuICAgIH0sXHJcbiAgICBvbklucHV0ICh2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICAgIGlmICh0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMuaG91cikge1xyXG4gICAgICAgIHRoaXMuaW5wdXRIb3VyID0gdGhpcy5pc0FtUG0gPyB0aGlzLmNvbnZlcnQxMnRvMjQodmFsdWUsIHRoaXMucGVyaW9kKSA6IHZhbHVlXHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLm1pbnV0ZSkge1xyXG4gICAgICAgIHRoaXMuaW5wdXRNaW51dGUgPSB2YWx1ZVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuaW5wdXRTZWNvbmQgPSB2YWx1ZVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZW1pdFZhbHVlKClcclxuICAgIH0sXHJcbiAgICBvbkNoYW5nZSAodmFsdWU6IG51bWJlcikge1xyXG4gICAgICB0aGlzLiRlbWl0KGBjbGljazoke3NlbGVjdGluZ05hbWVzW3RoaXMuc2VsZWN0aW5nXX1gLCB2YWx1ZSlcclxuXHJcbiAgICAgIGNvbnN0IGVtaXRDaGFuZ2UgPSB0aGlzLnNlbGVjdGluZyA9PT0gKHRoaXMudXNlU2Vjb25kcyA/IHNlbGVjdGluZ1RpbWVzLnNlY29uZCA6IHNlbGVjdGluZ1RpbWVzLm1pbnV0ZSlcclxuXHJcbiAgICAgIGlmICh0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMuaG91cikge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW5nID0gc2VsZWN0aW5nVGltZXMubWludXRlXHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy51c2VTZWNvbmRzICYmIHRoaXMuc2VsZWN0aW5nID09PSBzZWxlY3RpbmdUaW1lcy5taW51dGUpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGluZyA9IHNlbGVjdGluZ1RpbWVzLnNlY29uZFxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5pbnB1dEhvdXIgPT09IHRoaXMubGF6eUlucHV0SG91ciAmJlxyXG4gICAgICAgIHRoaXMuaW5wdXRNaW51dGUgPT09IHRoaXMubGF6eUlucHV0TWludXRlICYmXHJcbiAgICAgICAgKCF0aGlzLnVzZVNlY29uZHMgfHwgdGhpcy5pbnB1dFNlY29uZCA9PT0gdGhpcy5sYXp5SW5wdXRTZWNvbmQpXHJcbiAgICAgICkgcmV0dXJuXHJcblxyXG4gICAgICBjb25zdCB0aW1lID0gdGhpcy5nZW5WYWx1ZSgpXHJcbiAgICAgIGlmICh0aW1lID09PSBudWxsKSByZXR1cm5cclxuXHJcbiAgICAgIHRoaXMubGF6eUlucHV0SG91ciA9IHRoaXMuaW5wdXRIb3VyXHJcbiAgICAgIHRoaXMubGF6eUlucHV0TWludXRlID0gdGhpcy5pbnB1dE1pbnV0ZVxyXG4gICAgICB0aGlzLnVzZVNlY29uZHMgJiYgKHRoaXMubGF6eUlucHV0U2Vjb25kID0gdGhpcy5pbnB1dFNlY29uZClcclxuXHJcbiAgICAgIGVtaXRDaGFuZ2UgJiYgdGhpcy4kZW1pdCgnY2hhbmdlJywgdGltZSlcclxuICAgIH0sXHJcbiAgICBmaXJzdEFsbG93ZWQgKHR5cGU6ICdob3VyJyB8ICdtaW51dGUnIHwgJ3NlY29uZCcsIHZhbHVlOiBudW1iZXIpIHtcclxuICAgICAgY29uc3QgYWxsb3dlZEZuID0gdHlwZSA9PT0gJ2hvdXInID8gdGhpcy5pc0FsbG93ZWRIb3VyQ2IgOiAodHlwZSA9PT0gJ21pbnV0ZScgPyB0aGlzLmlzQWxsb3dlZE1pbnV0ZUNiIDogdGhpcy5pc0FsbG93ZWRTZWNvbmRDYilcclxuICAgICAgaWYgKCFhbGxvd2VkRm4pIHJldHVybiB2YWx1ZVxyXG5cclxuICAgICAgLy8gVE9ETzogY2xlYW4gdXBcclxuICAgICAgY29uc3QgcmFuZ2UgPSB0eXBlID09PSAnbWludXRlJ1xyXG4gICAgICAgID8gcmFuZ2U2MFxyXG4gICAgICAgIDogKHR5cGUgPT09ICdzZWNvbmQnXHJcbiAgICAgICAgICA/IHJhbmdlNjBcclxuICAgICAgICAgIDogKHRoaXMuaXNBbVBtXHJcbiAgICAgICAgICAgID8gKHZhbHVlIDwgMTJcclxuICAgICAgICAgICAgICA/IHJhbmdlSG91cnMxMmFtXHJcbiAgICAgICAgICAgICAgOiByYW5nZUhvdXJzMTJwbSlcclxuICAgICAgICAgICAgOiByYW5nZUhvdXJzMjQpKVxyXG4gICAgICBjb25zdCBmaXJzdCA9IHJhbmdlLmZpbmQodiA9PiBhbGxvd2VkRm4oKHYgKyB2YWx1ZSkgJSByYW5nZS5sZW5ndGggKyByYW5nZVswXSkpXHJcbiAgICAgIHJldHVybiAoKGZpcnN0IHx8IDApICsgdmFsdWUpICUgcmFuZ2UubGVuZ3RoICsgcmFuZ2VbMF1cclxuICAgIH0sXHJcbiAgICBnZW5DbG9jayAoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZUaW1lUGlja2VyQ2xvY2ssIHtcclxuICAgICAgICBwcm9wczoge1xyXG4gICAgICAgICAgYWxsb3dlZFZhbHVlczpcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLmhvdXJcclxuICAgICAgICAgICAgICA/IHRoaXMuaXNBbGxvd2VkSG91ckNiXHJcbiAgICAgICAgICAgICAgOiAodGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLm1pbnV0ZVxyXG4gICAgICAgICAgICAgICAgPyB0aGlzLmlzQWxsb3dlZE1pbnV0ZUNiXHJcbiAgICAgICAgICAgICAgICA6IHRoaXMuaXNBbGxvd2VkU2Vjb25kQ2IpLFxyXG4gICAgICAgICAgY29sb3I6IHRoaXMuY29sb3IsXHJcbiAgICAgICAgICBkYXJrOiB0aGlzLmRhcmssXHJcbiAgICAgICAgICBkaXNhYmxlZDogdGhpcy5kaXNhYmxlZCxcclxuICAgICAgICAgIGRvdWJsZTogdGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLmhvdXIgJiYgIXRoaXMuaXNBbVBtLFxyXG4gICAgICAgICAgZm9ybWF0OiB0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMuaG91clxyXG4gICAgICAgICAgICA/ICh0aGlzLmlzQW1QbSA/IHRoaXMuY29udmVydDI0dG8xMiA6ICh2YWw6IG51bWJlcikgPT4gdmFsKVxyXG4gICAgICAgICAgICA6ICh2YWw6IG51bWJlcikgPT4gcGFkKHZhbCwgMiksXHJcbiAgICAgICAgICBsaWdodDogdGhpcy5saWdodCxcclxuICAgICAgICAgIG1heDogdGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLmhvdXIgPyAodGhpcy5pc0FtUG0gJiYgdGhpcy5wZXJpb2QgPT09ICdhbScgPyAxMSA6IDIzKSA6IDU5LFxyXG4gICAgICAgICAgbWluOiB0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMuaG91ciAmJiB0aGlzLmlzQW1QbSAmJiB0aGlzLnBlcmlvZCA9PT0gJ3BtJyA/IDEyIDogMCxcclxuICAgICAgICAgIHJlYWRvbmx5OiB0aGlzLnJlYWRvbmx5LFxyXG4gICAgICAgICAgc2Nyb2xsYWJsZTogdGhpcy5zY3JvbGxhYmxlLFxyXG4gICAgICAgICAgc2l6ZTogTnVtYmVyKHRoaXMud2lkdGgpIC0gKCghdGhpcy5mdWxsV2lkdGggJiYgdGhpcy5sYW5kc2NhcGUpID8gODAgOiAyMCksXHJcbiAgICAgICAgICBzdGVwOiB0aGlzLnNlbGVjdGluZyA9PT0gc2VsZWN0aW5nVGltZXMuaG91ciA/IDEgOiA1LFxyXG4gICAgICAgICAgdmFsdWU6IHRoaXMuc2VsZWN0aW5nID09PSBzZWxlY3RpbmdUaW1lcy5ob3VyXHJcbiAgICAgICAgICAgID8gdGhpcy5pbnB1dEhvdXJcclxuICAgICAgICAgICAgOiAodGhpcy5zZWxlY3RpbmcgPT09IHNlbGVjdGluZ1RpbWVzLm1pbnV0ZVxyXG4gICAgICAgICAgICAgID8gdGhpcy5pbnB1dE1pbnV0ZVxyXG4gICAgICAgICAgICAgIDogdGhpcy5pbnB1dFNlY29uZClcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uOiB7XHJcbiAgICAgICAgICBpbnB1dDogdGhpcy5vbklucHV0LFxyXG4gICAgICAgICAgY2hhbmdlOiB0aGlzLm9uQ2hhbmdlXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWY6ICdjbG9jaydcclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBnZW5QaWNrZXJCb2R5ICgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtcclxuICAgICAgICBzdGF0aWNDbGFzczogJ3YtdGltZS1waWNrZXItY2xvY2tfX2NvbnRhaW5lcicsXHJcbiAgICAgICAga2V5OiB0aGlzLnNlbGVjdGluZ1xyXG4gICAgICB9LCBbdGhpcy5nZW5DbG9jaygpXSlcclxuICAgIH0sXHJcbiAgICBnZW5QaWNrZXJUaXRsZSAoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZUaW1lUGlja2VyVGl0bGUsIHtcclxuICAgICAgICBwcm9wczoge1xyXG4gICAgICAgICAgYW1wbTogdGhpcy5pc0FtUG0sXHJcbiAgICAgICAgICBkaXNhYmxlZDogdGhpcy5kaXNhYmxlZCxcclxuICAgICAgICAgIGhvdXI6IHRoaXMuaW5wdXRIb3VyLFxyXG4gICAgICAgICAgbWludXRlOiB0aGlzLmlucHV0TWludXRlLFxyXG4gICAgICAgICAgc2Vjb25kOiB0aGlzLmlucHV0U2Vjb25kLFxyXG4gICAgICAgICAgcGVyaW9kOiB0aGlzLnBlcmlvZCxcclxuICAgICAgICAgIHJlYWRvbmx5OiB0aGlzLnJlYWRvbmx5LFxyXG4gICAgICAgICAgdXNlU2Vjb25kczogdGhpcy51c2VTZWNvbmRzLFxyXG4gICAgICAgICAgc2VsZWN0aW5nOiB0aGlzLnNlbGVjdGluZ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb246IHtcclxuICAgICAgICAgICd1cGRhdGU6c2VsZWN0aW5nJzogKHZhbHVlOiAxIHwgMiB8IDMpID0+ICh0aGlzLnNlbGVjdGluZyA9IHZhbHVlKSxcclxuICAgICAgICAgICd1cGRhdGU6cGVyaW9kJzogdGhpcy5zZXRQZXJpb2RcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlZjogJ3RpdGxlJyxcclxuICAgICAgICBzbG90OiAndGl0bGUnXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgcmVuZGVyICgpOiBWTm9kZSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZW5QaWNrZXIoJ3YtcGlja2VyLS10aW1lJylcclxuICB9XHJcbn0pXHJcbiJdfQ==