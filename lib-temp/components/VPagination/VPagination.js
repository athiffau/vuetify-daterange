import '../../stylus/components/_pagination.styl';
import VIcon from '../VIcon';
// Directives
import Resize from '../../directives/resize';
// Mixins
import mixins from '../../util/mixins';
import Colorable from '../../mixins/colorable';
import Themeable from '../../mixins/themeable';
/* @vue/component */
export default mixins(Colorable, Themeable).extend({
    name: 'v-pagination',
    directives: { Resize },
    props: {
        circle: Boolean,
        disabled: Boolean,
        length: {
            type: Number,
            default: 0,
            validator: (val) => val % 1 === 0
        },
        totalVisible: [Number, String],
        nextIcon: {
            type: String,
            default: '$vuetify.icons.next'
        },
        prevIcon: {
            type: String,
            default: '$vuetify.icons.prev'
        },
        value: {
            type: Number,
            default: 0
        }
    },
    data() {
        return {
            maxButtons: 0,
            selected: null
        };
    },
    computed: {
        classes() {
            return {
                'v-pagination': true,
                'v-pagination--circle': this.circle,
                'v-pagination--disabled': this.disabled,
                ...this.themeClasses
            };
        },
        items() {
            const maxLength = parseInt(this.totalVisible, 10) || this.maxButtons;
            if (this.length <= maxLength) {
                return this.range(1, this.length);
            }
            const even = maxLength % 2 === 0 ? 1 : 0;
            const left = Math.floor(maxLength / 2);
            const right = this.length - left + 1 + even;
            if (this.value > left && this.value < right) {
                const start = this.value - left + 2;
                const end = this.value + left - 2 - even;
                return [1, '...', ...this.range(start, end), '...', this.length];
            }
            else if (this.value === left) {
                const end = this.value + left - 1 - even;
                return [...this.range(1, end), '...', this.length];
            }
            else if (this.value === right) {
                const start = this.value - left + 1;
                return [1, '...', ...this.range(start, this.length)];
            }
            else {
                return [
                    ...this.range(1, left),
                    '...',
                    ...this.range(right, this.length)
                ];
            }
        }
    },
    watch: {
        value() {
            this.init();
        }
    },
    mounted() {
        this.init();
    },
    methods: {
        init() {
            this.selected = null;
            this.$nextTick(this.onResize);
            // TODO: Change this (f75dee3a, cbdf7caa)
            setTimeout(() => (this.selected = this.value), 100);
        },
        onResize() {
            const width = this.$el && this.$el.parentElement
                ? this.$el.parentElement.clientWidth
                : window.innerWidth;
            this.maxButtons = Math.floor((width - 96) / 42);
        },
        next(e) {
            e.preventDefault();
            this.$emit('input', this.value + 1);
            this.$emit('next');
        },
        previous(e) {
            e.preventDefault();
            this.$emit('input', this.value - 1);
            this.$emit('previous');
        },
        range(from, to) {
            const range = [];
            from = from > 0 ? from : 1;
            for (let i = from; i <= to; i++) {
                range.push(i);
            }
            return range;
        },
        genIcon(h, icon, disabled, fn) {
            return h('li', [
                h('button', {
                    staticClass: 'v-pagination__navigation',
                    class: {
                        'v-pagination__navigation--disabled': disabled
                    },
                    attrs: {
                        type: 'button'
                    },
                    on: disabled ? {} : { click: fn }
                }, [h(VIcon, [icon])])
            ]);
        },
        genItem(h, i) {
            const color = (i === this.value) && (this.color || 'primary');
            return h('button', this.setBackgroundColor(color, {
                staticClass: 'v-pagination__item',
                class: {
                    'v-pagination__item--active': i === this.value
                },
                attrs: {
                    type: 'button'
                },
                on: {
                    click: () => this.$emit('input', i)
                }
            }), [i.toString()]);
        },
        genItems(h) {
            return this.items.map((i, index) => {
                return h('li', { key: index }, [
                    isNaN(Number(i)) ? h('span', { class: 'v-pagination__more' }, [i.toString()]) : this.genItem(h, i)
                ]);
            });
        }
    },
    render(h) {
        const children = [
            this.genIcon(h, this.$vuetify.rtl ? this.nextIcon : this.prevIcon, this.value <= 1, this.previous),
            this.genItems(h),
            this.genIcon(h, this.$vuetify.rtl ? this.prevIcon : this.nextIcon, this.value >= this.length, this.next)
        ];
        return h('ul', {
            directives: [{
                    modifiers: { quiet: true },
                    name: 'resize',
                    value: this.onResize
                }],
            class: this.classes
        }, children);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlBhZ2luYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WUGFnaW5hdGlvbi9WUGFnaW5hdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLDBDQUEwQyxDQUFBO0FBRWpELE9BQU8sS0FBSyxNQUFNLFVBQVUsQ0FBQTtBQUU1QixhQUFhO0FBQ2IsT0FBTyxNQUFNLE1BQU0seUJBQXlCLENBQUE7QUFFNUMsU0FBUztBQUNULE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFBO0FBQ3RDLE9BQU8sU0FBUyxNQUFNLHdCQUF3QixDQUFBO0FBQzlDLE9BQU8sU0FBUyxNQUFNLHdCQUF3QixDQUFBO0FBSzlDLG9CQUFvQjtBQUNwQixlQUFlLE1BQU0sQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ2pELElBQUksRUFBRSxjQUFjO0lBRXBCLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRTtJQUV0QixLQUFLLEVBQUU7UUFDTCxNQUFNLEVBQUUsT0FBTztRQUNmLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLENBQUM7WUFDVixTQUFTLEVBQUUsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztTQUMxQztRQUNELFlBQVksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFDOUIsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUscUJBQXFCO1NBQy9CO1FBQ0QsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUscUJBQXFCO1NBQy9CO1FBQ0QsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsQ0FBQztTQUNYO0tBQ0Y7SUFFRCxJQUFJO1FBQ0YsT0FB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QUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztTQUN6RyxDQUFBO1FBRUQsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFO1lBQ2IsVUFBVSxFQUFFLENBQUM7b0JBQ1gsU0FBUyxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDMUIsSUFBSSxFQUFFLFFBQVE7b0JBQ2QsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRO2lCQUNyQixDQUFDO1lBQ0YsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPO1NBQ3BCLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDZCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuLi8uLi9zdHlsdXMvY29tcG9uZW50cy9fcGFnaW5hdGlvbi5zdHlsJ1xyXG5cclxuaW1wb3J0IFZJY29uIGZyb20gJy4uL1ZJY29uJ1xyXG5cclxuLy8gRGlyZWN0aXZlc1xyXG5pbXBvcnQgUmVzaXplIGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvcmVzaXplJ1xyXG5cclxuLy8gTWl4aW5zXHJcbmltcG9ydCBtaXhpbnMgZnJvbSAnLi4vLi4vdXRpbC9taXhpbnMnXHJcbmltcG9ydCBDb2xvcmFibGUgZnJvbSAnLi4vLi4vbWl4aW5zL2NvbG9yYWJsZSdcclxuaW1wb3J0IFRoZW1lYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvdGhlbWVhYmxlJ1xyXG5cclxuLy8gVHlwZXNcclxuaW1wb3J0IHsgVk5vZGUsIENyZWF0ZUVsZW1lbnQgfSBmcm9tICd2dWUnXHJcblxyXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xyXG5leHBvcnQgZGVmYXVsdCBtaXhpbnMoQ29sb3JhYmxlLCBUaGVtZWFibGUpLmV4dGVuZCh7XHJcbiAgbmFtZTogJ3YtcGFnaW5hdGlvbicsXHJcblxyXG4gIGRpcmVjdGl2ZXM6IHsgUmVzaXplIH0sXHJcblxyXG4gIHByb3BzOiB7XHJcbiAgICBjaXJjbGU6IEJvb2xlYW4sXHJcbiAgICBkaXNhYmxlZDogQm9vbGVhbixcclxuICAgIGxlbmd0aDoge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIGRlZmF1bHQ6IDAsXHJcbiAgICAgIHZhbGlkYXRvcjogKHZhbDogbnVtYmVyKSA9PiB2YWwgJSAxID09PSAwXHJcbiAgICB9LFxyXG4gICAgdG90YWxWaXNpYmxlOiBbTnVtYmVyLCBTdHJpbmddLFxyXG4gICAgbmV4dEljb246IHtcclxuICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICBkZWZhdWx0OiAnJHZ1ZXRpZnkuaWNvbnMubmV4dCdcclxuICAgIH0sXHJcbiAgICBwcmV2SWNvbjoge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIGRlZmF1bHQ6ICckdnVldGlmeS5pY29ucy5wcmV2J1xyXG4gICAgfSxcclxuICAgIHZhbHVlOiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgZGVmYXVsdDogMFxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGRhdGEgKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbWF4QnV0dG9uczogMCxcclxuICAgICAgc2VsZWN0ZWQ6IG51bGwgYXMgbnVtYmVyIHwgbnVsbFxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGNvbXB1dGVkOiB7XHJcbiAgICBjbGFzc2VzICgpOiBvYmplY3Qge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICd2LXBhZ2luYXRpb24nOiB0cnVlLFxyXG4gICAgICAgICd2LXBhZ2luYXRpb24tLWNpcmNsZSc6IHRoaXMuY2lyY2xlLFxyXG4gICAgICAgICd2LXBhZ2luYXRpb24tLWRpc2FibGVkJzogdGhpcy5kaXNhYmxlZCxcclxuICAgICAgICAuLi50aGlzLnRoZW1lQ2xhc3Nlc1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGl0ZW1zICgpOiAoc3RyaW5nIHwgbnVtYmVyKVtdIHtcclxuICAgICAgY29uc3QgbWF4TGVuZ3RoID0gcGFyc2VJbnQodGhpcy50b3RhbFZpc2libGUsIDEwKSB8fCB0aGlzLm1heEJ1dHRvbnNcclxuICAgICAgaWYgKHRoaXMubGVuZ3RoIDw9IG1heExlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJhbmdlKDEsIHRoaXMubGVuZ3RoKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBldmVuID0gbWF4TGVuZ3RoICUgMiA9PT0gMCA/IDEgOiAwXHJcbiAgICAgIGNvbnN0IGxlZnQgPSBNYXRoLmZsb29yKG1heExlbmd0aCAvIDIpXHJcbiAgICAgIGNvbnN0IHJpZ2h0ID0gdGhpcy5sZW5ndGggLSBsZWZ0ICsgMSArIGV2ZW5cclxuXHJcbiAgICAgIGlmICh0aGlzLnZhbHVlID4gbGVmdCAmJiB0aGlzLnZhbHVlIDwgcmlnaHQpIHtcclxuICAgICAgICBjb25zdCBzdGFydCA9IHRoaXMudmFsdWUgLSBsZWZ0ICsgMlxyXG4gICAgICAgIGNvbnN0IGVuZCA9IHRoaXMudmFsdWUgKyBsZWZ0IC0gMiAtIGV2ZW5cclxuXHJcbiAgICAgICAgcmV0dXJuIFsxLCAnLi4uJywgLi4udGhpcy5yYW5nZShzdGFydCwgZW5kKSwgJy4uLicsIHRoaXMubGVuZ3RoXVxyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMudmFsdWUgPT09IGxlZnQpIHtcclxuICAgICAgICBjb25zdCBlbmQgPSB0aGlzLnZhbHVlICsgbGVmdCAtIDEgLSBldmVuXHJcbiAgICAgICAgcmV0dXJuIFsuLi50aGlzLnJhbmdlKDEsIGVuZCksICcuLi4nLCB0aGlzLmxlbmd0aF1cclxuICAgICAgfSBlbHNlIGlmICh0aGlzLnZhbHVlID09PSByaWdodCkge1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy52YWx1ZSAtIGxlZnQgKyAxXHJcbiAgICAgICAgcmV0dXJuIFsxLCAnLi4uJywgLi4udGhpcy5yYW5nZShzdGFydCwgdGhpcy5sZW5ndGgpXVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAuLi50aGlzLnJhbmdlKDEsIGxlZnQpLFxyXG4gICAgICAgICAgJy4uLicsXHJcbiAgICAgICAgICAuLi50aGlzLnJhbmdlKHJpZ2h0LCB0aGlzLmxlbmd0aClcclxuICAgICAgICBdXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9LFxyXG5cclxuICB3YXRjaDoge1xyXG4gICAgdmFsdWUgKCkge1xyXG4gICAgICB0aGlzLmluaXQoKVxyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIG1vdW50ZWQgKCkge1xyXG4gICAgdGhpcy5pbml0KClcclxuICB9LFxyXG5cclxuICBtZXRob2RzOiB7XHJcbiAgICBpbml0ICgpIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZCA9IG51bGxcclxuXHJcbiAgICAgIHRoaXMuJG5leHRUaWNrKHRoaXMub25SZXNpemUpXHJcbiAgICAgIC8vIFRPRE86IENoYW5nZSB0aGlzIChmNzVkZWUzYSwgY2JkZjdjYWEpXHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gKHRoaXMuc2VsZWN0ZWQgPSB0aGlzLnZhbHVlKSwgMTAwKVxyXG4gICAgfSxcclxuICAgIG9uUmVzaXplICgpIHtcclxuICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLiRlbCAmJiB0aGlzLiRlbC5wYXJlbnRFbGVtZW50XHJcbiAgICAgICAgPyB0aGlzLiRlbC5wYXJlbnRFbGVtZW50LmNsaWVudFdpZHRoXHJcbiAgICAgICAgOiB3aW5kb3cuaW5uZXJXaWR0aFxyXG5cclxuICAgICAgdGhpcy5tYXhCdXR0b25zID0gTWF0aC5mbG9vcigod2lkdGggLSA5NikgLyA0MilcclxuICAgIH0sXHJcbiAgICBuZXh0IChlOiBFdmVudCkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLnZhbHVlICsgMSlcclxuICAgICAgdGhpcy4kZW1pdCgnbmV4dCcpXHJcbiAgICB9LFxyXG4gICAgcHJldmlvdXMgKGU6IEV2ZW50KSB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxyXG4gICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMudmFsdWUgLSAxKVxyXG4gICAgICB0aGlzLiRlbWl0KCdwcmV2aW91cycpXHJcbiAgICB9LFxyXG4gICAgcmFuZ2UgKGZyb206IG51bWJlciwgdG86IG51bWJlcikge1xyXG4gICAgICBjb25zdCByYW5nZSA9IFtdXHJcblxyXG4gICAgICBmcm9tID0gZnJvbSA+IDAgPyBmcm9tIDogMVxyXG5cclxuICAgICAgZm9yIChsZXQgaSA9IGZyb207IGkgPD0gdG87IGkrKykge1xyXG4gICAgICAgIHJhbmdlLnB1c2goaSlcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJhbmdlXHJcbiAgICB9LFxyXG4gICAgZ2VuSWNvbiAoaDogQ3JlYXRlRWxlbWVudCwgaWNvbjogc3RyaW5nLCBkaXNhYmxlZDogYm9vbGVhbiwgZm46IEV2ZW50TGlzdGVuZXIpOiBWTm9kZSB7XHJcbiAgICAgIHJldHVybiBoKCdsaScsIFtcclxuICAgICAgICBoKCdidXR0b24nLCB7XHJcbiAgICAgICAgICBzdGF0aWNDbGFzczogJ3YtcGFnaW5hdGlvbl9fbmF2aWdhdGlvbicsXHJcbiAgICAgICAgICBjbGFzczoge1xyXG4gICAgICAgICAgICAndi1wYWdpbmF0aW9uX19uYXZpZ2F0aW9uLS1kaXNhYmxlZCc6IGRpc2FibGVkXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgICAgdHlwZTogJ2J1dHRvbidcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBvbjogZGlzYWJsZWQgPyB7fSA6IHsgY2xpY2s6IGZuIH1cclxuICAgICAgICB9LCBbaChWSWNvbiwgW2ljb25dKV0pXHJcbiAgICAgIF0pXHJcbiAgICB9LFxyXG4gICAgZ2VuSXRlbSAoaDogQ3JlYXRlRWxlbWVudCwgaTogc3RyaW5nIHwgbnVtYmVyKTogVk5vZGUge1xyXG4gICAgICBjb25zdCBjb2xvcjogc3RyaW5nIHwgZmFsc2UgPSAoaSA9PT0gdGhpcy52YWx1ZSkgJiYgKHRoaXMuY29sb3IgfHwgJ3ByaW1hcnknKVxyXG4gICAgICByZXR1cm4gaCgnYnV0dG9uJywgdGhpcy5zZXRCYWNrZ3JvdW5kQ29sb3IoY29sb3IsIHtcclxuICAgICAgICBzdGF0aWNDbGFzczogJ3YtcGFnaW5hdGlvbl9faXRlbScsXHJcbiAgICAgICAgY2xhc3M6IHtcclxuICAgICAgICAgICd2LXBhZ2luYXRpb25fX2l0ZW0tLWFjdGl2ZSc6IGkgPT09IHRoaXMudmFsdWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGF0dHJzOiB7XHJcbiAgICAgICAgICB0eXBlOiAnYnV0dG9uJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb246IHtcclxuICAgICAgICAgIGNsaWNrOiAoKSA9PiB0aGlzLiRlbWl0KCdpbnB1dCcsIGkpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KSwgW2kudG9TdHJpbmcoKV0pXHJcbiAgICB9LFxyXG4gICAgZ2VuSXRlbXMgKGg6IENyZWF0ZUVsZW1lbnQpOiBWTm9kZVtdIHtcclxuICAgICAgcmV0dXJuIHRoaXMuaXRlbXMubWFwKChpLCBpbmRleCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBoKCdsaScsIHsga2V5OiBpbmRleCB9LCBbXHJcbiAgICAgICAgICBpc05hTihOdW1iZXIoaSkpID8gaCgnc3BhbicsIHsgY2xhc3M6ICd2LXBhZ2luYXRpb25fX21vcmUnIH0sIFtpLnRvU3RyaW5nKCldKSA6IHRoaXMuZ2VuSXRlbShoLCBpKVxyXG4gICAgICAgIF0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgcmVuZGVyIChoKTogVk5vZGUge1xyXG4gICAgY29uc3QgY2hpbGRyZW4gPSBbXHJcbiAgICAgIHRoaXMuZ2VuSWNvbihoLCB0aGlzLiR2dWV0aWZ5LnJ0bCA/IHRoaXMubmV4dEljb24gOiB0aGlzLnByZXZJY29uLCB0aGlzLnZhbHVlIDw9IDEsIHRoaXMucHJldmlvdXMpLFxyXG4gICAgICB0aGlzLmdlbkl0ZW1zKGgpLFxyXG4gICAgICB0aGlzLmdlbkljb24oaCwgdGhpcy4kdnVldGlmeS5ydGwgPyB0aGlzLnByZXZJY29uIDogdGhpcy5uZXh0SWNvbiwgdGhpcy52YWx1ZSA+PSB0aGlzLmxlbmd0aCwgdGhpcy5uZXh0KVxyXG4gICAgXVxyXG5cclxuICAgIHJldHVybiBoKCd1bCcsIHtcclxuICAgICAgZGlyZWN0aXZlczogW3tcclxuICAgICAgICBtb2RpZmllcnM6IHsgcXVpZXQ6IHRydWUgfSxcclxuICAgICAgICBuYW1lOiAncmVzaXplJyxcclxuICAgICAgICB2YWx1ZTogdGhpcy5vblJlc2l6ZVxyXG4gICAgICB9XSxcclxuICAgICAgY2xhc3M6IHRoaXMuY2xhc3Nlc1xyXG4gICAgfSwgY2hpbGRyZW4pXHJcbiAgfVxyXG59KVxyXG4iXX0=