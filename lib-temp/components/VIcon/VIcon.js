import '../../stylus/components/_icons.styl';
// Mixins
import Colorable from '../../mixins/colorable';
import Sizeable from '../../mixins/sizeable';
import Themeable from '../../mixins/themeable';
// Util
import { convertToUnit, keys, remapInternalIcon } from '../../util/helpers';
// Types
import Vue from 'vue';
import mixins from '../../util/mixins';
var SIZE_MAP;
(function (SIZE_MAP) {
    SIZE_MAP["small"] = "16px";
    SIZE_MAP["default"] = "24px";
    SIZE_MAP["medium"] = "28px";
    SIZE_MAP["large"] = "36px";
    SIZE_MAP["xLarge"] = "40px";
})(SIZE_MAP || (SIZE_MAP = {}));
function isFontAwesome5(iconType) {
    return ['fas', 'far', 'fal', 'fab'].some(val => iconType.includes(val));
}
const VIcon = mixins(Colorable, Sizeable, Themeable
/* @vue/component */
).extend({
    name: 'v-icon',
    props: {
        disabled: Boolean,
        left: Boolean,
        right: Boolean
    },
    methods: {
        getIcon() {
            let iconName = '';
            if (this.$slots.default)
                iconName = this.$slots.default[0].text.trim();
            return remapInternalIcon(this, iconName);
        },
        getSize() {
            const sizes = {
                small: this.small,
                medium: this.medium,
                large: this.large,
                xLarge: this.xLarge
            };
            const explicitSize = keys(sizes).find(key => sizes[key]);
            return (explicitSize && SIZE_MAP[explicitSize]) || convertToUnit(this.size);
        },
        // Component data for both font and svg icon.
        getDefaultData() {
            const data = {
                staticClass: 'v-icon',
                class: {
                    'v-icon--disabled': this.disabled,
                    'v-icon--left': this.left,
                    'v-icon--link': this.$listeners.click || this.$listeners['!click'],
                    'v-icon--right': this.right
                },
                attrs: {
                    'aria-hidden': true,
                    ...this.$attrs
                },
                on: this.$listeners
            };
            return data;
        },
        applyColors(data) {
            data.class = { ...data.class, ...this.themeClasses };
            this.setTextColor(this.color, data);
        },
        renderFontIcon(icon, h) {
            const newChildren = [];
            const data = this.getDefaultData();
            let iconType = 'material-icons';
            // Material Icon delimiter is _
            // https://material.io/icons/
            const delimiterIndex = icon.indexOf('-');
            const isMaterialIcon = delimiterIndex <= -1;
            if (isMaterialIcon) {
                // Material icon uses ligatures.
                newChildren.push(icon);
            }
            else {
                iconType = icon.slice(0, delimiterIndex);
                if (isFontAwesome5(iconType))
                    iconType = '';
            }
            data.class[iconType] = true;
            data.class[icon] = !isMaterialIcon;
            const fontSize = this.getSize();
            if (fontSize)
                data.style = { fontSize };
            this.applyColors(data);
            return h('i', data, newChildren);
        },
        renderSvgIcon(icon, h) {
            const data = this.getDefaultData();
            data.class['v-icon--is-component'] = true;
            const size = this.getSize();
            if (size) {
                data.style = {
                    fontSize: size,
                    height: size
                };
            }
            this.applyColors(data);
            const component = icon.component;
            data.props = icon.props;
            data.nativeOn = data.on;
            return h(component, data);
        }
    },
    render(h) {
        const icon = this.getIcon();
        if (typeof icon === 'string') {
            return this.renderFontIcon(icon, h);
        }
        return this.renderSvgIcon(icon, h);
    }
});
export default Vue.extend({
    name: 'v-icon',
    $_wrapperFor: VIcon,
    functional: true,
    render(h, { data, children }) {
        let iconName = '';
        // Support usage of v-text and v-html
        if (data.domProps) {
            iconName = data.domProps.textContent ||
                data.domProps.innerHTML ||
                iconName;
            // Remove nodes so it doesn't
            // overwrite our changes
            delete data.domProps.textContent;
            delete data.domProps.innerHTML;
        }
        return h(VIcon, data, iconName ? [iconName] : children);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVkljb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WSWNvbi9WSWNvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLHFDQUFxQyxDQUFBO0FBQzVDLFNBQVM7QUFDVCxPQUFPLFNBQVMsTUFBTSx3QkFBd0IsQ0FBQTtBQUM5QyxPQUFPLFFBQVEsTUFBTSx1QkFBdUIsQ0FBQTtBQUM1QyxPQUFPLFNBQVMsTUFBTSx3QkFBd0IsQ0FBQTtBQUM5QyxPQUFPO0FBQ1AsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUMzRSxRQUFRO0FBQ1IsT0FBTyxHQUF1RCxNQUFNLEtBQUssQ0FBQTtBQUN6RSxPQUFPLE1BQU0sTUFBTSxtQkFBbUIsQ0FBQTtBQUd0QyxJQUFLLFFBTUo7QUFORCxXQUFLLFFBQVE7SUFDWCwwQkFBYyxDQUFBO0lBQ2QsNEJBQWdCLENBQUE7SUFDaEIsMkJBQWUsQ0FBQTtJQUNmLDBCQUFjLENBQUE7SUFDZCwyQkFBZSxDQUFBO0FBQ2pCLENBQUMsRUFOSSxRQUFRLEtBQVIsUUFBUSxRQU1aO0FBRUQsU0FBUyxjQUFjLENBQUUsUUFBZ0I7SUFDdkMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUN6RSxDQUFDO0FBRUQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUNsQixTQUFTLEVBQ1QsUUFBUSxFQUNSLFNBQVM7QUFDVCxvQkFBb0I7Q0FDckIsQ0FBQyxNQUFNLENBQUM7SUFDUCxJQUFJLEVBQUUsUUFBUTtJQUVkLEtBQUssRUFBRTtRQUNMLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLElBQUksRUFBRSxPQUFPO1FBQ2IsS0FBSyxFQUFF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QU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDcEMsQ0FBQztDQUNGLENBQUMsQ0FBQTtBQUVGLGVBQWUsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUN4QixJQUFJLEVBQUUsUUFBUTtJQUVkLFlBQVksRUFBRSxLQUFLO0lBRW5CLFVBQVUsRUFBRSxJQUFJO0lBRWhCLE1BQU0sQ0FBRSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO1FBQzNCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQTtRQUVqQixxQ0FBcUM7UUFDckMsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVc7Z0JBQ2xDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUztnQkFDdkIsUUFBUSxDQUFBO1lBRVYsNkJBQTZCO1lBQzdCLHdCQUF3QjtZQUN4QixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFBO1lBQ2hDLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUE7U0FDL0I7UUFFRCxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDekQsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi4vLi4vc3R5bHVzL2NvbXBvbmVudHMvX2ljb25zLnN0eWwnXHJcbi8vIE1peGluc1xyXG5pbXBvcnQgQ29sb3JhYmxlIGZyb20gJy4uLy4uL21peGlucy9jb2xvcmFibGUnXHJcbmltcG9ydCBTaXplYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvc2l6ZWFibGUnXHJcbmltcG9ydCBUaGVtZWFibGUgZnJvbSAnLi4vLi4vbWl4aW5zL3RoZW1lYWJsZSdcclxuLy8gVXRpbFxyXG5pbXBvcnQgeyBjb252ZXJ0VG9Vbml0LCBrZXlzLCByZW1hcEludGVybmFsSWNvbiB9IGZyb20gJy4uLy4uL3V0aWwvaGVscGVycydcclxuLy8gVHlwZXNcclxuaW1wb3J0IFZ1ZSwgeyBDcmVhdGVFbGVtZW50LCBWTm9kZSwgVk5vZGVDaGlsZHJlbiwgVk5vZGVEYXRhIH0gZnJvbSAndnVlJ1xyXG5pbXBvcnQgbWl4aW5zIGZyb20gJy4uLy4uL3V0aWwvbWl4aW5zJ1xyXG5pbXBvcnQgeyBWdWV0aWZ5SWNvbiwgVnVldGlmeUljb25Db21wb25lbnQgfSBmcm9tICd2dWV0aWZ5J1xyXG5cclxuZW51bSBTSVpFX01BUCB7XHJcbiAgc21hbGwgPSAnMTZweCcsXHJcbiAgZGVmYXVsdCA9ICcyNHB4JyxcclxuICBtZWRpdW0gPSAnMjhweCcsXHJcbiAgbGFyZ2UgPSAnMzZweCcsXHJcbiAgeExhcmdlID0gJzQwcHgnXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzRm9udEF3ZXNvbWU1IChpY29uVHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIFsnZmFzJywgJ2ZhcicsICdmYWwnLCAnZmFiJ10uc29tZSh2YWwgPT4gaWNvblR5cGUuaW5jbHVkZXModmFsKSlcclxufVxyXG5cclxuY29uc3QgVkljb24gPSBtaXhpbnMoXHJcbiAgQ29sb3JhYmxlLFxyXG4gIFNpemVhYmxlLFxyXG4gIFRoZW1lYWJsZVxyXG4gIC8qIEB2dWUvY29tcG9uZW50ICovXHJcbikuZXh0ZW5kKHtcclxuICBuYW1lOiAndi1pY29uJyxcclxuXHJcbiAgcHJvcHM6IHtcclxuICAgIGRpc2FibGVkOiBCb29sZWFuLFxyXG4gICAgbGVmdDogQm9vbGVhbixcclxuICAgIHJpZ2h0OiBCb29sZWFuXHJcbiAgfSxcclxuXHJcbiAgbWV0aG9kczoge1xyXG4gICAgZ2V0SWNvbiAoKTogVnVldGlmeUljb24ge1xyXG4gICAgICBsZXQgaWNvbk5hbWUgPSAnJ1xyXG4gICAgICBpZiAodGhpcy4kc2xvdHMuZGVmYXVsdCkgaWNvbk5hbWUgPSB0aGlzLiRzbG90cy5kZWZhdWx0WzBdLnRleHQhLnRyaW0oKVxyXG5cclxuICAgICAgcmV0dXJuIHJlbWFwSW50ZXJuYWxJY29uKHRoaXMsIGljb25OYW1lKVxyXG4gICAgfSxcclxuICAgIGdldFNpemUgKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICAgIGNvbnN0IHNpemVzID0ge1xyXG4gICAgICAgIHNtYWxsOiB0aGlzLnNtYWxsLFxyXG4gICAgICAgIG1lZGl1bTogdGhpcy5tZWRpdW0sXHJcbiAgICAgICAgbGFyZ2U6IHRoaXMubGFyZ2UsXHJcbiAgICAgICAgeExhcmdlOiB0aGlzLnhMYXJnZVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBleHBsaWNpdFNpemUgPSBrZXlzKHNpemVzKS5maW5kKGtleSA9PiBzaXplc1trZXldKVxyXG5cclxuICAgICAgcmV0dXJuIChleHBsaWNpdFNpemUgJiYgU0laRV9NQVBbZXhwbGljaXRTaXplXSkgfHwgY29udmVydFRvVW5pdCh0aGlzLnNpemUpXHJcbiAgICB9LFxyXG4gICAgLy8gQ29tcG9uZW50IGRhdGEgZm9yIGJvdGggZm9udCBhbmQgc3ZnIGljb24uXHJcbiAgICBnZXREZWZhdWx0RGF0YSAoKTogVk5vZGVEYXRhIHtcclxuICAgICAgY29uc3QgZGF0YTogVk5vZGVEYXRhID0ge1xyXG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi1pY29uJyxcclxuICAgICAgICBjbGFzczoge1xyXG4gICAgICAgICAgJ3YtaWNvbi0tZGlzYWJsZWQnOiB0aGlzLmRpc2FibGVkLFxyXG4gICAgICAgICAgJ3YtaWNvbi0tbGVmdCc6IHRoaXMubGVmdCxcclxuICAgICAgICAgICd2LWljb24tLWxpbmsnOiB0aGlzLiRsaXN0ZW5lcnMuY2xpY2sgfHwgdGhpcy4kbGlzdGVuZXJzWychY2xpY2snXSxcclxuICAgICAgICAgICd2LWljb24tLXJpZ2h0JzogdGhpcy5yaWdodFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXR0cnM6IHtcclxuICAgICAgICAgICdhcmlhLWhpZGRlbic6IHRydWUsXHJcbiAgICAgICAgICAuLi50aGlzLiRhdHRyc1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb246IHRoaXMuJGxpc3RlbmVyc1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gZGF0YVxyXG4gICAgfSxcclxuICAgIGFwcGx5Q29sb3JzIChkYXRhOiBWTm9kZURhdGEpOiB2b2lkIHtcclxuICAgICAgZGF0YS5jbGFzcyA9IHsgLi4uZGF0YS5jbGFzcywgLi4udGhpcy50aGVtZUNsYXNzZXMgfVxyXG4gICAgICB0aGlzLnNldFRleHRDb2xvcih0aGlzLmNvbG9yLCBkYXRhKVxyXG4gICAgfSxcclxuICAgIHJlbmRlckZvbnRJY29uIChpY29uOiBzdHJpbmcsIGg6IENyZWF0ZUVsZW1lbnQpOiBWTm9kZSB7XHJcbiAgICAgIGNvbnN0IG5ld0NoaWxkcmVuOiBWTm9kZUNoaWxkcmVuID0gW11cclxuICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0RGVmYXVsdERhdGEoKVxyXG5cclxuICAgICAgbGV0IGljb25UeXBlID0gJ21hdGVyaWFsLWljb25zJ1xyXG4gICAgICAvLyBNYXRlcmlhbCBJY29uIGRlbGltaXRlciBpcyBfXHJcbiAgICAgIC8vIGh0dHBzOi8vbWF0ZXJpYWwuaW8vaWNvbnMvXHJcbiAgICAgIGNvbnN0IGRlbGltaXRlckluZGV4ID0gaWNvbi5pbmRleE9mKCctJylcclxuICAgICAgY29uc3QgaXNNYXRlcmlhbEljb24gPSBkZWxpbWl0ZXJJbmRleCA8PSAtMVxyXG5cclxuICAgICAgaWYgKGlzTWF0ZXJpYWxJY29uKSB7XHJcbiAgICAgICAgLy8gTWF0ZXJpYWwgaWNvbiB1c2VzIGxpZ2F0dXJlcy5cclxuICAgICAgICBuZXdDaGlsZHJlbi5wdXNoKGljb24pXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWNvblR5cGUgPSBpY29uLnNsaWNlKDAsIGRlbGltaXRlckluZGV4KVxyXG4gICAgICAgIGlmIChpc0ZvbnRBd2Vzb21lNShpY29uVHlwZSkpIGljb25UeXBlID0gJydcclxuICAgICAgfVxyXG5cclxuICAgICAgZGF0YS5jbGFzc1tpY29uVHlwZV0gPSB0cnVlXHJcbiAgICAgIGRhdGEuY2xhc3NbaWNvbl0gPSAhaXNNYXRlcmlhbEljb25cclxuXHJcbiAgICAgIGNvbnN0IGZvbnRTaXplID0gdGhpcy5nZXRTaXplKClcclxuICAgICAgaWYgKGZvbnRTaXplKSBkYXRhLnN0eWxlID0geyBmb250U2l6ZSB9XHJcblxyXG4gICAgICB0aGlzLmFwcGx5Q29sb3JzKGRhdGEpXHJcblxyXG4gICAgICByZXR1cm4gaCgnaScsIGRhdGEsIG5ld0NoaWxkcmVuKVxyXG4gICAgfSxcclxuICAgIHJlbmRlclN2Z0ljb24gKGljb246IFZ1ZXRpZnlJY29uQ29tcG9uZW50LCBoOiBDcmVhdGVFbGVtZW50KTogVk5vZGUge1xyXG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXREZWZhdWx0RGF0YSgpXHJcbiAgICAgIGRhdGEuY2xhc3NbJ3YtaWNvbi0taXMtY29tcG9uZW50J10gPSB0cnVlXHJcblxyXG4gICAgICBjb25zdCBzaXplID0gdGhpcy5nZXRTaXplKClcclxuICAgICAgaWYgKHNpemUpIHtcclxuICAgICAgICBkYXRhLnN0eWxlID0ge1xyXG4gICAgICAgICAgZm9udFNpemU6IHNpemUsXHJcbiAgICAgICAgICBoZWlnaHQ6IHNpemVcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuYXBwbHlDb2xvcnMoZGF0YSlcclxuXHJcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGljb24uY29tcG9uZW50XHJcbiAgICAgIGRhdGEucHJvcHMgPSBpY29uLnByb3BzXHJcbiAgICAgIGRhdGEubmF0aXZlT24gPSBkYXRhLm9uXHJcblxyXG4gICAgICByZXR1cm4gaChjb21wb25lbnQsIGRhdGEpXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgcmVuZGVyIChoOiBDcmVhdGVFbGVtZW50KTogVk5vZGUge1xyXG4gICAgY29uc3QgaWNvbiA9IHRoaXMuZ2V0SWNvbigpXHJcblxyXG4gICAgaWYgKHR5cGVvZiBpY29uID09PSAnc3RyaW5nJykge1xyXG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJGb250SWNvbihpY29uLCBoKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnJlbmRlclN2Z0ljb24oaWNvbiwgaClcclxuICB9XHJcbn0pXHJcblxyXG5leHBvcnQgZGVmYXVsdCBWdWUuZXh0ZW5kKHtcclxuICBuYW1lOiAndi1pY29uJyxcclxuXHJcbiAgJF93cmFwcGVyRm9yOiBWSWNvbixcclxuXHJcbiAgZnVuY3Rpb25hbDogdHJ1ZSxcclxuXHJcbiAgcmVuZGVyIChoLCB7IGRhdGEsIGNoaWxkcmVuIH0pOiBWTm9kZSB7XHJcbiAgICBsZXQgaWNvbk5hbWUgPSAnJ1xyXG5cclxuICAgIC8vIFN1cHBvcnQgdXNhZ2Ugb2Ygdi10ZXh0IGFuZCB2LWh0bWxcclxuICAgIGlmIChkYXRhLmRvbVByb3BzKSB7XHJcbiAgICAgIGljb25OYW1lID0gZGF0YS5kb21Qcm9wcy50ZXh0Q29udGVudCB8fFxyXG4gICAgICAgIGRhdGEuZG9tUHJvcHMuaW5uZXJIVE1MIHx8XHJcbiAgICAgICAgaWNvbk5hbWVcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBub2RlcyBzbyBpdCBkb2Vzbid0XHJcbiAgICAgIC8vIG92ZXJ3cml0ZSBvdXIgY2hhbmdlc1xyXG4gICAgICBkZWxldGUgZGF0YS5kb21Qcm9wcy50ZXh0Q29udGVudFxyXG4gICAgICBkZWxldGUgZGF0YS5kb21Qcm9wcy5pbm5lckhUTUxcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaChWSWNvbiwgZGF0YSwgaWNvbk5hbWUgPyBbaWNvbk5hbWVdIDogY2hpbGRyZW4pXHJcbiAgfVxyXG59KVxyXG4iXX0=