{"version":3,"sources":["../../../src/components/VImg/VImg.ts"],"names":[],"mappings":"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","sourcesContent":["import '../../stylus/components/_images.styl'\r\n\r\n// Types\r\nimport { VNode } from 'vue'\r\nimport { PropValidator } from 'vue/types/options'\r\n\r\n// Components\r\nimport VResponsive from '../VResponsive'\r\n\r\n// Utils\r\nimport { consoleError, consoleWarn } from '../../util/console'\r\n\r\n// not intended for public use, this is passed in by vuetify-loader\r\nexport interface srcObject {\r\n  src: string\r\n  srcset?: string\r\n  lazySrc: string\r\n  aspect: number\r\n}\r\n\r\n/* @vue/component */\r\nexport default VResponsive.extend({\r\n  name: 'v-img',\r\n\r\n  props: {\r\n    alt: String,\r\n    contain: Boolean,\r\n    src: {\r\n      type: [String, Object],\r\n      default: ''\r\n    } as PropValidator<string | srcObject>,\r\n    gradient: String,\r\n    lazySrc: String,\r\n    srcset: String,\r\n    sizes: String,\r\n    position: {\r\n      type: String,\r\n      default: 'center center'\r\n    },\r\n    transition: {\r\n      type: [Boolean, String],\r\n      default: 'fade-transition'\r\n    }\r\n  },\r\n\r\n  data () {\r\n    return {\r\n      currentSrc: '', // Set from srcset\r\n      image: null as HTMLImageElement | null,\r\n      isLoading: true,\r\n      calculatedAspectRatio: undefined as number | undefined\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    computedAspectRatio (): number {\r\n      return this.normalisedSrc.aspect\r\n    },\r\n    normalisedSrc (): srcObject {\r\n      return typeof this.src === 'string'\r\n        ? {\r\n          src: this.src,\r\n          srcset: this.srcset,\r\n          lazySrc: this.lazySrc,\r\n          aspect: Number(this.aspectRatio || this.calculatedAspectRatio)\r\n        }\r\n        : {\r\n          src: this.src.src,\r\n          srcset: this.srcset || this.src.srcset,\r\n          lazySrc: this.lazySrc || this.src.lazySrc,\r\n          aspect: Number(this.aspectRatio || this.src.aspect || this.calculatedAspectRatio)\r\n        }\r\n    },\r\n    __cachedImage (): VNode | never[] {\r\n      if (!(this.normalisedSrc.src || this.normalisedSrc.lazySrc)) return []\r\n\r\n      const backgroundImage: string[] = []\r\n      const src = this.isLoading ? this.normalisedSrc.lazySrc : this.currentSrc\r\n\r\n      if (this.gradient) backgroundImage.push(`linear-gradient(${this.gradient})`)\r\n      if (src) backgroundImage.push(`url(\"${src}\")`)\r\n\r\n      const image = this.$createElement('div', {\r\n        staticClass: 'v-image__image',\r\n        class: {\r\n          'v-image__image--preload': this.isLoading,\r\n          'v-image__image--contain': this.contain,\r\n          'v-image__image--cover': !this.contain\r\n        },\r\n        style: {\r\n          backgroundImage: backgroundImage.join(', '),\r\n          backgroundPosition: this.position\r\n        },\r\n        key: +this.isLoading\r\n      })\r\n\r\n      if (!this.transition) return image\r\n\r\n      return this.$createElement('transition', {\r\n        attrs: {\r\n          name: this.transition,\r\n          mode: 'in-out'\r\n        }\r\n      }, [image])\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    src () {\r\n      if (!this.isLoading) this.init()\r\n      else this.loadImage()\r\n    },\r\n    '$vuetify.breakpoint.width': 'getSrc'\r\n  },\r\n\r\n  mounted () {\r\n    this.init()\r\n  },\r\n\r\n  methods: {\r\n    init () {\r\n      if (this.normalisedSrc.lazySrc) {\r\n        const lazyImg = new Image()\r\n        lazyImg.src = this.normalisedSrc.lazySrc\r\n        this.pollForSize(lazyImg, null)\r\n      }\r\n      /* istanbul ignore else */\r\n      if (this.normalisedSrc.src) this.loadImage()\r\n    },\r\n    onLoad () {\r\n      this.getSrc()\r\n      this.isLoading = false\r\n      this.$emit('load', this.src)\r\n    },\r\n    onError () {\r\n      consoleError(\r\n        `Image load failed\\n\\n` +\r\n        `src: ${this.normalisedSrc.src}`,\r\n        this\r\n      )\r\n      this.$emit('error', this.src)\r\n    },\r\n    getSrc () {\r\n      /* istanbul ignore else */\r\n      if (this.image) this.currentSrc = this.image.currentSrc || this.image.src\r\n    },\r\n    loadImage () {\r\n      const image = new Image()\r\n      this.image = image\r\n\r\n      image.onload = () => {\r\n        /* istanbul ignore if */\r\n        if (image.decode) {\r\n          image.decode().catch((err: DOMException) => {\r\n            consoleWarn(\r\n              `Failed to decode image, trying to render anyway\\n\\n` +\r\n              `src: ${this.normalisedSrc.src}` +\r\n              (err.message ? `\\nOriginal error: ${err.message}` : ''),\r\n              this\r\n            )\r\n          }).then(this.onLoad)\r\n        } else {\r\n          this.onLoad()\r\n        }\r\n      }\r\n      image.onerror = this.onError\r\n\r\n      image.src = this.normalisedSrc.src\r\n      this.sizes && (image.sizes = this.sizes)\r\n      this.normalisedSrc.srcset && (image.srcset = this.normalisedSrc.srcset)\r\n\r\n      this.aspectRatio || this.pollForSize(image)\r\n      this.getSrc()\r\n    },\r\n    pollForSize (img: HTMLImageElement, timeout: number | null = 100) {\r\n      const poll = () => {\r\n        const { naturalHeight, naturalWidth } = img\r\n\r\n        if (naturalHeight || naturalWidth) {\r\n          this.calculatedAspectRatio = naturalWidth / naturalHeight\r\n        } else {\r\n          timeout != null && setTimeout(poll, timeout)\r\n        }\r\n      }\r\n\r\n      poll()\r\n    },\r\n    __genPlaceholder (): VNode | void {\r\n      if (this.$slots.placeholder) {\r\n        const placeholder = this.isLoading\r\n          ? [this.$createElement('div', {\r\n            staticClass: 'v-image__placeholder'\r\n          }, this.$slots.placeholder)]\r\n          : []\r\n\r\n        if (!this.transition) return placeholder[0]\r\n\r\n        return this.$createElement('transition', {\r\n          attrs: { name: this.transition }\r\n        }, placeholder)\r\n      }\r\n    }\r\n  },\r\n\r\n  render (h): VNode {\r\n    const node = VResponsive.options.render.call(this, h)\r\n\r\n    node.data.staticClass += ' v-image'\r\n\r\n    node.data.attrs = {\r\n      role: this.alt ? 'img' : undefined,\r\n      'aria-label': this.alt\r\n    }\r\n\r\n    node.children = [\r\n      this.__cachedSizer,\r\n      this.__cachedImage,\r\n      this.__genPlaceholder(),\r\n      this.genContent()\r\n    ]\r\n\r\n    return h(node.tag, node.data, node.children)\r\n  }\r\n})\r\n"],"sourceRoot":""}