{"version":3,"sources":["../../src/directives/touch.ts"],"names":[],"mappings":"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","sourcesContent":["import { VNodeDirective, VNode } from 'vue/types/vnode'\r\nimport { keys } from '../util/helpers'\r\n\r\nexport interface TouchStoredHandlers {\r\n  touchstart: (e: TouchEvent) => void\r\n  touchend: (e: TouchEvent) => void\r\n  touchmove: (e: TouchEvent) => void\r\n}\r\n\r\ninterface TouchHandlers {\r\n  start?: (wrapperEvent: TouchEvent & TouchWrapper) => void\r\n  end?: (wrapperEvent: TouchEvent & TouchWrapper) => void\r\n  move?: (wrapperEvent: TouchEvent & TouchWrapper) => void\r\n  left?: (wrapper: TouchWrapper) => void\r\n  right?: (wrapper: TouchWrapper) => void\r\n  up?: (wrapper: TouchWrapper) => void\r\n  down?: (wrapper: TouchWrapper) => void\r\n}\r\n\r\nexport interface TouchWrapper extends TouchHandlers {\r\n  touchstartX: number\r\n  touchstartY: number\r\n  touchmoveX: number\r\n  touchmoveY: number\r\n  touchendX: number\r\n  touchendY: number\r\n  offsetX: number\r\n  offsetY: number\r\n}\r\n\r\ninterface TouchVNodeDirective extends VNodeDirective {\r\n  value?: TouchHandlers & {\r\n    parent?: boolean\r\n    options?: AddEventListenerOptions\r\n  }\r\n}\r\n\r\nconst handleGesture = (wrapper: TouchWrapper) => {\r\n  const { touchstartX, touchendX, touchstartY, touchendY } = wrapper\r\n  const dirRatio = 0.5\r\n  const minDistance = 16\r\n  wrapper.offsetX = touchendX - touchstartX\r\n  wrapper.offsetY = touchendY - touchstartY\r\n\r\n  if (Math.abs(wrapper.offsetY) < dirRatio * Math.abs(wrapper.offsetX)) {\r\n    wrapper.left && (touchendX < touchstartX - minDistance) && wrapper.left(wrapper)\r\n    wrapper.right && (touchendX > touchstartX + minDistance) && wrapper.right(wrapper)\r\n  }\r\n\r\n  if (Math.abs(wrapper.offsetX) < dirRatio * Math.abs(wrapper.offsetY)) {\r\n    wrapper.up && (touchendY < touchstartY - minDistance) && wrapper.up(wrapper)\r\n    wrapper.down && (touchendY > touchstartY + minDistance) && wrapper.down(wrapper)\r\n  }\r\n}\r\n\r\nfunction touchstart (event: TouchEvent, wrapper: TouchWrapper) {\r\n  const touch = event.changedTouches[0]\r\n  wrapper.touchstartX = touch.clientX\r\n  wrapper.touchstartY = touch.clientY\r\n\r\n  wrapper.start &&\r\n    wrapper.start(Object.assign(event, wrapper))\r\n}\r\n\r\nfunction touchend (event: TouchEvent, wrapper: TouchWrapper) {\r\n  const touch = event.changedTouches[0]\r\n  wrapper.touchendX = touch.clientX\r\n  wrapper.touchendY = touch.clientY\r\n\r\n  wrapper.end &&\r\n    wrapper.end(Object.assign(event, wrapper))\r\n\r\n  handleGesture(wrapper)\r\n}\r\n\r\nfunction touchmove (event: TouchEvent, wrapper: TouchWrapper) {\r\n  const touch = event.changedTouches[0]\r\n  wrapper.touchmoveX = touch.clientX\r\n  wrapper.touchmoveY = touch.clientY\r\n\r\n  wrapper.move && wrapper.move(Object.assign(event, wrapper))\r\n}\r\n\r\nfunction createHandlers (value: TouchHandlers): TouchStoredHandlers {\r\n  const wrapper = {\r\n    touchstartX: 0,\r\n    touchstartY: 0,\r\n    touchendX: 0,\r\n    touchendY: 0,\r\n    touchmoveX: 0,\r\n    touchmoveY: 0,\r\n    offsetX: 0,\r\n    offsetY: 0,\r\n    left: value.left,\r\n    right: value.right,\r\n    up: value.up,\r\n    down: value.down,\r\n    start: value.start,\r\n    move: value.move,\r\n    end: value.end\r\n  }\r\n\r\n  return {\r\n    touchstart: (e: TouchEvent) => touchstart(e, wrapper),\r\n    touchend: (e: TouchEvent) => touchend(e, wrapper),\r\n    touchmove: (e: TouchEvent) => touchmove(e, wrapper)\r\n  }\r\n}\r\n\r\nfunction inserted (el: HTMLElement, binding: TouchVNodeDirective, vnode: VNode) {\r\n  const value = binding.value!\r\n  const target = value.parent ? el.parentElement : el\r\n  const options = value.options || { passive: true }\r\n\r\n  // Needed to pass unit tests\r\n  if (!target) return\r\n\r\n  const handlers = createHandlers(binding.value!)\r\n  target._touchHandlers = Object(target._touchHandlers)\r\n  target._touchHandlers![vnode.context!._uid] = handlers\r\n\r\n  keys(handlers).forEach(eventName => {\r\n    target.addEventListener(eventName, handlers[eventName] as EventListener, options)\r\n  })\r\n}\r\n\r\nfunction unbind (el: HTMLElement, binding: TouchVNodeDirective, vnode: VNode) {\r\n  const target = binding.value!.parent ? el.parentElement : el\r\n  if (!target || !target._touchHandlers) return\r\n\r\n  const handlers = target._touchHandlers[vnode.context!._uid]\r\n  keys(handlers).forEach(eventName => {\r\n    target.removeEventListener(eventName, handlers[eventName])\r\n  })\r\n  delete target._touchHandlers[vnode.context!._uid]\r\n}\r\n\r\nexport default {\r\n  inserted,\r\n  unbind\r\n}\r\n"],"sourceRoot":""}